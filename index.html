<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Shinichi Nakagawa">
<meta name="author" content="Ayumi Mizuno">
<meta name="author" content="Santiago Ortega">
<meta name="author" content="Daniel Noble">
<meta name="author" content="Alistair Senior">
<meta name="author" content="Erick J Lundgren">
<meta name="author" content="many others order TBD">
<meta name="dcterms.date" content="2025-09-20">
<title>Introduction to SAFE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="introduction to SAFE_files/libs/clipboard/clipboard.min.js"></script>
<script src="introduction to SAFE_files/libs/quarto-html/quarto.js"></script>
<script src="introduction to SAFE_files/libs/quarto-html/popper.min.js"></script>
<script src="introduction to SAFE_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="introduction to SAFE_files/libs/quarto-html/anchor.min.js"></script>
<link href="introduction to SAFE_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="introduction to SAFE_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="introduction to SAFE_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="introduction to SAFE_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="introduction to SAFE_files/libs/bootstrap/bootstrap-11255d631cf4d0e2063def319161670c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title"><strong>CONTENTS</strong></h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li>
<a href="#an-introduction-to-safe-bootstrapping" id="toc-an-introduction-to-safe-bootstrapping" class="nav-link" data-scroll-target="#an-introduction-to-safe-bootstrapping">An introduction to SAFE bootstrapping</a>
  <ul>
<li>
<a href="#how-does-it-work" id="toc-how-does-it-work" class="nav-link" data-scroll-target="#how-does-it-work">How does it work?</a>
  <ul>
<li><a href="#step-1-draw-hyperparameters." id="toc-step-1-draw-hyperparameters." class="nav-link" data-scroll-target="#step-1-draw-hyperparameters.">Step 1: Draw hyperparameters.</a></li>
  <li><a href="#step-2-transform-hyperparameters-to-target-effect-size" id="toc-step-2-transform-hyperparameters-to-target-effect-size" class="nav-link" data-scroll-target="#step-2-transform-hyperparameters-to-target-effect-size">Step 2: Transform hyperparameters to target effect size</a></li>
  <li><a href="#step-3-calculate-sampling-variance" id="toc-step-3-calculate-sampling-variance" class="nav-link" data-scroll-target="#step-3-calculate-sampling-variance">Step 3: Calculate sampling variance</a></li>
  <li><a href="#step-4-calculate-bias-corrected-effect-size" id="toc-step-4-calculate-bias-corrected-effect-size" class="nav-link" data-scroll-target="#step-4-calculate-bias-corrected-effect-size">Step 4: Calculate bias-corrected effect size</a></li>
  </ul>
</li>
  <li><a href="#load-encapsulated-functions" id="toc-load-encapsulated-functions" class="nav-link" data-scroll-target="#load-encapsulated-functions">Load encapsulated functions</a></li>
  </ul>
</li>
  <li>
<a href="#how-good-is-safe" id="toc-how-good-is-safe" class="nav-link" data-scroll-target="#how-good-is-safe">How good is SAFE?</a>
  <ul>
<li>
<a href="#calculate-bias" id="toc-calculate-bias" class="nav-link" data-scroll-target="#calculate-bias">Calculate bias</a>
  <ul>
<li><a href="#effect-size-point-estimate-bias" id="toc-effect-size-point-estimate-bias" class="nav-link" data-scroll-target="#effect-size-point-estimate-bias">Effect size (point estimate) bias</a></li>
  <li><a href="#sampling-variance-bias" id="toc-sampling-variance-bias" class="nav-link" data-scroll-target="#sampling-variance-bias">Sampling variance bias</a></li>
  </ul>
</li>
  <li><a href="#plot-all-simulations-results" id="toc-plot-all-simulations-results" class="nav-link" data-scroll-target="#plot-all-simulations-results">Plot all simulations results</a></li>
  </ul>
</li>
  <li>
<a href="#these-are-plotting-1e5-right-nowrerunning-1e6.-will-update-soon" id="toc-these-are-plotting-1e5-right-nowrerunning-1e6.-will-update-soon" class="nav-link" data-scroll-target="#these-are-plotting-1e5-right-nowrerunning-1e6.-will-update-soon"><strong>These are plotting 1e5 right now…Rerunning 1e6. Will update soon</strong></a>
  <ul>
<li><a href="#speed" id="toc-speed" class="nav-link" data-scroll-target="#speed">Speed</a></li>
  <li><a href="#smd-4-multivariate-normal" id="toc-smd-4-multivariate-normal" class="nav-link" data-scroll-target="#smd-4-multivariate-normal">SMD 4-multivariate normal</a></li>
  <li><a href="#smd-2-multivariate-normal-and-2-wishart" id="toc-smd-2-multivariate-normal-and-2-wishart" class="nav-link" data-scroll-target="#smd-2-multivariate-normal-and-2-wishart">SMD 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lncvr-4-multivariate-normal" id="toc-lncvr-4-multivariate-normal" class="nav-link" data-scroll-target="#lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</a></li>
  <li><a href="#lncvr-2-multivariate-normal-and-2-wishart" id="toc-lncvr-2-multivariate-normal-and-2-wishart" class="nav-link" data-scroll-target="#lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lnor" id="toc-lnor" class="nav-link" data-scroll-target="#lnor">lnOR</a></li>
  <li><a href="#lnrr" id="toc-lnrr" class="nav-link" data-scroll-target="#lnrr">lnRR</a></li>
  <li><a href="#hardy-weinberg-disequilibrium" id="toc-hardy-weinberg-disequilibrium" class="nav-link" data-scroll-target="#hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</a></li>
  </ul>
</li>
  <li>
<a href="#how-many-safe-bootstraps" id="toc-how-many-safe-bootstraps" class="nav-link" data-scroll-target="#how-many-safe-bootstraps">How many SAFE bootstraps?</a>
  <ul>
<li>
<a href="#bootstrap-scenario-results" id="toc-bootstrap-scenario-results" class="nav-link" data-scroll-target="#bootstrap-scenario-results">Bootstrap scenario results</a>
  <ul>
<li><a href="#speed-1" id="toc-speed-1" class="nav-link" data-scroll-target="#speed-1">Speed</a></li>
  <li><a href="#smd-4-multivariate-normal-1" id="toc-smd-4-multivariate-normal-1" class="nav-link" data-scroll-target="#smd-4-multivariate-normal-1">SMD 4-multivariate normal</a></li>
  <li><a href="#smd-2-multivariate-normal-and-2-wishart-1" id="toc-smd-2-multivariate-normal-and-2-wishart-1" class="nav-link" data-scroll-target="#smd-2-multivariate-normal-and-2-wishart-1">SMD 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lncvr-4-multivariate-normal-1" id="toc-lncvr-4-multivariate-normal-1" class="nav-link" data-scroll-target="#lncvr-4-multivariate-normal-1">lnCVR 4-multivariate normal</a></li>
  <li><a href="#lncvr-2-multivariate-normal-and-2-wishart-1" id="toc-lncvr-2-multivariate-normal-and-2-wishart-1" class="nav-link" data-scroll-target="#lncvr-2-multivariate-normal-and-2-wishart-1">lnCVR 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lnor-1" id="toc-lnor-1" class="nav-link" data-scroll-target="#lnor-1">lnOR</a></li>
  <li><a href="#lnrr-1" id="toc-lnrr-1" class="nav-link" data-scroll-target="#lnrr-1">lnRR</a></li>
  <li><a href="#hardy-weinberg-disequilibrium-1" id="toc-hardy-weinberg-disequilibrium-1" class="nav-link" data-scroll-target="#hardy-weinberg-disequilibrium-1">Hardy Weinberg Disequilibrium</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Introduction to SAFE</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">A step by step online tutorial</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Shinichi Nakagawa </p>
             <p>Ayumi Mizuno </p>
             <p>Santiago Ortega </p>
             <p>Daniel Noble </p>
             <p>Alistair Senior </p>
             <p>Erick J Lundgren </p>
             <p>many others order TBD </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 20, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren@gmail.com).</p>
<p>To run the code interactively (instead of just reading this lovely tutorial), do the following:</p>
<ol type="1">
<li>Clone the github repo: https://github.com/ejlundgren/SAFE.git</li>
<li>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session or just follow along here on the web</li>
</ol>
<p><strong>QUESTION: I prefer data.table() and I wrote everything in that function…I can convert to dplyr no problem though if people are that picky. Does anyone care?</strong></p>
</section><section id="load-libraries" class="level2"><h2 class="anchored" data-anchor-id="load-libraries">Load libraries</h2>
<p>The <code>groundhog</code> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <code>groundhog</code> if it is not already installed with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, clean the environment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now load packages:</span></span>
<span><span class="co"># install.packages("groundhog")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://groundhogr.com/">"groundhog"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/groundhog/man/groundhog.library.html">groundhog.library</a></span><span class="op">(</span>pkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"crayon"</span>, </span>
<span>                          <span class="st">"tmvtnorm"</span>, <span class="st">"here"</span>,</span>
<span>                          <span class="st">"parallel"</span>, <span class="st">"foreach"</span>, <span class="st">"doSNOW"</span>,</span>
<span>                          <span class="st">"ggplot2"</span>, <span class="st">"patchwork"</span>, <span class="st">"scico"</span><span class="op">)</span>,</span>
<span>                  date <span class="op">=</span> <span class="st">"2025-04-15"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="an-introduction-to-safe-bootstrapping" class="level1"><h1>An introduction to SAFE bootstrapping</h1>
<p>SAFE bootstrapping is an incredible, seemingly magical, technique to calculate bias-corrected point estimates and sampling variance for effect sizes. SAFE bootstrapping is particularly useful for novel effect sizes for which sampling variance formulas may not be known. In some cases, it is also more unbiased than traditional plugin formulas for variance and point estimates.</p>
<section id="how-does-it-work" class="level2"><h2 class="anchored" data-anchor-id="how-does-it-work">How does it work?</h2>
<p>With SAFE bootstrapping, one draws a cloud of <em>hyperparameters</em> of all variables used in an effect size formula. You then apply your effect size formula to this cloud. The variance of this transformed cloud is the sampling variance of your effect size!</p>
<p>You can then calculate a bias-transformed point estimate by taking the mean of this transformed cloud and subtracting it from 2 times the point estimate derived from the original variables.</p>
<p>Let’s demonstrate.</p>
<p>Imagine you’re conducting a meta-analysis of animal responses to an environmental stressor. Many studies are reporting data as mean ‘latency time’ (e.g., time until an animal runs). However, you want to create an effect size of ‘speed’ from latency time. This is simple: take the inverse of latency (<code>1/latency</code>). Here let’s start with three mean latency times and convert to our new ‘speed’ effect size</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The type of data summaries you might extract for a meta-analysis:</span></span>
<span><span class="va">mean_latency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">21</span><span class="op">)</span></span>
<span>           <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">31</span>, <span class="fl">50</span><span class="op">)</span></span>
<span>          <span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.6</span>, <span class="fl">3.1</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># New effect size:</span></span>
<span><span class="fl">1</span><span class="op">/</span><span class="va">mean_latency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667 0.03333333 0.04761905</code></pre>
</div>
</div>
<p>The effect size is trivial to calculate. But what is the sampling variance of this effect size, given that each of these measurements was associated with measurement sample size and standard deviation?</p>
<p>You could use calculus to derive a first-order sampling variance formula. Or you could use SAFE bootstrapping.</p>
<section id="step-1-draw-hyperparameters." class="level3"><h3 class="anchored" data-anchor-id="step-1-draw-hyperparameters.">Step 1: Draw hyperparameters.</h3>
<p>If the word ‘hyperparameter’ is scary, what we mean is a distribution associated with the variables in our effect size formula, in this case mean <code>latency</code>.</p>
<p>This is different than drawing from a population based on mean and standard deviation, which will have a broad distribution, reflecting the underlying population. Instead, we’re interested in drawing a distribution of the <strong>means</strong>—the hyperparameter of our effect size of interest. To do this, we draw from a normal distribution with <strong>standard error of the mean</strong> to describe dispersion.</p>
<p>To convert our ‘latency’ time to our ‘speed’ effect size with SAFE, let’s draw 10,000 samples of the mean latency hyperparameter from a normal distribution, with standard error as our <code>sd</code>. To avoid using <code>lapply</code> or loops, we’ll just do this on a single latency time and associated standard deviation and sample size.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define the variables</span></span>
<span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">15</span>  <span class="co"># The mean latency time</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">4.6</span> <span class="co"># standard deviation of latency time</span></span>
<span> <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span>  <span class="co"># sample size, e.g., number of animals in the experiment</span></span>
<span></span>
<span><span class="co"># Simulate a cloud of hyperparameters</span></span>
<span><span class="va">cloud</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1e6</span>,                  <span class="co"># number of samples</span></span>
<span>               mean <span class="op">=</span> <span class="va">x</span>,             <span class="co"># mean latency time</span></span>
<span>                 sd <span class="op">=</span> <span class="va">sd</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>  <span class="co"># standard error</span></span>
<span></span>
<span><span class="co"># Have a look a the cloud (distribution)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cloud</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.29519 13.90150 15.17457 16.86777 14.31993 14.96645</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">cloud</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/speed_cloud-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="step-2-transform-hyperparameters-to-target-effect-size" class="level3"><h3 class="anchored" data-anchor-id="step-2-transform-hyperparameters-to-target-effect-size">Step 2: Transform hyperparameters to target effect size</h3>
<p>Now, let’s transform this cloud of hyperparameters to ‘speed’ with our ‘plugin’ or definition formula <code>1/x</code>. These values are centered on our original effect size, which we’ll overlay in red</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Transform the cloud to our effect size we want</span></span>
<span>       <span class="va">cloud_trans</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">cloud</span></span>
<span></span>
<span><span class="co"># Our plugin effect size</span></span>
<span>                 <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">plugin_effect_size</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span></span>
<span><span class="va">plugin_effect_size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Our plugin effect size</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">cloud_trans</span>, main <span class="op">=</span> <span class="st">"Transformed hyperparameter cloud"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">plugin_effect_size</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/speed_transform-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="step-3-calculate-sampling-variance" class="level3"><h3 class="anchored" data-anchor-id="step-3-calculate-sampling-variance">Step 3: Calculate sampling variance</h3>
<p>To calculate sampling variance, we’ll simply calculate the variance of this transformed cloud.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_vi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">cloud_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="va">safe_vi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.725612e-05</code></pre>
</div>
</div>
<p>Voila! Sampling variance for a novel effect size. Pretty magical right?</p>
</section><section id="step-4-calculate-bias-corrected-effect-size" class="level3"><h3 class="anchored" data-anchor-id="step-4-calculate-bias-corrected-effect-size">Step 4: Calculate bias-corrected effect size</h3>
<p>However, given low sample sizes for some measurements, and the knowledge that point estimates can be biased at low N, let’s also calculate a bias-corrected point estimate from this cloud of hyperparameters:</p>
<p><strong>It’d be nice to explain the logic here better…without formulas haha</strong></p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_yi</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">plugin_effect_size</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cloud_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="va">safe_yi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06641067</code></pre>
</div>
</div>
<p>Let’s compare this to the original point estimate:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_yi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06641067</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plugin_effect_size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667</code></pre>
</div>
</div>
<p>So similar! And potentially less biased. Let’s find out. Below, we’ll use Monte Carlo simulations to compare the bias of estimates from SAFE to estimates from just plugging into a formula. But first, let’s introduce a helpful function for calculating SAFE for a variety of effect sizes.</p>
</section></section><section id="load-encapsulated-functions" class="level2"><h2 class="anchored" data-anchor-id="load-encapsulated-functions">Load encapsulated functions</h2>
<p>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let’s load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at scripts/SAFE_function.R. This function returns a data.table (basically a <em>fast</em> data.frame) with columns for plugin effect sizes and sampling variances (denoted with <code>_first</code> or <code>_second</code> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <code>_safe</code>). Point estimates (effect sizes) are denoted with <code>yi_</code> while sampling variances are denoted with <code>vi_</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"scripts/SAFE_function.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For a single effect size and sampling variance:</span></span>
<span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">14.5</span>, x2 <span class="op">=</span> <span class="fl">7.9</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fl">1.3</span>, sd2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fl">20</span>, n2 <span class="op">=</span> <span class="fl">20</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>lnRoM cannot accept x1 or x2 ≤ 0. Leaving it to user's discretion to check prior to execution. Negative values will be returned as NA.

Using the formulas:
     yi_first &lt;- log(x1 / x2)
     yi_second &lt;- log(x1 / x2) + 0.5 * (sd1^2/(n1 * x1^2) - sd2^2/(n2 * x2^2))
     vi_first &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2)
     vi_second &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2) + 0.5 * ( (sd1^4 / (n1^2 * x1^4)) + (sd2^4 / (n2^2 * x2^4))) 
Be sure that all variables in formula are correctly named.

SAFE: 1 / 1 
Running SAFE with 1e+06 bootstraps</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second    vi_first   vi_second   yi_safe    vi_safe    SE_safe
       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1: 0.6072859 0.6058845 0.003606517 0.003611733 0.6059333 0.00363372 0.06028034</code></pre>
</div>
</div>
<p>The function also works with a vector of raw data:</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14.5</span>, <span class="fl">13</span>, <span class="fl">15.8</span><span class="op">)</span>, </span>
<span>         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.9</span>, <span class="fl">21</span>, <span class="fl">18.4</span><span class="op">)</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">2</span>, <span class="fl">1.9</span><span class="op">)</span>, </span>
<span>         sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span><span class="op">)</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>, </span>
<span>         n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"SMD"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         parallelize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second  vi_first vi_second   yi_safe   vi_safe   SE_safe
       &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;
1:  3.912937  3.835196 0.3014615 0.2975274  3.821429 0.3649831 0.6041383
2: -3.167230 -3.094698 0.2686568 0.2633745 -3.408884 0.2527923 0.5027845
3: -1.545312 -1.512893 0.1387221 0.1343396 -1.541051 0.1404058 0.3747077</code></pre>
</div>
</div>
<p>For a full list of options that eff_size can calculate, run:</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>
Must specify an effect size type ('effect_type') and necessary variables (named in arguments to function call) to match formula equations.
 
Returning effect size names &amp; required variables for reference.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>            name               vars_required
          &lt;char&gt;                      &lt;char&gt;
 1:          SMD    x1, x2, sd1, sd2, n1, n2
 2:   SMD_paired x1, x2, sd1, sd2, r, n1, n2
 3:        lnCVR    x1, x2, sd1, sd2, n1, n2
 4: lnCVR_paired x1, x2, sd1, sd2, r, n1, n2
 5:      lnHWE_A            n_AA, n_Aa, n_aa
 6:   lnM_paired x1, x2, sd1, sd2, n1, n2, r
 7:         lnOR                  a, b, c, d
 8:         lnRR                a, c, n1, n2
 9:        lnRoM    x1, x2, sd1, sd2, n1, n2
10: lnRoM_paired x1, x2, sd1, sd2, r, n1, n2
11:   reciprocal                    n, x, sd</code></pre>
</div>
</div>
</section></section><section id="how-good-is-safe" class="level1"><h1>How good is SAFE?</h1>
<p>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size and the number of SAFE bootstraps. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let’s look at the simulations for lnRoM:</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"builds/scenarios.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset scenarios:</span></span>
<span><span class="va">guide</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span><span class="va">effect_type</span> <span class="op">==</span> <span class="st">"lnRoM"</span> <span class="op">&amp;</span></span>
<span>                     <span class="va">boots</span> <span class="op">==</span> <span class="fl">1e6</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">guide</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">effect_type</span>, <span class="va">scenario_id</span>, <span class="va">boots</span>,</span>
<span>                   <span class="va">true_mean1</span>, <span class="va">true_mean2</span>, </span>
<span>                   <span class="va">true_sd1</span>, <span class="va">true_sd2</span>,</span>
<span>                   <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>   effect_type       scenario_id boots true_mean1 true_mean2 true_sd1 true_sd2
        &lt;char&gt;            &lt;char&gt; &lt;num&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1:       lnRoM  lnRoM_scenario_6 1e+06       13.4       16.1      4.6      3.9
2:       lnRoM lnRoM_scenario_13 1e+06       13.4       16.1      4.6      3.9
3:       lnRoM lnRoM_scenario_20 1e+06       13.4       16.1      4.6      3.9
4:       lnRoM lnRoM_scenario_27 1e+06       13.4       16.1      4.6      3.9
5:       lnRoM lnRoM_scenario_34 1e+06       13.4       16.1      4.6      3.9
   sample_size1 sample_size2
          &lt;num&gt;        &lt;num&gt;
1:            5            5
2:           10           10
3:           50           50
4:          100          100
5:          150          150</code></pre>
</div>
</div>
<p>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the ‘true’ values and based on the simulated dataset. We did this 1e5 times for each scenario.</p>
<p>In these Monte Carlo simulation, we were interested in bias, or the difference between the ‘true’ estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We’ll explain the difference between estimands, estimators, and estimates below.</p>
<p>To illustrate, we’ll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we’ll only run 100 simulations.</p>
<p>To speed things up we will do this in parallel. The function <code>prepare_cluster()</code> below can help set things up, including a progress bar so you don’t lose your mind wondering what’s going on in there.</p>
<div class="cell">
<div class="sourceCode" id="cb28" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare cluster:</span></span>
<span><span class="va">prepare_cluster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/RevolutionAnalytics/foreach">"foreach"</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"doSNOW"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">nCores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span> </span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">nCores</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/doSNOW/man/registerDoSNOW.html">registerDoSNOW</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Progress bar</span></span>
<span>    <span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">txtProgressBar</a></span><span class="op">(</span>max <span class="op">=</span> <span class="va">n</span>, style <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">pb</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>progress <span class="op">=</span> <span class="va">progress</span><span class="op">)</span></span>
<span>    <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">opts</span>, <span class="va">pb</span>, <span class="va">cl</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized below. The first part of this code (inside the <code>lapply</code>) creates simulated data based on ‘true’ means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the ‘true’ values and simulated values. Note that even with only 100 iterations, this can take a minute, so feel free to load the already run dummy dataset in the next code block.</p>
<div class="cell">
<div class="sourceCode" id="cb29" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rerun</span> <span class="op">&lt;-</span> <span class="cn">F</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">rerun</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">monte_carlo_N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  </span>
<span>  <span class="va">clust_out</span> <span class="op">&lt;-</span> <span class="fu">prepare_cluster</span><span class="op">(</span>n <span class="op">=</span> <span class="va">monte_carlo_N</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">monte_carlo_N</span>, </span>
<span>         .options.snow <span class="op">=</span> <span class="va">clust_out</span><span class="op">$</span><span class="va">options</span>,</span>
<span>         .errorhandling <span class="op">=</span> <span class="st">"pass"</span>,</span>
<span>         .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">%dopar%</a></span> <span class="op">{</span></span>
<span>           </span>
<span>   <span class="co"># Calculate 'true' values from scenario:</span></span>
<span>   <span class="va">true_point</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span>, x2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                          sd1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span>,  sd2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                          n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                          effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                          SAFE <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">true_point</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>    <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span>   <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">guide</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>     </span>
<span>     <span class="co"># Simulate data for guide</span></span>
<span>     <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                   <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                m2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rtmvnorm</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     mean <span class="op">=</span> <span class="va">means</span>,</span>
<span>                     sigma <span class="op">=</span> <span class="va">sig</span>,</span>
<span>                     lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     algorithm <span class="op">=</span> <span class="st">"gibbs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu">setDT</span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="st">"m2"</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="co"># Filter to number of samples per treatment</span></span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m1</span>,</span>
<span>                     x2 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m2</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>sim_mean1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_mean2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_sample_size1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_sample_size2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span>
<span>   <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="op">)</span></span>
<span>   </span>
<span>  </span>
<span>   <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean1</span>, x2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean2</span>,</span>
<span>                   sd1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd1</span>,  sd2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd2</span>,</span>
<span>                   n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                   effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                   SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   parallelize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">out</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># Store results:</span></span>
<span>   <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">guide</span>,</span>
<span>                         <span class="va">sim_dat</span>,</span>
<span>                         <span class="va">true_point</span>,</span>
<span>                         <span class="va">out</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">progress</span>, <span class="va">i</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">res</span><span class="op">)</span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or just load the full simulation (1e5) here:</p>
<div class="cell">
<div class="sourceCode" id="cb30" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"builds/lnRoM_simulation.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id boots effect_type true_mean1 true_mean2 true_sd1 true_sd2
             &lt;char&gt; &lt;num&gt;      &lt;char&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
2: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
3: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
   sample_size1 sample_size_ratio sample_size2 sim_mean1 sim_mean2  sim_sd1
          &lt;num&gt;             &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;    &lt;num&gt;
1:            5                 1            5  13.12934  16.59769 4.986235
2:            5                 1            5  12.73781  14.25180 4.363871
3:            5                 1            5  14.81564  14.87446 1.991222
    sim_sd2 sim_sample_size1 sim_sample_size2 true_y_plugin_1st
      &lt;num&gt;            &lt;int&gt;            &lt;int&gt;             &lt;num&gt;
1: 4.004230                5                5        -0.1835646
2: 3.704075                5                5        -0.1835646
3: 3.157322                5                5        -0.1835646
   true_y_plugin_2nd true_v_plugin_1st true_v_plugin_2nd sim_y_plugin_1st
               &lt;num&gt;             &lt;num&gt;             &lt;num&gt;            &lt;num&gt;
1:         -0.177648        0.03530438        0.03565099     -0.234413837
2:         -0.177648        0.03530438        0.03565099     -0.112308908
3:         -0.177648        0.03530438        0.03565099     -0.003962011
   sim_y_plugin_2nd sim_v_plugin_1st sim_v_plugin_2nd      yi_safe    vi_safe
              &lt;num&gt;            &lt;num&gt;            &lt;num&gt;        &lt;num&gt;      &lt;num&gt;
1:     -0.225810970       0.04048679       0.04097060 -0.225408279 0.04328101
2:     -0.107326891       0.03698369       0.03735046 -0.106866241 0.03915580
3:     -0.006661305       0.01262393       0.01267106 -0.006623332 0.01285204
     SE_safe  iter
       &lt;num&gt; &lt;int&gt;
1: 0.2080409     1
2: 0.1978783     2
3: 0.1133668     3</code></pre>
</div>
</div>
<section id="calculate-bias" class="level2"><h2 class="anchored" data-anchor-id="calculate-bias">Calculate bias</h2>
<p>To interpret the simulation results, it is essential to understand the difference between <em>estimands</em>, <em>estimators</em>, and <em>estimates</em>.</p>
<p><strong>Estimands</strong> are the ‘true’ value.</p>
<p><strong>Estimators</strong> are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges’ g) to reduce bias, and the SAFE method.</p>
<p><strong>Estimates</strong> are the estimates of the estimands produced by the estimators 🤠</p>
<section id="effect-size-point-estimate-bias" class="level3"><h3 class="anchored" data-anchor-id="effect-size-point-estimate-bias">Effect size (point estimate) bias</h3>
<p>In the case of our effect sizes, there are two estimands that we’re interested in estimating: the ‘true’ effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the ‘true’ values).</p>
<p>Here we will calculate bias in our estimates of effect sizes:</p>
<div class="cell">
<div class="sourceCode" id="cb32" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>, <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">point.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>plugin_1st <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_1st</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      plugin_2nd <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      safe <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">yi_safe</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2   plugin_1st  plugin_2nd
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;        &lt;num&gt;       &lt;num&gt;
1:  lnRoM_scenario_4            5            5 -0.003738263 0.002470844
2: lnRoM_scenario_10           10           10 -0.000385537 0.002574180
3: lnRoM_scenario_16           50           50  0.001587492 0.002159629
4: lnRoM_scenario_22          100          100  0.001640940 0.001925938
5: lnRoM_scenario_28          150          150  0.001657941 0.001847710
          safe
         &lt;num&gt;
1: 0.003160768
2: 0.002682675
3: 0.002163063
4: 0.001926593
5: 0.001848109</code></pre>
</div>
<div class="sourceCode" id="cb34" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Melt this to make it plottable:</span></span>
<span><span class="va">point.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">point.bias</span>,</span>
<span>                        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span>,</span>
<span>                        value.name <span class="op">=</span> <span class="st">"bias"</span>,</span>
<span>                        variable.name <span class="op">=</span> <span class="st">"estimator"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2  estimator         bias
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;fctr&gt;        &lt;num&gt;
1:  lnRoM_scenario_4            5            5 plugin_1st -0.003738263
2: lnRoM_scenario_10           10           10 plugin_1st -0.000385537
3: lnRoM_scenario_16           50           50 plugin_1st  0.001587492
4: lnRoM_scenario_22          100          100 plugin_1st  0.001640940
5: lnRoM_scenario_28          150          150 plugin_1st  0.001657941
6:  lnRoM_scenario_4            5            5 plugin_2nd  0.002470844</code></pre>
</div>
<div class="sourceCode" id="cb36" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort by sample size </span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">point.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">bias</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Bias"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st"</span> <span class="op">=</span> <span class="st">"1st order plugin\n(definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd"</span> <span class="op">=</span> <span class="st">"2nd order plugin\n(bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"safe"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span>,</span>
<span>                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st"</span> <span class="op">=</span> <span class="st">"#A8DADC"</span>,</span>
<span>                                   <span class="st">"plugin_2nd"</span> <span class="op">=</span> <span class="st">"#1D3557"</span>,</span>
<span>                                   <span class="st">"safe"</span> <span class="op">=</span> <span class="st">"#E63946"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This indicates that the least biased estimator is the first order definition formula (light blue). SAFE (red) and the 2nd order plugin (navy blue) perform similarly. These bias values are incredibly small, indicating that all options are fair, except for at low sample sizes, when the first-order definition formula is quite biased.</p>
</section><section id="sampling-variance-bias" class="level3"><h3 class="anchored" data-anchor-id="sampling-variance-bias">Sampling variance bias</h3>
<p>Interestingly, there is no way to know the ‘true’ estimand for sampling variance. <strong>WHICH I DON’T FULLY UNDERSTAND</strong>. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use <em>each</em> of these as the estimand. With 3 estimators, and thus 3 estimands, we’ll thus end up with 9 calculations of bias.</p>
<p>Since we’re interested in relative bias (<strong>Not entirely sure why</strong>), we’ll calculate bias as above but divide by the estimand and multiply by 100.</p>
<div class="cell">
<div class="sourceCode" id="cb37" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_1st</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_1st</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_2nd</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_SAFE</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">yi_safe</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span><span class="va">relative_bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>,</span>
<span>                          <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">estimand</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span><span class="va">var.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>SAFE_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Now melt:</span></span>
<span><span class="va">var.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">var.bias</span>,</span>
<span>                      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">var.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2                   variable
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;                     &lt;fctr&gt;
1:  lnRoM_scenario_4            5            5 SAFE_estimate.1st_estimand
2: lnRoM_scenario_10           10           10 SAFE_estimate.1st_estimand
3: lnRoM_scenario_16           50           50 SAFE_estimate.1st_estimand
4: lnRoM_scenario_22          100          100 SAFE_estimate.1st_estimand
5: lnRoM_scenario_28          150          150 SAFE_estimate.1st_estimand
6:  lnRoM_scenario_4            5            5 SAFE_estimate.2nd_estimand
        value
        &lt;num&gt;
1: 12.2824838
2:  3.5304146
3:  0.1791294
4:  0.5912706
5:  0.3287710
6: 16.6524224</code></pre>
</div>
<div class="sourceCode" id="cb39" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span><span class="va">var.bias.long</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimator"</span>, <span class="st">"Estimand"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">tstrsplit</span><span class="op">(</span><span class="va">variable</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Sort the dataset by sample size</span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">var.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">var.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative bias (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_estimate"</span> <span class="op">=</span> <span class="st">"1st order plugin\n(definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="op">=</span> <span class="st">"2nd order plugin\n(bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"SAFE_estimate"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_estimate"</span> <span class="op">=</span> <span class="st">"#A8DADC"</span>,</span>
<span>                               <span class="st">"plugin_2nd_estimate"</span> <span class="op">=</span> <span class="st">"#1D3557"</span>,</span>
<span>                               <span class="st">"SAFE_estimate"</span> <span class="op">=</span> <span class="st">"#E63946"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">Estimand</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st_estimand"</span> <span class="op">=</span> <span class="st">"1st order plugin estimand\n(definition formula)"</span>,</span>
<span>                                    <span class="st">"2nd_estimand"</span> <span class="op">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span>                                    <span class="st">"SAFE_estimand"</span> <span class="op">=</span> <span class="st">"SAFE estimand"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see here that SAFE (red) is slightly more biased, but in a conservative direction, than the other estimators.</p>
</section></section><section id="plot-all-simulations-results" class="level2"><h2 class="anchored" data-anchor-id="plot-all-simulations-results">Plot all simulations results</h2>
<p>Now let’s look at the rest of the simulation results.</p>
<div class="cell">
<div class="sourceCode" id="cb40" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"builds/all_scenarios_summarized.Rds"</span><span class="op">)</span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="va">sim_results</span><span class="op">[</span><span class="va">boots</span> <span class="op">==</span> <span class="fl">1e5</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="these-are-plotting-1e5-right-nowrerunning-1e6.-will-update-soon" class="level1"><h1><strong>These are plotting 1e5 right now…Rerunning 1e6. Will update soon</strong></h1>
<section id="speed" class="level3"><h3 class="anchored" data-anchor-id="speed">Speed</h3>
<p>This was our dummy effect size in the beginning. How do the point and variance estimates calculated by SAFE compare to just calculating 1 / x for point estimates?</p>
<p>We compared the variance estimates from SAFE to variance estimates produced by a 1st-order derivative sampling variance formula derived with the delta method (denoted as 1st order plugin here). Let’s see which did better!</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="smd-4-multivariate-normal">SMD 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with 4 multivariate normal distributions for both mean and SD, as both of these parameters are in the definition formula (Cohen’s d) of SMD. Let’s compare the bias of SAFE, Cohen’s d, and Hedges’ g.</p>
<p><strong>Need to add explanation of 4-normal versus 2-normal/2-Wishart</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-2-multivariate-normal-and-2-wishart" class="level3"><h3 class="anchored" data-anchor-id="smd-2-multivariate-normal-and-2-wishart">SMD 2-multivariate normal and 2-Wishart</h3>
<p>With this estimator, the SAFE calculation used the normal distribution to simulate the two means but the Wishart distribution to estimate the SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with 4 multivariate normal distributions for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-2-multivariate-normal-and-2-wishart" class="level3"><h3 class="anchored" data-anchor-id="lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</h3>
<p>The SAFE estimator for this effect size was calculated with 2-multivariate normal distribution for the means and 2-Wishart distributions for the SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnor" class="level3"><h3 class="anchored" data-anchor-id="lnor">lnOR</h3>
<p>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for ‘a’ and ‘c’.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr" class="level3"><h3 class="anchored" data-anchor-id="lnrr">lnRR</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘a’ and ‘c’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="hardy-weinberg-disequilibrium" class="level3"><h3 class="anchored" data-anchor-id="hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘n_AA’, ‘n_Aa’, and ‘n_aa’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="how-many-safe-bootstraps" class="level1"><h1>How many SAFE bootstraps?</h1>
<p>The SAFE method relies on bootstrapping to calculate effect size point estimates and sampling variance. It’s sort of magical how well it works! But, how many bootstraps are necessary? Let’s find out by doing another Monte Carlo simulation, again of lnRoM. This time, instead of calculating bias, we’ll look at the standard deviation of the point and sampling variance estimates as we change the number of bootstraps.</p>
<p>Let’s choose two bootstrap lengths: 100 and 1,000. We’ll run a simulation 1,000 times just to make this easy. (See below for full 1e5 simulation results)</p>
<div class="cell">
<div class="sourceCode" id="cb41" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="co"># Create some scenarios based on combinations of sample size and boot-length</span></span>
<span>  <span class="va">scenario</span> <span class="op">&lt;-</span> <span class="fu">CJ</span><span class="op">(</span>true_mean1 <span class="op">=</span> <span class="fl">13.4</span>, true_sd1 <span class="op">=</span> <span class="fl">4.6</span>,</span>
<span>                 true_mean2 <span class="op">=</span> <span class="fl">16.1</span>, true_sd2 <span class="op">=</span> <span class="fl">3.9</span>,</span>
<span>                 sample_size1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">scenario</span><span class="op">[</span>, <span class="va">sample_size2</span> <span class="op">:=</span> <span class="va">sample_size1</span><span class="op">]</span></span>
<span>  <span class="va">scenario</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>Key: &lt;true_mean1, true_sd1, true_mean2, true_sd2, sample_size1&gt;
   true_mean1 true_sd1 true_mean2 true_sd2 sample_size1 sample_size2
        &lt;num&gt;    &lt;num&gt;      &lt;num&gt;    &lt;num&gt;        &lt;num&gt;        &lt;num&gt;
1:       13.4      4.6       16.1      3.9            5            5
2:       13.4      4.6       16.1      3.9           10           10
3:       13.4      4.6       16.1      3.9          150          150</code></pre>
</div>
</div>
<p>Now let’s run this in a foreach loop. If you’d rather not run this on your machine, if <code>run</code> == FALSE, the code will just load the already finished simulation. Note that in this simulation, we’re evaluating SAFE estimates using only the ‘true’ values, instead of simulated data.</p>
<div class="cell">
<div class="sourceCode" id="cb43" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sub_scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clust_out</span> <span class="op">&lt;-</span> <span class="fu">prepare_cluster</span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>, </span>
<span>              .options.snow <span class="op">=</span> <span class="va">clust_out</span><span class="op">$</span><span class="va">options</span>,</span>
<span>             .errorhandling <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>             .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>,</span>
<span>                           <span class="st">"crayon"</span>, <span class="st">"tmvtnorm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">%dopar%</a></span> <span class="op">{</span></span>
<span></span>
<span> <span class="co"># Now calculate SAFE with 100 bootstraps                                         </span></span>
<span> <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_mean1</span>,</span>
<span>                 x2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                 sd1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_sd1</span>,</span>
<span>                 sd2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                 n1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                 n2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size2</span>,</span>
<span>                 effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                 SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 parallelize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 SAFE_boots <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> </span>
<span> </span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                         sample_size <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                         boots <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Now with 1000 bootstraps</span></span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_mean1</span>,</span>
<span>                 x2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                 sd1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_sd1</span>,</span>
<span>                 sd2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                 n1 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                 n2 <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size2</span>,</span>
<span>                 effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                 SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 parallelize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 SAFE_boots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">data.table</span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                         sample_size <span class="op">=</span> <span class="va">scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                         boots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>   </span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">rbindlist</span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">res.dt</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">res.dt</span>, <span class="st">"builds/dummy_bootstrap_simulation.Rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the dispersion of the SAFE estimates as a function of sample size and bootstrap length.</p>
<div class="cell">
<div class="sourceCode" id="cb44" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res.dt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>     yi_first  yi_second    vi_first   vi_second    yi_safe     vi_safe
        &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;      &lt;num&gt;       &lt;num&gt;
1: -0.1835646 -0.1776480 0.035304382 0.035650987 -0.1650154 0.035516549
2: -0.1835646 -0.1806063 0.017652191 0.017738842 -0.1807932 0.014147118
3: -0.1835646 -0.1833673 0.001176813 0.001177198 -0.1823932 0.001335037
4: -0.1835646 -0.1776480 0.035304382 0.035650987 -0.1771216 0.033641955
5: -0.1835646 -0.1806063 0.017652191 0.017738842 -0.1819732 0.017039825
6: -0.1835646 -0.1833673 0.001176813 0.001177198 -0.1827143 0.001237149
      SE_safe sample_size boots
        &lt;num&gt;       &lt;num&gt; &lt;num&gt;
1: 0.18845835           5   100
2: 0.11894166          10   100
3: 0.03653816         150   100
4: 0.18341743           5  1000
5: 0.13053668          10  1000
6: 0.03517312         150  1000</code></pre>
</div>
<div class="sourceCode" id="cb46" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, the point estimates:</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.dt</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">yi_safe</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">boots</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">boots</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>              position <span class="op">=</span> <span class="fu">position_jitterdodge</span><span class="op">(</span>dodge.width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"SAFE Point Estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_scico</span><span class="op">(</span><span class="st">"Number of SAFE bootstraps"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s look at the variance estimates:</p>
<div class="cell">
<div class="sourceCode" id="cb47" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.dt</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">vi_safe</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">boots</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">boots</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>              position <span class="op">=</span> <span class="fu">position_jitterdodge</span><span class="op">(</span>dodge.width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"SAFE Variance Estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_scico</span><span class="op">(</span><span class="st">"Number of SAFE bootstraps"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the dispersion in estimates is shaped by number of SAFE bootstraps and improves considerably with 1,000 bootstraps, especially at low sample sizes. Another way to visualize this (which we’ll use below in the proper 1e5 simulations) is to plot the standard deviation.</p>
<div class="cell">
<div class="sourceCode" id="cb48" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res.summary</span> <span class="op">&lt;-</span> <span class="va">res.dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>sd_point_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">yi_safe</span><span class="op">)</span>,</span>
<span>                       sd_variance_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">vi_safe</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">boots</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res.summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>   sample_size boots sd_point_estimate sd_variance_estimate
         &lt;num&gt; &lt;num&gt;             &lt;num&gt;                &lt;num&gt;
1:           5   100       0.020121458         5.480685e-03
2:          10   100       0.013661173         2.603266e-03
3:         150   100       0.003381441         1.651428e-04
4:           5  1000       0.005940034         1.862273e-03
5:          10  1000       0.004276895         8.471993e-04
6:         150  1000       0.001107589         5.273536e-05</code></pre>
</div>
<div class="sourceCode" id="cb50" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Let's melt this to make a single plot:</span></span>
<span><span class="va">res.summary.mlt</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">res.summary</span>,</span>
<span>                        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample_size"</span>, <span class="st">"boots"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res.summary.mlt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    sample_size boots             variable        value
          &lt;num&gt; &lt;num&gt;               &lt;fctr&gt;        &lt;num&gt;
 1:           5   100    sd_point_estimate 2.012146e-02
 2:          10   100    sd_point_estimate 1.366117e-02
 3:         150   100    sd_point_estimate 3.381441e-03
 4:           5  1000    sd_point_estimate 5.940034e-03
 5:          10  1000    sd_point_estimate 4.276895e-03
 6:         150  1000    sd_point_estimate 1.107589e-03
 7:           5   100 sd_variance_estimate 5.480685e-03
 8:          10   100 sd_variance_estimate 2.603266e-03
 9:         150   100 sd_variance_estimate 1.651428e-04
10:           5  1000 sd_variance_estimate 1.862273e-03
11:          10  1000 sd_variance_estimate 8.471993e-04
12:         150  1000 sd_variance_estimate 5.273536e-05</code></pre>
</div>
<div class="sourceCode" id="cb52" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">setorder</span><span class="op">(</span><span class="va">res.summary.mlt</span>, <span class="va">boots</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.summary.mlt</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">boots</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">sample_size</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="va">pt_size</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sd_point_estimate"</span> <span class="op">=</span> <span class="st">"Point estimate"</span>,</span>
<span>                                      <span class="st">"sd_variance_estimate"</span> <span class="op">=</span> <span class="st">"Variance estimate"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_scico</span><span class="op">(</span><span class="st">"Scenario sample size"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"SAFE bootstrap length"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Standard deviation of estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="bootstrap-scenario-results" class="level2"><h2 class="anchored" data-anchor-id="bootstrap-scenario-results">Bootstrap scenario results</h2>
<p>Now let’s look at the full Monte Carlo simulation results for the influence of bootstrap length.</p>
<div class="cell">
<div class="sourceCode" id="cb53" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"builds/all_scenarios_summarized.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="va">sim_results</span><span class="op">[</span><span class="va">calculation</span> <span class="op">==</span> <span class="st">"SD"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>               scenario_id true_mean true_sd sample_size boots effect_type
                    &lt;char&gt;     &lt;num&gt;   &lt;num&gt;       &lt;num&gt; &lt;num&gt;      &lt;char&gt;
1:  SMD_Wishart_scenario_1        NA      NA          NA    10 SMD_Wishart
2:  SMD_Wishart_scenario_1        NA      NA          NA    10 SMD_Wishart
3: SMD_Wishart_scenario_15        NA      NA          NA    10 SMD_Wishart
4: SMD_Wishart_scenario_15        NA      NA          NA    10 SMD_Wishart
5: SMD_Wishart_scenario_16        NA      NA          NA   100 SMD_Wishart
6: SMD_Wishart_scenario_16        NA      NA          NA   100 SMD_Wishart
   true_mean1 true_mean2 true_sd1 true_sd2 sample_size1 sample_size_ratio
        &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;        &lt;num&gt;             &lt;num&gt;
1:       13.4       16.1      4.6      3.9            5                 1
2:       13.4       16.1      4.6      3.9            5                 1
3:       13.4       16.1      4.6      3.9           50                 1
4:       13.4       16.1      4.6      3.9           50                 1
5:       13.4       16.1      4.6      3.9           50                 1
6:       13.4       16.1      4.6      3.9           50                 1
   sample_size2 true_p_a true_p_c    n1 n_ratio    n2 true_a true_c true_b
          &lt;num&gt;    &lt;num&gt;    &lt;num&gt; &lt;num&gt;   &lt;num&gt; &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;
1:            5       NA       NA    NA      NA    NA     NA     NA     NA
2:            5       NA       NA    NA      NA    NA     NA     NA     NA
3:           50       NA       NA    NA      NA    NA     NA     NA     NA
4:           50       NA       NA    NA      NA    NA     NA     NA     NA
5:           50       NA       NA    NA      NA    NA     NA     NA     NA
6:           50       NA       NA    NA      NA    NA     NA     NA     NA
   true_d  p_AA  p_Aa  p_aa     n true_n_AA true_n_Aa true_n_aa calculation
    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;      &lt;char&gt;
1:     NA    NA    NA    NA    NA        NA        NA        NA          SD
2:     NA    NA    NA    NA    NA        NA        NA        NA          SD
3:     NA    NA    NA    NA    NA        NA        NA        NA          SD
4:     NA    NA    NA    NA    NA        NA        NA        NA          SD
5:     NA    NA    NA    NA    NA        NA        NA        NA          SD
6:     NA    NA    NA    NA    NA        NA        NA        NA          SD
   estimator estimand estimate_of       value
      &lt;char&gt;   &lt;char&gt;      &lt;char&gt;       &lt;num&gt;
1:      safe       NA       point 0.241203294
2:      safe       NA    variance 0.382125853
3:      safe       NA       point 0.065245002
4:      safe       NA    variance 0.020474983
5:      safe       NA       point 0.020632306
6:      safe       NA    variance 0.006252113</code></pre>
</div>
</div>
<section id="speed-1" class="level3"><h3 class="anchored" data-anchor-id="speed-1">Speed</h3>
<p>Once again, here’s our novel effect size ‘speed’, 1 / x. How do our SAFE estimates of speed and its sampling variance change as we change the number of bootstraps?</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-4-multivariate-normal-1" class="level3"><h3 class="anchored" data-anchor-id="smd-4-multivariate-normal-1">SMD 4-multivariate normal</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-2-multivariate-normal-and-2-wishart-1" class="level3"><h3 class="anchored" data-anchor-id="smd-2-multivariate-normal-and-2-wishart-1">SMD 2-multivariate normal and 2-Wishart</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-4-multivariate-normal-1" class="level3"><h3 class="anchored" data-anchor-id="lncvr-4-multivariate-normal-1">lnCVR 4-multivariate normal</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-2-multivariate-normal-and-2-wishart-1" class="level3"><h3 class="anchored" data-anchor-id="lncvr-2-multivariate-normal-and-2-wishart-1">lnCVR 2-multivariate normal and 2-Wishart</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnor-1" class="level3"><h3 class="anchored" data-anchor-id="lnor-1">lnOR</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr-1" class="level3"><h3 class="anchored" data-anchor-id="lnrr-1">lnRR</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="hardy-weinberg-disequilibrium-1" class="level3"><h3 class="anchored" data-anchor-id="hardy-weinberg-disequilibrium-1">Hardy Weinberg Disequilibrium</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="introduction-to-SAFE_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->

</section></section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Introduction to SAFE"</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A step by step online tutorial"</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Shinichi Nakagawa</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ayumi Mizuno</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Santiago Ortega</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Daniel Noble</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Alistair Senior</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Erick J Lundgren</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: many others order TBD</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 6</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: true</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "**CONTENTS**"</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="co">    output-file: "index.html"</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co">    # embed-resources: true</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="co">    # code-fold: true</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="co">    # number-sections: false</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="co">    # bibliography: ./bib/ref.bib</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: "10"</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Helvetica"</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: "Fira Code"</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="co">    # fontcolor: ""</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: article</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="co">    df_print: paged</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="co">    code-line-numbers: false</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a><span class="co">      margin-width: 120px</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co"># crossref: </span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-title: Figure     # (default is "Figure")</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-title: Table     # (default is "Table")</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   title-delim: "—"     # (default is ":")</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-prefix: Fig.     # (default is "Figure")</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-prefix: Table.   # (default is "Table")</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a><span class="co">  tidy: true</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren\@gmail.com).</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>To run the code interactively (instead of just reading this lovely tutorial), do the following:</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Clone the github repo: https://github.com/ejlundgren/SAFE.git</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session or just follow along here on the web</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>**QUESTION: I prefer data.table() and I wrote everything in that function...I can convert to dplyr no problem though if people are that picky. Does anyone care?**</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load libraries</span></span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>The <span class="in">`groundhog`</span> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <span class="in">`groundhog`</span> if it is not already installed with <span class="in">`install.packages()`</span>.</span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, load_libraries}</span></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: load_libraries</span></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: true</span></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a><span class="in">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a><span class="in">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a><span class="in"># First, clean the environment:</span></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a><span class="in">rm(list = ls())</span></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a><span class="in"># Now load packages:</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a><span class="in"># install.packages("groundhog")</span></span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a><span class="in">library("groundhog")</span></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a><span class="in">groundhog.library(pkg = c("data.table", "MASS", "crayon", </span></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a><span class="in">                          "tmvtnorm", "here",</span></span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a><span class="in">                          "parallel", "foreach", "doSNOW",</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a><span class="in">                          "ggplot2", "patchwork", "scico"),</span></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a><span class="in">                  date = "2025-04-15")</span></span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a><span class="fu"># An introduction to SAFE bootstrapping</span></span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>SAFE bootstrapping is an incredible, seemingly magical, technique to calculate bias-corrected point estimates and sampling variance for effect sizes. SAFE bootstrapping is particularly useful for novel effect sizes for which sampling variance formulas may not be known. In some cases, it is also more unbiased than traditional plugin formulas for variance and point estimates.</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## How does it work?</span></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>With SAFE bootstrapping, one draws a cloud of *hyperparameters* of all variables used in an effect size formula. You then apply your effect size formula to this cloud. The variance of this transformed cloud is the sampling variance of your effect size! </span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>You can then calculate a bias-transformed point estimate by taking the mean of this transformed cloud and subtracting it from 2 times the point estimate derived from the original variables.</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>Let's demonstrate.</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a>Imagine you're conducting a meta-analysis of animal responses to an environmental stressor. Many studies are reporting data as mean 'latency time' (e.g., time until an animal runs). However, you want to create an effect size of 'speed' from latency time. This is simple: take the inverse of latency (<span class="in">`1/latency`</span>). Here let's start with three mean latency times and convert to our new 'speed' effect size</span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, speed_example}</span></span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: speed_example</span></span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a><span class="in"># The type of data summaries you might extract for a meta-analysis:</span></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a><span class="in">mean_latency &lt;- c(15, 30, 21)</span></span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a><span class="in">           n &lt;- c(25, 31, 50)</span></span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a><span class="in">          sd &lt;- c(4.6, 3.1, 2.5)</span></span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a><span class="in"># New effect size:</span></span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a><span class="in">1/mean_latency</span></span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>The effect size is trivial to calculate. But what is the sampling variance of this effect size, given that each of these measurements was associated with measurement sample size and standard deviation?</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>You could use calculus to derive a first-order sampling variance formula. Or you could use SAFE bootstrapping. </span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Draw hyperparameters.</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>If the word 'hyperparameter' is scary, what we mean is a distribution associated with the variables in our effect size formula, in this case mean <span class="in">`latency`</span>. </span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>This is different than drawing from a population based on mean and standard deviation, which will have a broad distribution, reflecting the underlying population. Instead, we're interested in drawing a distribution of the **means**—the hyperparameter of our effect size of interest. To do this, we draw from a normal distribution with **standard error of the mean** to describe dispersion.</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a>To convert our 'latency' time to our 'speed' effect size with SAFE, let's draw 10,000 samples of the mean latency hyperparameter from a normal distribution, with standard error as our <span class="in">`sd`</span>. To avoid using <span class="in">`lapply`</span> or loops, we'll just do this on a single latency time and associated standard deviation and sample size. </span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, speed_cloud}</span></span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: speed_cloud</span></span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a><span class="in"># Define the variables</span></span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a><span class="in"> x &lt;- 15  # The mean latency time</span></span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a><span class="in">sd &lt;- 4.6 # standard deviation of latency time</span></span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a><span class="in"> n &lt;- 25  # sample size, e.g., number of animals in the experiment</span></span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulate a cloud of hyperparameters</span></span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a><span class="in">cloud &lt;- rnorm(1e6,                  # number of samples</span></span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a><span class="in">               mean = x,             # mean latency time</span></span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a><span class="in">                 sd = sd / sqrt(n))  # standard error</span></span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a><span class="in"># Have a look a the cloud (distribution)</span></span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a><span class="in">head(cloud)</span></span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a><span class="in">hist(cloud)</span></span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-142"><a href="#cb55-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-143"><a href="#cb55-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Transform hyperparameters to target effect size</span></span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a>Now, let's transform this cloud of hyperparameters to 'speed' with our 'plugin' or definition formula <span class="in">`1/x`</span>. These values are centered on our original effect size, which we'll overlay in red</span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, speed_transform}</span></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: speed_transform</span></span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a><span class="in"># Transform the cloud to our effect size we want</span></span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a><span class="in">       cloud_trans &lt;- 1/cloud</span></span>
<span id="cb55-151"><a href="#cb55-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-152"><a href="#cb55-152" aria-hidden="true" tabindex="-1"></a><span class="in"># Our plugin effect size</span></span>
<span id="cb55-153"><a href="#cb55-153" aria-hidden="true" tabindex="-1"></a><span class="in">                 x &lt;- 15</span></span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a><span class="in">plugin_effect_size &lt;- 1/x</span></span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a><span class="in">plugin_effect_size</span></span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a><span class="in"># Our plugin effect size</span></span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a><span class="in">hist(cloud_trans, main = "Transformed hyperparameter cloud")</span></span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = plugin_effect_size, col = "red")</span></span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-161"><a href="#cb55-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-162"><a href="#cb55-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Calculate sampling variance</span></span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a>To calculate sampling variance, we'll simply calculate the variance of this transformed cloud. </span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-170"><a href="#cb55-170" aria-hidden="true" tabindex="-1"></a>safe_vi <span class="ot">&lt;-</span> <span class="fu">var</span>(cloud_trans)</span>
<span id="cb55-171"><a href="#cb55-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a>safe_vi</span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-174"><a href="#cb55-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-175"><a href="#cb55-175" aria-hidden="true" tabindex="-1"></a>Voila! Sampling variance for a novel effect size. Pretty magical right?</span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Calculate bias-corrected effect size</span></span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a>However, given low sample sizes for some measurements, and the knowledge that point estimates can be biased at low N, let's also calculate a bias-corrected point estimate from this cloud of hyperparameters:</span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a>**It'd be nice to explain the logic here better...without formulas haha**</span>
<span id="cb55-182"><a href="#cb55-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a>safe_yi <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> plugin_effect_size) <span class="sc">-</span> <span class="fu">mean</span>(cloud_trans)</span>
<span id="cb55-187"><a href="#cb55-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-188"><a href="#cb55-188" aria-hidden="true" tabindex="-1"></a>safe_yi</span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-191"><a href="#cb55-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-192"><a href="#cb55-192" aria-hidden="true" tabindex="-1"></a>Let's compare this to the original point estimate:</span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a>safe_yi</span>
<span id="cb55-198"><a href="#cb55-198" aria-hidden="true" tabindex="-1"></a>plugin_effect_size</span>
<span id="cb55-199"><a href="#cb55-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a>So similar! And potentially less biased. Let's find out. Below, we'll use Monte Carlo simulations to compare the bias of estimates from SAFE to estimates from just plugging into a formula. But first, let's introduce a helpful function for calculating SAFE for a variety of effect sizes.</span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load encapsulated functions</span></span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let's load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at scripts/SAFE_function.R. This function returns a data.table (basically a *fast* data.frame) with columns for plugin effect sizes and sampling variances (denoted with <span class="in">`_first`</span> or <span class="in">`_second`</span> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <span class="in">`_safe`</span>). Point estimates (effect sizes) are denoted with <span class="in">`yi_`</span> while sampling variances are denoted with <span class="in">`vi_`</span>.</span>
<span id="cb55-206"><a href="#cb55-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/SAFE_function.R"</span>)</span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a><span class="co"># For a single effect size and sampling variance:</span></span>
<span id="cb55-217"><a href="#cb55-217" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fl">14.5</span>, <span class="at">x2 =</span> <span class="fl">7.9</span>, </span>
<span id="cb55-218"><a href="#cb55-218" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fl">1.3</span>, <span class="at">sd2 =</span> <span class="dv">2</span>,</span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="dv">20</span>, <span class="at">n2 =</span> <span class="dv">20</span>, </span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-225"><a href="#cb55-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-226"><a href="#cb55-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a>The function also works with a vector of raw data:</span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-231"><a href="#cb55-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-232"><a href="#cb55-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">14.5</span>, <span class="dv">13</span>, <span class="fl">15.8</span>), </span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">7.9</span>, <span class="dv">21</span>, <span class="fl">18.4</span>), </span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fu">c</span>(<span class="fl">1.3</span>, <span class="dv">2</span>, <span class="fl">1.9</span>), </span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd2 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span>),</span>
<span id="cb55-240"><a href="#cb55-240" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), </span>
<span id="cb55-241"><a href="#cb55-241" aria-hidden="true" tabindex="-1"></a>         <span class="at">n2 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">18</span>), </span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"SMD"</span>,</span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a>         <span class="at">parallelize =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a>For a full list of options that eff_size can calculate, run:</span>
<span id="cb55-251"><a href="#cb55-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>()</span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-262"><a href="#cb55-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-263"><a href="#cb55-263" aria-hidden="true" tabindex="-1"></a><span class="fu"># How good is SAFE?</span></span>
<span id="cb55-264"><a href="#cb55-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-265"><a href="#cb55-265" aria-hidden="true" tabindex="-1"></a>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size and the number of SAFE bootstraps. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let's look at the simulations for lnRoM:</span>
<span id="cb55-266"><a href="#cb55-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/scenarios.Rds"</span>)</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset scenarios:</span></span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a>guide <span class="ot">&lt;-</span> scenarios[effect_type <span class="sc">==</span> <span class="st">"lnRoM"</span> <span class="sc">&amp;</span></span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a>                     boots <span class="sc">==</span> <span class="fl">1e6</span>, ]</span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a>guide[, .(effect_type, scenario_id, boots,</span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a>                   true_mean1, true_mean2, </span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a>                   true_sd1, true_sd2,</span>
<span id="cb55-283"><a href="#cb55-283" aria-hidden="true" tabindex="-1"></a>                   sample_size1, sample_size2)]</span>
<span id="cb55-284"><a href="#cb55-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the 'true' values and based on the simulated dataset. We did this 1e5 times for each scenario.</span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a>In these Monte Carlo simulation, we were interested in bias, or the difference between the 'true' estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We'll explain the difference between estimands, estimators, and estimates below.</span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a>To illustrate, we'll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we'll only run 100 simulations.</span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a>To speed things up we will do this in parallel. The function <span class="in">`prepare_cluster()`</span> below can help set things up, including a progress bar so you don't lose your mind wondering what's going on in there.</span>
<span id="cb55-294"><a href="#cb55-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare cluster:</span></span>
<span id="cb55-305"><a href="#cb55-305" aria-hidden="true" tabindex="-1"></a>prepare_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb55-306"><a href="#cb55-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"parallel"</span>)</span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"foreach"</span>)</span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"doSNOW"</span>)</span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a>    nCores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a>    cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(nCores)</span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Progress bar</span></span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a>    pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">max =</span> n, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb55-316"><a href="#cb55-316" aria-hidden="true" tabindex="-1"></a>    progress <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="fu">setTxtProgressBar</span>(pb, n)</span>
<span id="cb55-317"><a href="#cb55-317" aria-hidden="true" tabindex="-1"></a>    opts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">progress =</span> progress)</span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="fu">list</span>(opts, pb, cl)</span>
<span id="cb55-319"><a href="#cb55-319" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(ret) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span>)</span>
<span id="cb55-320"><a href="#cb55-320" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span>)</span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized below. The first part of this code (inside the <span class="in">`lapply`</span>) creates simulated data based on 'true' means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the 'true' values and simulated values. Note that even with only 100 iterations, this can take a minute, so feel free to load the already run dummy dataset in the next code block.</span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-336"><a href="#cb55-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-337"><a href="#cb55-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a>rerun <span class="ot">&lt;-</span> F</span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(rerun){</span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a>  monte_carlo_N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a>  clust_out <span class="ot">&lt;-</span> <span class="fu">prepare_cluster</span>(<span class="at">n =</span> monte_carlo_N)</span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>monte_carlo_N, </span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a>         <span class="at">.options.snow =</span> clust_out<span class="sc">$</span>options,</span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a>         <span class="at">.errorhandling =</span> <span class="st">"pass"</span>,</span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a>         <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate 'true' values from scenario:</span></span>
<span id="cb55-352"><a href="#cb55-352" aria-hidden="true" tabindex="-1"></a>   true_point <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> guide<span class="sc">$</span>true_mean1, <span class="at">x2 =</span> guide<span class="sc">$</span>true_mean2,</span>
<span id="cb55-353"><a href="#cb55-353" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sd1 =</span> guide<span class="sc">$</span>true_sd1,  <span class="at">sd2 =</span> guide<span class="sc">$</span>true_sd2,</span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a>                          <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(true_point,</span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span>))</span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb55-365"><a href="#cb55-365" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span id="cb55-366"><a href="#cb55-366" aria-hidden="true" tabindex="-1"></a>   sim_dat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(guide), <span class="cf">function</span>(x){</span>
<span id="cb55-367"><a href="#cb55-367" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb55-368"><a href="#cb55-368" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Simulate data for guide</span></span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a>     sig <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">c</span>(guide<span class="sc">$</span>true_sd1[x]<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a>                   guide<span class="sc">$</span>true_sd2[x]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a>     means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">m1 =</span> guide<span class="sc">$</span>true_mean1[x],</span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a>                <span class="at">m2 =</span> guide<span class="sc">$</span>true_mean2[x])</span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a>     y <span class="ot">&lt;-</span> <span class="fu">rtmvnorm</span>(<span class="at">n =</span> <span class="fu">max</span>(<span class="fu">c</span>(guide<span class="sc">$</span>sample_size1[x], guide<span class="sc">$</span>sample_size2[x])),</span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> means,</span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma =</span> sig,</span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lower =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(means)),</span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a>                     <span class="at">upper =</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, <span class="fu">length</span>(means)),</span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>                     <span class="at">algorithm =</span> <span class="st">"gibbs"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a>       <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a>       <span class="fu">setDT</span>()</span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a>     <span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m1"</span>, <span class="st">"m2"</span>)</span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Filter to number of samples per treatment</span></span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x1 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size1[x], ]<span class="sc">$</span>m1,</span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x2 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size2[x], ]<span class="sc">$</span>m2)</span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">sim_mean1 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_mean2 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd1 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd2 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sample_size1 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sample_size2 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x2))</span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>(sim_dat)</span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>   }) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>()</span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb55-398"><a href="#cb55-398" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-399"><a href="#cb55-399" aria-hidden="true" tabindex="-1"></a>   out <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> sim_dat<span class="sc">$</span>sim_mean1, <span class="at">x2 =</span> sim_dat<span class="sc">$</span>sim_mean2,</span>
<span id="cb55-400"><a href="#cb55-400" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd1 =</span> sim_dat<span class="sc">$</span>sim_sd1,  <span class="at">sd2 =</span> sim_dat<span class="sc">$</span>sim_sd2,</span>
<span id="cb55-401"><a href="#cb55-401" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a>                   <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a>                   <span class="at">parallelize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(out,</span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span>))</span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb55-413"><a href="#cb55-413" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Store results:</span></span>
<span id="cb55-414"><a href="#cb55-414" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> <span class="fu">data.table</span>(guide,</span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a>                         sim_dat,</span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a>                         true_point,</span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a>                         out)</span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setTxtProgressBar</span>(clust_out<span class="sc">$</span>progress, i)</span>
<span id="cb55-420"><a href="#cb55-420" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb55-421"><a href="#cb55-421" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(results)</span>
<span id="cb55-422"><a href="#cb55-422" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-423"><a href="#cb55-423" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-424"><a href="#cb55-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopCluster</span>(clust_out<span class="sc">$</span>cluster)</span>
<span id="cb55-425"><a href="#cb55-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-426"><a href="#cb55-426" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(res)  </span>
<span id="cb55-427"><a href="#cb55-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(res)</span>
<span id="cb55-428"><a href="#cb55-428" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-429"><a href="#cb55-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-430"><a href="#cb55-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-431"><a href="#cb55-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-432"><a href="#cb55-432" aria-hidden="true" tabindex="-1"></a>Or just load the full simulation (1e5) here:</span>
<span id="cb55-433"><a href="#cb55-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-436"><a href="#cb55-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-437"><a href="#cb55-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-438"><a href="#cb55-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-439"><a href="#cb55-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-440"><a href="#cb55-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-441"><a href="#cb55-441" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/lnRoM_simulation.Rds"</span>)</span>
<span id="cb55-442"><a href="#cb55-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-443"><a href="#cb55-443" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res, <span class="dv">3</span>)</span>
<span id="cb55-444"><a href="#cb55-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-445"><a href="#cb55-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-446"><a href="#cb55-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-447"><a href="#cb55-447" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate bias</span></span>
<span id="cb55-448"><a href="#cb55-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-449"><a href="#cb55-449" aria-hidden="true" tabindex="-1"></a>To interpret the simulation results, it is essential to understand the difference between *estimands*, *estimators*, and *estimates*.</span>
<span id="cb55-450"><a href="#cb55-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-451"><a href="#cb55-451" aria-hidden="true" tabindex="-1"></a>**Estimands** are the 'true' value.</span>
<span id="cb55-452"><a href="#cb55-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-453"><a href="#cb55-453" aria-hidden="true" tabindex="-1"></a>**Estimators** are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges' g) to reduce bias, and the SAFE method.</span>
<span id="cb55-454"><a href="#cb55-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-455"><a href="#cb55-455" aria-hidden="true" tabindex="-1"></a>**Estimates** are the estimates of the estimands produced by the estimators 🤠</span>
<span id="cb55-456"><a href="#cb55-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-457"><a href="#cb55-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect size (point estimate) bias</span></span>
<span id="cb55-458"><a href="#cb55-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-459"><a href="#cb55-459" aria-hidden="true" tabindex="-1"></a>In the case of our effect sizes, there are two estimands that we're interested in estimating: the 'true' effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the 'true' values).</span>
<span id="cb55-460"><a href="#cb55-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-461"><a href="#cb55-461" aria-hidden="true" tabindex="-1"></a>Here we will calculate bias in our estimates of effect sizes:</span>
<span id="cb55-462"><a href="#cb55-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-465"><a href="#cb55-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-466"><a href="#cb55-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-467"><a href="#cb55-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-468"><a href="#cb55-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-469"><a href="#cb55-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-470"><a href="#cb55-470" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates, estimand){</span>
<span id="cb55-471"><a href="#cb55-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand))</span>
<span id="cb55-472"><a href="#cb55-472" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-473"><a href="#cb55-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-474"><a href="#cb55-474" aria-hidden="true" tabindex="-1"></a>point.bias <span class="ot">&lt;-</span> res[, .(<span class="at">plugin_1st =</span> <span class="fu">bias</span>(sim_y_plugin_1st, true_y_plugin_1st),</span>
<span id="cb55-475"><a href="#cb55-475" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plugin_2nd =</span> <span class="fu">bias</span>(sim_y_plugin_2nd, true_y_plugin_1st),</span>
<span id="cb55-476"><a href="#cb55-476" aria-hidden="true" tabindex="-1"></a>                      <span class="at">safe =</span> <span class="fu">bias</span>(yi_safe, true_y_plugin_1st)),</span>
<span id="cb55-477"><a href="#cb55-477" aria-hidden="true" tabindex="-1"></a>                  by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb55-478"><a href="#cb55-478" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias)</span>
<span id="cb55-479"><a href="#cb55-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-480"><a href="#cb55-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt this to make it plottable:</span></span>
<span id="cb55-481"><a href="#cb55-481" aria-hidden="true" tabindex="-1"></a>point.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(point.bias,</span>
<span id="cb55-482"><a href="#cb55-482" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>),</span>
<span id="cb55-483"><a href="#cb55-483" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value.name =</span> <span class="st">"bias"</span>,</span>
<span id="cb55-484"><a href="#cb55-484" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.name =</span> <span class="st">"estimator"</span>)</span>
<span id="cb55-485"><a href="#cb55-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-486"><a href="#cb55-486" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias.long)</span>
<span id="cb55-487"><a href="#cb55-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-488"><a href="#cb55-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by sample size </span></span>
<span id="cb55-489"><a href="#cb55-489" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(point.bias.long, sample_size1)</span>
<span id="cb55-490"><a href="#cb55-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-491"><a href="#cb55-491" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> point.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ],</span>
<span id="cb55-492"><a href="#cb55-492" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> bias, <span class="at">color =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-493"><a href="#cb55-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-494"><a href="#cb55-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-495"><a href="#cb55-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-496"><a href="#cb55-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Bias"</span>)<span class="sc">+</span></span>
<span id="cb55-497"><a href="#cb55-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb55-498"><a href="#cb55-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb55-499"><a href="#cb55-499" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"1st order plugin</span><span class="sc">\n</span><span class="st">(definition formula)"</span>,</span>
<span id="cb55-500"><a href="#cb55-500" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"2nd order plugin</span><span class="sc">\n</span><span class="st">(bias-corrected formula)"</span>,</span>
<span id="cb55-501"><a href="#cb55-501" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>),</span>
<span id="cb55-502"><a href="#cb55-502" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb55-503"><a href="#cb55-503" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb55-504"><a href="#cb55-504" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>))<span class="sc">+</span></span>
<span id="cb55-505"><a href="#cb55-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-506"><a href="#cb55-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-507"><a href="#cb55-507" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-508"><a href="#cb55-508" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-509"><a href="#cb55-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-510"><a href="#cb55-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-511"><a href="#cb55-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-512"><a href="#cb55-512" aria-hidden="true" tabindex="-1"></a>This indicates that the least biased estimator is the first order definition formula (light blue). SAFE (red) and the 2nd order plugin (navy blue) perform similarly. These bias values are incredibly small, indicating that all options are fair, except for at low sample sizes, when the first-order definition formula is quite biased.</span>
<span id="cb55-513"><a href="#cb55-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-514"><a href="#cb55-514" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling variance bias</span></span>
<span id="cb55-515"><a href="#cb55-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-516"><a href="#cb55-516" aria-hidden="true" tabindex="-1"></a>Interestingly, there is no way to know the 'true' estimand for sampling variance. **WHICH I DON'T FULLY UNDERSTAND**. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use *each* of these as the estimand. With 3 estimators, and thus 3 estimands, we'll thus end up with 9 calculations of bias.</span>
<span id="cb55-517"><a href="#cb55-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-518"><a href="#cb55-518" aria-hidden="true" tabindex="-1"></a>Since we're interested in relative bias (**Not entirely sure why**), we'll calculate bias as above but divide by the estimand and multiply by 100.</span>
<span id="cb55-519"><a href="#cb55-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-522"><a href="#cb55-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-523"><a href="#cb55-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-524"><a href="#cb55-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-525"><a href="#cb55-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-526"><a href="#cb55-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-527"><a href="#cb55-527" aria-hidden="true" tabindex="-1"></a><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span id="cb55-528"><a href="#cb55-528" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_1st <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_1st), </span>
<span id="cb55-529"><a href="#cb55-529" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb55-530"><a href="#cb55-530" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_2nd <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_2nd), </span>
<span id="cb55-531"><a href="#cb55-531" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb55-532"><a href="#cb55-532" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_SAFE <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(yi_safe), </span>
<span id="cb55-533"><a href="#cb55-533" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb55-534"><a href="#cb55-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-535"><a href="#cb55-535" aria-hidden="true" tabindex="-1"></a><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span id="cb55-536"><a href="#cb55-536" aria-hidden="true" tabindex="-1"></a>relative_bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates,</span>
<span id="cb55-537"><a href="#cb55-537" aria-hidden="true" tabindex="-1"></a>                          estimand){</span>
<span id="cb55-538"><a href="#cb55-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(((<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand)) <span class="sc">/</span> estimand) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb55-539"><a href="#cb55-539" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-540"><a href="#cb55-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-541"><a href="#cb55-541" aria-hidden="true" tabindex="-1"></a><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span id="cb55-542"><a href="#cb55-542" aria-hidden="true" tabindex="-1"></a>var.bias <span class="ot">&lt;-</span> res[, .(<span class="at">SAFE_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_1st),</span>
<span id="cb55-543"><a href="#cb55-543" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_2nd),</span>
<span id="cb55-544"><a href="#cb55-544" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_SAFE),</span>
<span id="cb55-545"><a href="#cb55-545" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_1st),</span>
<span id="cb55-546"><a href="#cb55-546" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_2nd),</span>
<span id="cb55-547"><a href="#cb55-547" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_SAFE),</span>
<span id="cb55-548"><a href="#cb55-548" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_1st),</span>
<span id="cb55-549"><a href="#cb55-549" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_2nd),</span>
<span id="cb55-550"><a href="#cb55-550" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_SAFE)),</span>
<span id="cb55-551"><a href="#cb55-551" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb55-552"><a href="#cb55-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-553"><a href="#cb55-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-554"><a href="#cb55-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Now melt:</span></span>
<span id="cb55-555"><a href="#cb55-555" aria-hidden="true" tabindex="-1"></a>var.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(var.bias,</span>
<span id="cb55-556"><a href="#cb55-556" aria-hidden="true" tabindex="-1"></a>                      <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>))</span>
<span id="cb55-557"><a href="#cb55-557" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(var.bias.long)</span>
<span id="cb55-558"><a href="#cb55-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-559"><a href="#cb55-559" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span id="cb55-560"><a href="#cb55-560" aria-hidden="true" tabindex="-1"></a>var.bias.long[, <span class="fu">c</span>(<span class="st">"Estimator"</span>, <span class="st">"Estimand"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable, <span class="st">"."</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb55-561"><a href="#cb55-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-562"><a href="#cb55-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataset by sample size</span></span>
<span id="cb55-563"><a href="#cb55-563" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(var.bias.long, sample_size1)</span>
<span id="cb55-564"><a href="#cb55-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-565"><a href="#cb55-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb55-566"><a href="#cb55-566" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> var.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ], </span>
<span id="cb55-567"><a href="#cb55-567" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> Estimator))<span class="sc">+</span></span>
<span id="cb55-568"><a href="#cb55-568" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-569"><a href="#cb55-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-570"><a href="#cb55-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-571"><a href="#cb55-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Relative bias (%)"</span>)<span class="sc">+</span></span>
<span id="cb55-572"><a href="#cb55-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb55-573"><a href="#cb55-573" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_estimate"</span> <span class="ot">=</span> <span class="st">"1st order plugin</span><span class="sc">\n</span><span class="st">(definition formula)"</span>,</span>
<span id="cb55-574"><a href="#cb55-574" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="ot">=</span> <span class="st">"2nd order plugin</span><span class="sc">\n</span><span class="st">(bias-corrected formula)"</span>,</span>
<span id="cb55-575"><a href="#cb55-575" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"SAFE_estimate"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>),</span>
<span id="cb55-576"><a href="#cb55-576" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_estimate"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb55-577"><a href="#cb55-577" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"plugin_2nd_estimate"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb55-578"><a href="#cb55-578" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"SAFE_estimate"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>))<span class="sc">+</span></span>
<span id="cb55-579"><a href="#cb55-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Estimand,</span>
<span id="cb55-580"><a href="#cb55-580" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-581"><a href="#cb55-581" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"1st_estimand"</span> <span class="ot">=</span> <span class="st">"1st order plugin estimand</span><span class="sc">\n</span><span class="st">(definition formula)"</span>,</span>
<span id="cb55-582"><a href="#cb55-582" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"2nd_estimand"</span> <span class="ot">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span id="cb55-583"><a href="#cb55-583" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"SAFE_estimand"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>)))<span class="sc">+</span></span>
<span id="cb55-584"><a href="#cb55-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-585"><a href="#cb55-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-586"><a href="#cb55-586" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-587"><a href="#cb55-587" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-588"><a href="#cb55-588" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-589"><a href="#cb55-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-590"><a href="#cb55-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-591"><a href="#cb55-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-592"><a href="#cb55-592" aria-hidden="true" tabindex="-1"></a>We see here that SAFE (red) is slightly more biased, but in a conservative direction, than the other estimators.</span>
<span id="cb55-593"><a href="#cb55-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-594"><a href="#cb55-594" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot all simulations results</span></span>
<span id="cb55-595"><a href="#cb55-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-596"><a href="#cb55-596" aria-hidden="true" tabindex="-1"></a>Now let's look at the rest of the simulation results.</span>
<span id="cb55-597"><a href="#cb55-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-600"><a href="#cb55-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-601"><a href="#cb55-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb55-602"><a href="#cb55-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-603"><a href="#cb55-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-604"><a href="#cb55-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-605"><a href="#cb55-605" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/all_scenarios_summarized.Rds"</span>)</span>
<span id="cb55-606"><a href="#cb55-606" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> sim_results[boots <span class="sc">==</span> <span class="fl">1e5</span>, ]</span>
<span id="cb55-607"><a href="#cb55-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-608"><a href="#cb55-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-609"><a href="#cb55-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-610"><a href="#cb55-610" aria-hidden="true" tabindex="-1"></a><span class="fu"># **These are plotting 1e5 right now...Rerunning 1e6. Will update soon**</span></span>
<span id="cb55-611"><a href="#cb55-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Speed</span></span>
<span id="cb55-612"><a href="#cb55-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-613"><a href="#cb55-613" aria-hidden="true" tabindex="-1"></a>This was our dummy effect size in the beginning. How do the point and variance estimates calculated by SAFE compare to just calculating 1 / x for point estimates? </span>
<span id="cb55-614"><a href="#cb55-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-615"><a href="#cb55-615" aria-hidden="true" tabindex="-1"></a>We compared the variance estimates from SAFE to variance estimates produced by a 1st-order derivative sampling variance formula derived with the delta method (denoted as 1st order plugin here). Let's see which did better!</span>
<span id="cb55-616"><a href="#cb55-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-619"><a href="#cb55-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-620"><a href="#cb55-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-621"><a href="#cb55-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-622"><a href="#cb55-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-623"><a href="#cb55-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-624"><a href="#cb55-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-625"><a href="#cb55-625" aria-hidden="true" tabindex="-1"></a>var_lab <span class="ot">&lt;-</span> <span class="st">"Relative bias of</span><span class="sc">\n</span><span class="st">variance estimates (%)"</span></span>
<span id="cb55-626"><a href="#cb55-626" aria-hidden="true" tabindex="-1"></a>point_lab <span class="ot">&lt;-</span> <span class="st">"Bias of point</span><span class="sc">\n</span><span class="st">estimates"</span></span>
<span id="cb55-627"><a href="#cb55-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-628"><a href="#cb55-628" aria-hidden="true" tabindex="-1"></a>theme_SAFE <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-629"><a href="#cb55-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-630"><a href="#cb55-630" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb55-631"><a href="#cb55-631" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb55-632"><a href="#cb55-632" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-633"><a href="#cb55-633" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb55-634"><a href="#cb55-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-635"><a href="#cb55-635" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"1st order plugin"</span>,</span>
<span id="cb55-636"><a href="#cb55-636" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"2nd order plugin"</span>,</span>
<span id="cb55-637"><a href="#cb55-637" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE"</span>)</span>
<span id="cb55-638"><a href="#cb55-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-639"><a href="#cb55-639" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb55-640"><a href="#cb55-640" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb55-641"><a href="#cb55-641" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>)</span>
<span id="cb55-642"><a href="#cb55-642" aria-hidden="true" tabindex="-1"></a>pt_size <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb55-643"><a href="#cb55-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-644"><a href="#cb55-644" aria-hidden="true" tabindex="-1"></a>facet_labs <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"1st order estimand"</span>,</span>
<span id="cb55-645"><a href="#cb55-645" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span id="cb55-646"><a href="#cb55-646" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>))</span>
<span id="cb55-647"><a href="#cb55-647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-648"><a href="#cb55-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-649"><a href="#cb55-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-652"><a href="#cb55-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-653"><a href="#cb55-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-654"><a href="#cb55-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-655"><a href="#cb55-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-656"><a href="#cb55-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-657"><a href="#cb55-657" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"reciprocal"</span>, ]</span>
<span id="cb55-658"><a href="#cb55-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-659"><a href="#cb55-659" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size)</span>
<span id="cb55-660"><a href="#cb55-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-661"><a href="#cb55-661" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb55-662"><a href="#cb55-662" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-663"><a href="#cb55-663" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-664"><a href="#cb55-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-665"><a href="#cb55-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-666"><a href="#cb55-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-667"><a href="#cb55-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-668"><a href="#cb55-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-669"><a href="#cb55-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-670"><a href="#cb55-670" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-671"><a href="#cb55-671" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-672"><a href="#cb55-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-673"><a href="#cb55-673" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-674"><a href="#cb55-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.0003</span>, <span class="fl">0.0003</span>))<span class="sc">+</span></span>
<span id="cb55-675"><a href="#cb55-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Speed (1 / x)"</span>)<span class="sc">+</span></span>
<span id="cb55-676"><a href="#cb55-676" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-677"><a href="#cb55-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-678"><a href="#cb55-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-679"><a href="#cb55-679" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb55-680"><a href="#cb55-680" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-681"><a href="#cb55-681" aria-hidden="true" tabindex="-1"></a>                 <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-682"><a href="#cb55-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-683"><a href="#cb55-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-684"><a href="#cb55-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-685"><a href="#cb55-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-686"><a href="#cb55-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-687"><a href="#cb55-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-688"><a href="#cb55-688" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-689"><a href="#cb55-689" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-690"><a href="#cb55-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-691"><a href="#cb55-691" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs,</span>
<span id="cb55-692"><a href="#cb55-692" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb55-693"><a href="#cb55-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb55-694"><a href="#cb55-694" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-695"><a href="#cb55-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-696"><a href="#cb55-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-697"><a href="#cb55-697" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb55-698"><a href="#cb55-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-699"><a href="#cb55-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-700"><a href="#cb55-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-701"><a href="#cb55-701" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 4-multivariate normal</span></span>
<span id="cb55-702"><a href="#cb55-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-703"><a href="#cb55-703" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with 4 multivariate normal distributions for both mean and SD, as both of these parameters are in the definition formula (Cohen's d) of SMD. Let's compare the bias of SAFE, Cohen's d, and Hedges' g.</span>
<span id="cb55-704"><a href="#cb55-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-705"><a href="#cb55-705" aria-hidden="true" tabindex="-1"></a>**Need to add explanation of 4-normal versus 2-normal/2-Wishart**</span>
<span id="cb55-706"><a href="#cb55-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-709"><a href="#cb55-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-710"><a href="#cb55-710" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-711"><a href="#cb55-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-712"><a href="#cb55-712" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-713"><a href="#cb55-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-714"><a href="#cb55-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-715"><a href="#cb55-715" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_normal"</span>, ]</span>
<span id="cb55-716"><a href="#cb55-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-717"><a href="#cb55-717" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb55-718"><a href="#cb55-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-719"><a href="#cb55-719" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb55-720"><a href="#cb55-720" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-721"><a href="#cb55-721" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-722"><a href="#cb55-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-723"><a href="#cb55-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-724"><a href="#cb55-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-725"><a href="#cb55-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-726"><a href="#cb55-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-727"><a href="#cb55-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD"</span>, <span class="at">subtitle=</span> <span class="st">"4-multivariate normal"</span>)<span class="sc">+</span></span>
<span id="cb55-728"><a href="#cb55-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-729"><a href="#cb55-729" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-730"><a href="#cb55-730" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-731"><a href="#cb55-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-732"><a href="#cb55-732" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"Cohen's d estimand"</span>)))<span class="sc">+</span></span>
<span id="cb55-733"><a href="#cb55-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb55-734"><a href="#cb55-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD"</span>)<span class="sc">+</span></span>
<span id="cb55-735"><a href="#cb55-735" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-736"><a href="#cb55-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-737"><a href="#cb55-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-738"><a href="#cb55-738" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-739"><a href="#cb55-739" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb55-740"><a href="#cb55-740" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-741"><a href="#cb55-741" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-742"><a href="#cb55-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-743"><a href="#cb55-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-744"><a href="#cb55-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-745"><a href="#cb55-745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-746"><a href="#cb55-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-747"><a href="#cb55-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-748"><a href="#cb55-748" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-749"><a href="#cb55-749" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">plugin_1st =</span> <span class="st">"Cohen's d"</span>, </span>
<span id="cb55-750"><a href="#cb55-750" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plugin_2nd =</span> <span class="st">"Hedges' g"</span>, </span>
<span id="cb55-751"><a href="#cb55-751" aria-hidden="true" tabindex="-1"></a>                                <span class="at">safe =</span> <span class="st">"SAFE"</span>))<span class="sc">+</span></span>
<span id="cb55-752"><a href="#cb55-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb55-753"><a href="#cb55-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-754"><a href="#cb55-754" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-755"><a href="#cb55-755" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"Cohen's d estimand"</span>,</span>
<span id="cb55-756"><a href="#cb55-756" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"Hedges' g estimand"</span>,</span>
<span id="cb55-757"><a href="#cb55-757" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>)))<span class="sc">+</span></span>
<span id="cb55-758"><a href="#cb55-758" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-759"><a href="#cb55-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-760"><a href="#cb55-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-761"><a href="#cb55-761" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-762"><a href="#cb55-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-763"><a href="#cb55-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-764"><a href="#cb55-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-765"><a href="#cb55-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 2-multivariate normal and 2-Wishart</span></span>
<span id="cb55-766"><a href="#cb55-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-767"><a href="#cb55-767" aria-hidden="true" tabindex="-1"></a>With this estimator, the SAFE calculation used the normal distribution to simulate the two means but the Wishart distribution to estimate the SD. </span>
<span id="cb55-768"><a href="#cb55-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-771"><a href="#cb55-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-773"><a href="#cb55-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-774"><a href="#cb55-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-775"><a href="#cb55-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-776"><a href="#cb55-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-777"><a href="#cb55-777" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_Wishart"</span>, ]</span>
<span id="cb55-778"><a href="#cb55-778" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb55-779"><a href="#cb55-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-780"><a href="#cb55-780" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb55-781"><a href="#cb55-781" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-782"><a href="#cb55-782" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-783"><a href="#cb55-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-784"><a href="#cb55-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-785"><a href="#cb55-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-786"><a href="#cb55-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-787"><a href="#cb55-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-788"><a href="#cb55-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>,</span>
<span id="cb55-789"><a href="#cb55-789" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-790"><a href="#cb55-790" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-791"><a href="#cb55-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb55-792"><a href="#cb55-792" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"Cohen's d estimand"</span>)))<span class="sc">+</span></span>
<span id="cb55-793"><a href="#cb55-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb55-794"><a href="#cb55-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD"</span>, <span class="at">subtitle=</span> <span class="st">"2-multivariate normal, 2-multivariate Wishart"</span>)<span class="sc">+</span></span>
<span id="cb55-795"><a href="#cb55-795" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-796"><a href="#cb55-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb55-797"><a href="#cb55-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-798"><a href="#cb55-798" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-799"><a href="#cb55-799" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb55-800"><a href="#cb55-800" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-801"><a href="#cb55-801" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-802"><a href="#cb55-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-803"><a href="#cb55-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-804"><a href="#cb55-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-805"><a href="#cb55-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-806"><a href="#cb55-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-807"><a href="#cb55-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>,</span>
<span id="cb55-808"><a href="#cb55-808" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-809"><a href="#cb55-809" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">plugin_1st =</span> <span class="st">"Cohen's d"</span>,</span>
<span id="cb55-810"><a href="#cb55-810" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plugin_2nd =</span> <span class="st">"Hedges' g"</span>,</span>
<span id="cb55-811"><a href="#cb55-811" aria-hidden="true" tabindex="-1"></a>                                <span class="at">safe =</span> <span class="st">"SAFE"</span>))<span class="sc">+</span></span>
<span id="cb55-812"><a href="#cb55-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb55-813"><a href="#cb55-813" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-814"><a href="#cb55-814" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"Cohen's d estimand"</span>,</span>
<span id="cb55-815"><a href="#cb55-815" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"Hedges' g estimand"</span>,</span>
<span id="cb55-816"><a href="#cb55-816" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>)))<span class="sc">+</span></span>
<span id="cb55-817"><a href="#cb55-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">60</span>))<span class="sc">+</span></span>
<span id="cb55-818"><a href="#cb55-818" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-819"><a href="#cb55-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-820"><a href="#cb55-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-821"><a href="#cb55-821" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-822"><a href="#cb55-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-823"><a href="#cb55-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-824"><a href="#cb55-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-825"><a href="#cb55-825" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 4-multivariate normal</span></span>
<span id="cb55-826"><a href="#cb55-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-827"><a href="#cb55-827" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with 4 multivariate normal distributions for both mean and SD.</span>
<span id="cb55-828"><a href="#cb55-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-831"><a href="#cb55-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-832"><a href="#cb55-832" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-833"><a href="#cb55-833" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-834"><a href="#cb55-834" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-835"><a href="#cb55-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-836"><a href="#cb55-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-837"><a href="#cb55-837" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_normal"</span>, ]</span>
<span id="cb55-838"><a href="#cb55-838" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb55-839"><a href="#cb55-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-840"><a href="#cb55-840" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb55-841"><a href="#cb55-841" aria-hidden="true" tabindex="-1"></a>                                   sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb55-842"><a href="#cb55-842" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-843"><a href="#cb55-843" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-844"><a href="#cb55-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-845"><a href="#cb55-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-846"><a href="#cb55-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-847"><a href="#cb55-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-848"><a href="#cb55-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-849"><a href="#cb55-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-850"><a href="#cb55-850" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-851"><a href="#cb55-851" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-852"><a href="#cb55-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-853"><a href="#cb55-853" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-854"><a href="#cb55-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb55-855"><a href="#cb55-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR"</span>, <span class="at">subtitle =</span> <span class="st">"4-multivariate normal"</span>)<span class="sc">+</span></span>
<span id="cb55-856"><a href="#cb55-856" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-857"><a href="#cb55-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-858"><a href="#cb55-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-859"><a href="#cb55-859" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-860"><a href="#cb55-860" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb55-861"><a href="#cb55-861" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-862"><a href="#cb55-862" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-863"><a href="#cb55-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-864"><a href="#cb55-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-865"><a href="#cb55-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-866"><a href="#cb55-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-867"><a href="#cb55-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-868"><a href="#cb55-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-869"><a href="#cb55-869" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-870"><a href="#cb55-870" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-871"><a href="#cb55-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-872"><a href="#cb55-872" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-873"><a href="#cb55-873" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-874"><a href="#cb55-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb55-875"><a href="#cb55-875" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-876"><a href="#cb55-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-877"><a href="#cb55-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-878"><a href="#cb55-878" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-879"><a href="#cb55-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-880"><a href="#cb55-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-881"><a href="#cb55-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-882"><a href="#cb55-882" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 2-multivariate normal and 2-Wishart</span></span>
<span id="cb55-883"><a href="#cb55-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-884"><a href="#cb55-884" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with 2-multivariate normal distribution for the means and 2-Wishart distributions for the SD.</span>
<span id="cb55-885"><a href="#cb55-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-886"><a href="#cb55-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-889"><a href="#cb55-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-890"><a href="#cb55-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-891"><a href="#cb55-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-892"><a href="#cb55-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-893"><a href="#cb55-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-894"><a href="#cb55-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-895"><a href="#cb55-895" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_Wishart"</span>, ]</span>
<span id="cb55-896"><a href="#cb55-896" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb55-897"><a href="#cb55-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-898"><a href="#cb55-898" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span></span>
<span id="cb55-899"><a href="#cb55-899" aria-hidden="true" tabindex="-1"></a>                                   sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb55-900"><a href="#cb55-900" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-901"><a href="#cb55-901" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-902"><a href="#cb55-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-903"><a href="#cb55-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-904"><a href="#cb55-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-905"><a href="#cb55-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-906"><a href="#cb55-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-907"><a href="#cb55-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>,</span>
<span id="cb55-908"><a href="#cb55-908" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-909"><a href="#cb55-909" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-910"><a href="#cb55-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">0.02</span>))<span class="sc">+</span></span>
<span id="cb55-911"><a href="#cb55-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb55-912"><a href="#cb55-912" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-913"><a href="#cb55-913" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"lnCVR"</span>, <span class="at">subtitle =</span> <span class="st">"2-multivariate normal, 2-multivariate Wishart"</span>)<span class="sc">+</span></span>
<span id="cb55-914"><a href="#cb55-914" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-915"><a href="#cb55-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-916"><a href="#cb55-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-917"><a href="#cb55-917" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-918"><a href="#cb55-918" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ],</span>
<span id="cb55-919"><a href="#cb55-919" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-920"><a href="#cb55-920" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-921"><a href="#cb55-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-922"><a href="#cb55-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-923"><a href="#cb55-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-924"><a href="#cb55-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-925"><a href="#cb55-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-926"><a href="#cb55-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>,</span>
<span id="cb55-927"><a href="#cb55-927" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-928"><a href="#cb55-928" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-929"><a href="#cb55-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb55-930"><a href="#cb55-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb55-931"><a href="#cb55-931" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-932"><a href="#cb55-932" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-933"><a href="#cb55-933" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-934"><a href="#cb55-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-935"><a href="#cb55-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-936"><a href="#cb55-936" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-937"><a href="#cb55-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-938"><a href="#cb55-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-939"><a href="#cb55-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-940"><a href="#cb55-940" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR</span></span>
<span id="cb55-941"><a href="#cb55-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-942"><a href="#cb55-942" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for 'a' and 'c'.</span>
<span id="cb55-943"><a href="#cb55-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-946"><a href="#cb55-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-947"><a href="#cb55-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-948"><a href="#cb55-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-949"><a href="#cb55-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-950"><a href="#cb55-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-951"><a href="#cb55-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-952"><a href="#cb55-952" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR"</span>, ]</span>
<span id="cb55-953"><a href="#cb55-953" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n1)</span>
<span id="cb55-954"><a href="#cb55-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-955"><a href="#cb55-955" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb55-956"><a href="#cb55-956" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-957"><a href="#cb55-957" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-958"><a href="#cb55-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-959"><a href="#cb55-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-960"><a href="#cb55-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-961"><a href="#cb55-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-962"><a href="#cb55-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-963"><a href="#cb55-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-964"><a href="#cb55-964" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-965"><a href="#cb55-965" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-966"><a href="#cb55-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb55-967"><a href="#cb55-967" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-968"><a href="#cb55-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>, .<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb55-969"><a href="#cb55-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>)<span class="sc">+</span></span>
<span id="cb55-970"><a href="#cb55-970" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-971"><a href="#cb55-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-972"><a href="#cb55-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-973"><a href="#cb55-973" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-974"><a href="#cb55-974" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb55-975"><a href="#cb55-975" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-976"><a href="#cb55-976" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-977"><a href="#cb55-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-978"><a href="#cb55-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-979"><a href="#cb55-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-980"><a href="#cb55-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-981"><a href="#cb55-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-982"><a href="#cb55-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-983"><a href="#cb55-983" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-984"><a href="#cb55-984" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-985"><a href="#cb55-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-986"><a href="#cb55-986" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-987"><a href="#cb55-987" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-988"><a href="#cb55-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb55-989"><a href="#cb55-989" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-990"><a href="#cb55-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-991"><a href="#cb55-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-992"><a href="#cb55-992" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-993"><a href="#cb55-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-994"><a href="#cb55-994" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-995"><a href="#cb55-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-996"><a href="#cb55-996" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR</span></span>
<span id="cb55-997"><a href="#cb55-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-998"><a href="#cb55-998" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'a' and 'c' from a binomial distribution.</span>
<span id="cb55-999"><a href="#cb55-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1002"><a href="#cb55-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1003"><a href="#cb55-1003" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1004"><a href="#cb55-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-1005"><a href="#cb55-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1006"><a href="#cb55-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1007"><a href="#cb55-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1008"><a href="#cb55-1008" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR"</span>, ]</span>
<span id="cb55-1009"><a href="#cb55-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n1)</span>
<span id="cb55-1010"><a href="#cb55-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1011"><a href="#cb55-1011" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) , ], </span>
<span id="cb55-1012"><a href="#cb55-1012" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-1013"><a href="#cb55-1013" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-1014"><a href="#cb55-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-1015"><a href="#cb55-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1016"><a href="#cb55-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1017"><a href="#cb55-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-1018"><a href="#cb55-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1019"><a href="#cb55-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-1020"><a href="#cb55-1020" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-1021"><a href="#cb55-1021" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-1022"><a href="#cb55-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-1023"><a href="#cb55-1023" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1024"><a href="#cb55-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb55-1025"><a href="#cb55-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>)<span class="sc">+</span></span>
<span id="cb55-1026"><a href="#cb55-1026" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1027"><a href="#cb55-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-1028"><a href="#cb55-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1029"><a href="#cb55-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-1030"><a href="#cb55-1030" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb55-1031"><a href="#cb55-1031" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-1032"><a href="#cb55-1032" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-1033"><a href="#cb55-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-1034"><a href="#cb55-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1035"><a href="#cb55-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1036"><a href="#cb55-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-1037"><a href="#cb55-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1038"><a href="#cb55-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-1039"><a href="#cb55-1039" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-1040"><a href="#cb55-1040" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-1041"><a href="#cb55-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-1042"><a href="#cb55-1042" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-1043"><a href="#cb55-1043" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1044"><a href="#cb55-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb55-1045"><a href="#cb55-1045" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1046"><a href="#cb55-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1047"><a href="#cb55-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1048"><a href="#cb55-1048" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-1049"><a href="#cb55-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1050"><a href="#cb55-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1051"><a href="#cb55-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1052"><a href="#cb55-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hardy Weinberg Disequilibrium</span></span>
<span id="cb55-1053"><a href="#cb55-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1054"><a href="#cb55-1054" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'n_AA', 'n_Aa', and 'n_aa' from a binomial distribution.</span>
<span id="cb55-1055"><a href="#cb55-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1058"><a href="#cb55-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1059"><a href="#cb55-1059" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1060"><a href="#cb55-1060" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb55-1061"><a href="#cb55-1061" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1062"><a href="#cb55-1062" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1063"><a href="#cb55-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1064"><a href="#cb55-1064" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnHWE_A"</span>, ]</span>
<span id="cb55-1065"><a href="#cb55-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n)</span>
<span id="cb55-1066"><a href="#cb55-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1067"><a href="#cb55-1067" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb55-1068"><a href="#cb55-1068" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-1069"><a href="#cb55-1069" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-1070"><a href="#cb55-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-1071"><a href="#cb55-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1072"><a href="#cb55-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1073"><a href="#cb55-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb55-1074"><a href="#cb55-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1075"><a href="#cb55-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-1076"><a href="#cb55-1076" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-1077"><a href="#cb55-1077" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-1078"><a href="#cb55-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-1079"><a href="#cb55-1079" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1080"><a href="#cb55-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb55-1081"><a href="#cb55-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hardy-Weinburg Disequilibrium"</span>)<span class="sc">+</span></span>
<span id="cb55-1082"><a href="#cb55-1082" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1083"><a href="#cb55-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb55-1084"><a href="#cb55-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1085"><a href="#cb55-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb55-1086"><a href="#cb55-1086" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb55-1087"><a href="#cb55-1087" aria-hidden="true" tabindex="-1"></a>                                   p_AA <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_aa <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_Aa <span class="sc">==</span> <span class="fl">0.5</span>, ], </span>
<span id="cb55-1088"><a href="#cb55-1088" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb55-1089"><a href="#cb55-1089" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb55-1090"><a href="#cb55-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb55-1091"><a href="#cb55-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1092"><a href="#cb55-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1093"><a href="#cb55-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb55-1094"><a href="#cb55-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1095"><a href="#cb55-1095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb55-1096"><a href="#cb55-1096" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb55-1097"><a href="#cb55-1097" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb55-1098"><a href="#cb55-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb55-1099"><a href="#cb55-1099" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb55-1100"><a href="#cb55-1100" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1101"><a href="#cb55-1101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb55-1102"><a href="#cb55-1102" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1103"><a href="#cb55-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1104"><a href="#cb55-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1105"><a href="#cb55-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1106"><a href="#cb55-1106" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb55-1107"><a href="#cb55-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1108"><a href="#cb55-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1109"><a href="#cb55-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1110"><a href="#cb55-1110" aria-hidden="true" tabindex="-1"></a><span class="fu"># How many SAFE bootstraps?</span></span>
<span id="cb55-1111"><a href="#cb55-1111" aria-hidden="true" tabindex="-1"></a>The SAFE method relies on bootstrapping to calculate effect size point estimates and sampling variance. It's sort of magical how well it works! But, how many bootstraps are necessary? Let's find out by doing another Monte Carlo simulation, again of lnRoM. This time, instead of calculating bias, we'll look at the standard deviation of the point and sampling variance estimates as we change the number of bootstraps.</span>
<span id="cb55-1112"><a href="#cb55-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1113"><a href="#cb55-1113" aria-hidden="true" tabindex="-1"></a>Let's choose two bootstrap lengths: 100 and 1,000. We'll run a simulation 1,000 times just to make this easy. (See below for full 1e5 simulation results)</span>
<span id="cb55-1114"><a href="#cb55-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1117"><a href="#cb55-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1118"><a href="#cb55-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1119"><a href="#cb55-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1120"><a href="#cb55-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1121"><a href="#cb55-1121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create some scenarios based on combinations of sample size and boot-length</span></span>
<span id="cb55-1122"><a href="#cb55-1122" aria-hidden="true" tabindex="-1"></a>  scenario <span class="ot">&lt;-</span> <span class="fu">CJ</span>(<span class="at">true_mean1 =</span> <span class="fl">13.4</span>, <span class="at">true_sd1 =</span> <span class="fl">4.6</span>,</span>
<span id="cb55-1123"><a href="#cb55-1123" aria-hidden="true" tabindex="-1"></a>                 <span class="at">true_mean2 =</span> <span class="fl">16.1</span>, <span class="at">true_sd2 =</span> <span class="fl">3.9</span>,</span>
<span id="cb55-1124"><a href="#cb55-1124" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sample_size1 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">150</span>))</span>
<span id="cb55-1125"><a href="#cb55-1125" aria-hidden="true" tabindex="-1"></a>  scenario[, sample_size2 <span class="sc">:</span><span class="er">=</span> sample_size1]</span>
<span id="cb55-1126"><a href="#cb55-1126" aria-hidden="true" tabindex="-1"></a>  scenario</span>
<span id="cb55-1127"><a href="#cb55-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1128"><a href="#cb55-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1129"><a href="#cb55-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1130"><a href="#cb55-1130" aria-hidden="true" tabindex="-1"></a>Now let's run this in a foreach loop. If you'd rather not run this on your machine, if <span class="in">`run`</span> == FALSE, the code will just load the already finished simulation. Note that in this simulation, we're evaluating SAFE estimates using only the 'true' values, instead of simulated data.</span>
<span id="cb55-1131"><a href="#cb55-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1134"><a href="#cb55-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1135"><a href="#cb55-1135" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-1136"><a href="#cb55-1136" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1137"><a href="#cb55-1137" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1138"><a href="#cb55-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1139"><a href="#cb55-1139" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-1140"><a href="#cb55-1140" aria-hidden="true" tabindex="-1"></a>sub_scenario <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb55-1141"><a href="#cb55-1141" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb55-1142"><a href="#cb55-1142" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-1143"><a href="#cb55-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1144"><a href="#cb55-1144" aria-hidden="true" tabindex="-1"></a>clust_out <span class="ot">&lt;-</span> <span class="fu">prepare_cluster</span>(<span class="at">n =</span> N)</span>
<span id="cb55-1145"><a href="#cb55-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1146"><a href="#cb55-1146" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>N, </span>
<span id="cb55-1147"><a href="#cb55-1147" aria-hidden="true" tabindex="-1"></a>              <span class="at">.options.snow =</span> clust_out<span class="sc">$</span>options,</span>
<span id="cb55-1148"><a href="#cb55-1148" aria-hidden="true" tabindex="-1"></a>             <span class="at">.errorhandling =</span> <span class="st">"stop"</span>,</span>
<span id="cb55-1149"><a href="#cb55-1149" aria-hidden="true" tabindex="-1"></a>             <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>,</span>
<span id="cb55-1150"><a href="#cb55-1150" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"crayon"</span>, <span class="st">"tmvtnorm"</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb55-1151"><a href="#cb55-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1152"><a href="#cb55-1152" aria-hidden="true" tabindex="-1"></a> <span class="co"># Now calculate SAFE with 100 bootstraps                                         </span></span>
<span id="cb55-1153"><a href="#cb55-1153" aria-hidden="true" tabindex="-1"></a> out[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> scenario<span class="sc">$</span>true_mean1,</span>
<span id="cb55-1154"><a href="#cb55-1154" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x2 =</span> scenario<span class="sc">$</span>true_mean2,</span>
<span id="cb55-1155"><a href="#cb55-1155" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd1 =</span> scenario<span class="sc">$</span>true_sd1,</span>
<span id="cb55-1156"><a href="#cb55-1156" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd2 =</span> scenario<span class="sc">$</span>true_sd2,</span>
<span id="cb55-1157"><a href="#cb55-1157" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n1 =</span> scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb55-1158"><a href="#cb55-1158" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n2 =</span> scenario<span class="sc">$</span>sample_size2,</span>
<span id="cb55-1159"><a href="#cb55-1159" aria-hidden="true" tabindex="-1"></a>                 <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb55-1160"><a href="#cb55-1160" aria-hidden="true" tabindex="-1"></a>                 <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-1161"><a href="#cb55-1161" aria-hidden="true" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-1162"><a href="#cb55-1162" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallelize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-1163"><a href="#cb55-1163" aria-hidden="true" tabindex="-1"></a>                 <span class="at">SAFE_boots =</span> <span class="dv">100</span>) </span>
<span id="cb55-1164"><a href="#cb55-1164" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb55-1165"><a href="#cb55-1165" aria-hidden="true" tabindex="-1"></a>  out[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.table</span>(out[[<span class="dv">1</span>]],</span>
<span id="cb55-1166"><a href="#cb55-1166" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sample_size =</span> scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb55-1167"><a href="#cb55-1167" aria-hidden="true" tabindex="-1"></a>                         <span class="at">boots =</span> <span class="dv">100</span>)</span>
<span id="cb55-1168"><a href="#cb55-1168" aria-hidden="true" tabindex="-1"></a>  out[[<span class="dv">1</span>]]</span>
<span id="cb55-1169"><a href="#cb55-1169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-1170"><a href="#cb55-1170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now with 1000 bootstraps</span></span>
<span id="cb55-1171"><a href="#cb55-1171" aria-hidden="true" tabindex="-1"></a>  out[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> scenario<span class="sc">$</span>true_mean1,</span>
<span id="cb55-1172"><a href="#cb55-1172" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x2 =</span> scenario<span class="sc">$</span>true_mean2,</span>
<span id="cb55-1173"><a href="#cb55-1173" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd1 =</span> scenario<span class="sc">$</span>true_sd1,</span>
<span id="cb55-1174"><a href="#cb55-1174" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd2 =</span> scenario<span class="sc">$</span>true_sd2,</span>
<span id="cb55-1175"><a href="#cb55-1175" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n1 =</span> scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb55-1176"><a href="#cb55-1176" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n2 =</span> scenario<span class="sc">$</span>sample_size2,</span>
<span id="cb55-1177"><a href="#cb55-1177" aria-hidden="true" tabindex="-1"></a>                 <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb55-1178"><a href="#cb55-1178" aria-hidden="true" tabindex="-1"></a>                 <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-1179"><a href="#cb55-1179" aria-hidden="true" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-1180"><a href="#cb55-1180" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallelize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-1181"><a href="#cb55-1181" aria-hidden="true" tabindex="-1"></a>                 <span class="at">SAFE_boots =</span> <span class="dv">1000</span>) </span>
<span id="cb55-1182"><a href="#cb55-1182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-1183"><a href="#cb55-1183" aria-hidden="true" tabindex="-1"></a>  out[[<span class="dv">2</span>]] <span class="ot">&lt;-</span>  <span class="fu">data.table</span>(out[[<span class="dv">2</span>]],</span>
<span id="cb55-1184"><a href="#cb55-1184" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sample_size =</span> scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb55-1185"><a href="#cb55-1185" aria-hidden="true" tabindex="-1"></a>                         <span class="at">boots =</span> <span class="dv">1000</span>)</span>
<span id="cb55-1186"><a href="#cb55-1186" aria-hidden="true" tabindex="-1"></a>  out[[<span class="dv">2</span>]]   </span>
<span id="cb55-1187"><a href="#cb55-1187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-1188"><a href="#cb55-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbindlist</span>(out))</span>
<span id="cb55-1189"><a href="#cb55-1189" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-1190"><a href="#cb55-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1191"><a href="#cb55-1191" aria-hidden="true" tabindex="-1"></a>res.dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(res)</span>
<span id="cb55-1192"><a href="#cb55-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1193"><a href="#cb55-1193" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(res.dt, <span class="st">"builds/dummy_bootstrap_simulation.Rds"</span>)</span>
<span id="cb55-1194"><a href="#cb55-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1195"><a href="#cb55-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1196"><a href="#cb55-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1199"><a href="#cb55-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1200"><a href="#cb55-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1201"><a href="#cb55-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1202"><a href="#cb55-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1203"><a href="#cb55-1203" aria-hidden="true" tabindex="-1"></a>res.dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/dummy_bootstrap_simulation.Rds"</span>)</span>
<span id="cb55-1204"><a href="#cb55-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1205"><a href="#cb55-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1206"><a href="#cb55-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1207"><a href="#cb55-1207" aria-hidden="true" tabindex="-1"></a>Let's look at the dispersion of the SAFE estimates as a function of sample size and bootstrap length.</span>
<span id="cb55-1208"><a href="#cb55-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1211"><a href="#cb55-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1212"><a href="#cb55-1212" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1213"><a href="#cb55-1213" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1214"><a href="#cb55-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1215"><a href="#cb55-1215" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res.dt)</span>
<span id="cb55-1216"><a href="#cb55-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1217"><a href="#cb55-1217" aria-hidden="true" tabindex="-1"></a><span class="co"># First, the point estimates:</span></span>
<span id="cb55-1218"><a href="#cb55-1218" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.dt, </span>
<span id="cb55-1219"><a href="#cb55-1219" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(sample_size), <span class="at">y =</span> yi_safe, </span>
<span id="cb55-1220"><a href="#cb55-1220" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> boots,</span>
<span id="cb55-1221"><a href="#cb55-1221" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size, boots)))<span class="sc">+</span></span>
<span id="cb55-1222"><a href="#cb55-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb55-1223"><a href="#cb55-1223" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">dodge.width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb55-1224"><a href="#cb55-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb55-1225"><a href="#cb55-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"SAFE Point Estimate"</span>)<span class="sc">+</span></span>
<span id="cb55-1226"><a href="#cb55-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Scenario sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1227"><a href="#cb55-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_scico</span>(<span class="st">"Number of SAFE bootstraps"</span>,</span>
<span id="cb55-1228"><a href="#cb55-1228" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1229"><a href="#cb55-1229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-1230"><a href="#cb55-1230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1231"><a href="#cb55-1231" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1232"><a href="#cb55-1232" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1233"><a href="#cb55-1233" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1234"><a href="#cb55-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1235"><a href="#cb55-1235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1236"><a href="#cb55-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1237"><a href="#cb55-1237" aria-hidden="true" tabindex="-1"></a>Now let's look at the variance estimates:</span>
<span id="cb55-1238"><a href="#cb55-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1241"><a href="#cb55-1241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1242"><a href="#cb55-1242" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1243"><a href="#cb55-1243" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1244"><a href="#cb55-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1245"><a href="#cb55-1245" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.dt, </span>
<span id="cb55-1246"><a href="#cb55-1246" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(sample_size), <span class="at">y =</span> vi_safe, </span>
<span id="cb55-1247"><a href="#cb55-1247" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> boots,</span>
<span id="cb55-1248"><a href="#cb55-1248" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size, boots)))<span class="sc">+</span></span>
<span id="cb55-1249"><a href="#cb55-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb55-1250"><a href="#cb55-1250" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">dodge.width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb55-1251"><a href="#cb55-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb55-1252"><a href="#cb55-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"SAFE Variance Estimate"</span>)<span class="sc">+</span></span>
<span id="cb55-1253"><a href="#cb55-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Scenario sample size"</span>)<span class="sc">+</span></span>
<span id="cb55-1254"><a href="#cb55-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_scico</span>(<span class="st">"Number of SAFE bootstraps"</span>,</span>
<span id="cb55-1255"><a href="#cb55-1255" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1256"><a href="#cb55-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-1257"><a href="#cb55-1257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1258"><a href="#cb55-1258" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1259"><a href="#cb55-1259" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1260"><a href="#cb55-1260" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1261"><a href="#cb55-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1262"><a href="#cb55-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1263"><a href="#cb55-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1264"><a href="#cb55-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1265"><a href="#cb55-1265" aria-hidden="true" tabindex="-1"></a>Looks like the dispersion in estimates is shaped by number of SAFE bootstraps and improves considerably with 1,000 bootstraps, especially at low sample sizes. Another way to visualize this (which we'll use below in the proper 1e5 simulations) is to plot the standard deviation.</span>
<span id="cb55-1266"><a href="#cb55-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1269"><a href="#cb55-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1270"><a href="#cb55-1270" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1271"><a href="#cb55-1271" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1272"><a href="#cb55-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1273"><a href="#cb55-1273" aria-hidden="true" tabindex="-1"></a>res.summary <span class="ot">&lt;-</span> res.dt[, .(<span class="at">sd_point_estimate =</span> <span class="fu">sd</span>(yi_safe),</span>
<span id="cb55-1274"><a href="#cb55-1274" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sd_variance_estimate =</span> <span class="fu">sd</span>(vi_safe)),</span>
<span id="cb55-1275"><a href="#cb55-1275" aria-hidden="true" tabindex="-1"></a>                   by <span class="ot">=</span> .(sample_size, boots)]</span>
<span id="cb55-1276"><a href="#cb55-1276" aria-hidden="true" tabindex="-1"></a>res.summary</span>
<span id="cb55-1277"><a href="#cb55-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1278"><a href="#cb55-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's melt this to make a single plot:</span></span>
<span id="cb55-1279"><a href="#cb55-1279" aria-hidden="true" tabindex="-1"></a>res.summary.mlt <span class="ot">&lt;-</span> <span class="fu">melt</span>(res.summary,</span>
<span id="cb55-1280"><a href="#cb55-1280" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"sample_size"</span>, <span class="st">"boots"</span>))</span>
<span id="cb55-1281"><a href="#cb55-1281" aria-hidden="true" tabindex="-1"></a>res.summary.mlt</span>
<span id="cb55-1282"><a href="#cb55-1282" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(res.summary.mlt, boots)</span>
<span id="cb55-1283"><a href="#cb55-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1284"><a href="#cb55-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.summary.mlt,</span>
<span id="cb55-1285"><a href="#cb55-1285" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, <span class="at">color =</span> sample_size,</span>
<span id="cb55-1286"><a href="#cb55-1286" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size)))<span class="sc">+</span></span>
<span id="cb55-1287"><a href="#cb55-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb55-1288"><a href="#cb55-1288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1289"><a href="#cb55-1289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable,</span>
<span id="cb55-1290"><a href="#cb55-1290" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1291"><a href="#cb55-1291" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"sd_point_estimate"</span> <span class="ot">=</span> <span class="st">"Point estimate"</span>,</span>
<span id="cb55-1292"><a href="#cb55-1292" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd_variance_estimate"</span> <span class="ot">=</span> <span class="st">"Variance estimate"</span>)))<span class="sc">+</span></span>
<span id="cb55-1293"><a href="#cb55-1293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="st">"Scenario sample size"</span>,</span>
<span id="cb55-1294"><a href="#cb55-1294" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1295"><a href="#cb55-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1296"><a href="#cb55-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standard deviation of estimate"</span>)<span class="sc">+</span></span>
<span id="cb55-1297"><a href="#cb55-1297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-1298"><a href="#cb55-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1299"><a href="#cb55-1299" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1300"><a href="#cb55-1300" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1301"><a href="#cb55-1301" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1302"><a href="#cb55-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1303"><a href="#cb55-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1304"><a href="#cb55-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1305"><a href="#cb55-1305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bootstrap scenario results</span></span>
<span id="cb55-1306"><a href="#cb55-1306" aria-hidden="true" tabindex="-1"></a>Now let's look at the full Monte Carlo simulation results for the influence of bootstrap length.</span>
<span id="cb55-1307"><a href="#cb55-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1310"><a href="#cb55-1310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1311"><a href="#cb55-1311" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb55-1312"><a href="#cb55-1312" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1313"><a href="#cb55-1313" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1314"><a href="#cb55-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1315"><a href="#cb55-1315" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/all_scenarios_summarized.Rds"</span>)</span>
<span id="cb55-1316"><a href="#cb55-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1317"><a href="#cb55-1317" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> sim_results[calculation <span class="sc">==</span> <span class="st">"SD"</span>, ]</span>
<span id="cb55-1318"><a href="#cb55-1318" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_results)</span>
<span id="cb55-1319"><a href="#cb55-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1320"><a href="#cb55-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1321"><a href="#cb55-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1322"><a href="#cb55-1322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Speed</span></span>
<span id="cb55-1323"><a href="#cb55-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1324"><a href="#cb55-1324" aria-hidden="true" tabindex="-1"></a>Once again, here's our novel effect size 'speed', 1 / x. How do our SAFE estimates of speed and its sampling variance change as we change the number of bootstraps?</span>
<span id="cb55-1325"><a href="#cb55-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1328"><a href="#cb55-1328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1329"><a href="#cb55-1329" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1330"><a href="#cb55-1330" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1331"><a href="#cb55-1331" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1332"><a href="#cb55-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1333"><a href="#cb55-1333" aria-hidden="true" tabindex="-1"></a>y_lab <span class="ot">&lt;-</span> <span class="st">"Standard deviation of estimate"</span></span>
<span id="cb55-1334"><a href="#cb55-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1335"><a href="#cb55-1335" aria-hidden="true" tabindex="-1"></a>theme_SAFE <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb55-1336"><a href="#cb55-1336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1337"><a href="#cb55-1337" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb55-1338"><a href="#cb55-1338" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb55-1339"><a href="#cb55-1339" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-1340"><a href="#cb55-1340" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb55-1341"><a href="#cb55-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1342"><a href="#cb55-1342" aria-hidden="true" tabindex="-1"></a>facet_labs <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"point"</span> <span class="ot">=</span> <span class="st">"Point estimate"</span>,</span>
<span id="cb55-1343"><a href="#cb55-1343" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"variance"</span> <span class="ot">=</span> <span class="st">"Variance estimate"</span>))</span>
<span id="cb55-1344"><a href="#cb55-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1345"><a href="#cb55-1345" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"reciprocal"</span>, ]</span>
<span id="cb55-1346"><a href="#cb55-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1347"><a href="#cb55-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1348"><a href="#cb55-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1349"><a href="#cb55-1349" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1350"><a href="#cb55-1350" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1351"><a href="#cb55-1351" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size,</span>
<span id="cb55-1352"><a href="#cb55-1352" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size))<span class="sc">+</span></span>
<span id="cb55-1353"><a href="#cb55-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1354"><a href="#cb55-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1355"><a href="#cb55-1355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1356"><a href="#cb55-1356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1357"><a href="#cb55-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1358"><a href="#cb55-1358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1359"><a href="#cb55-1359" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1360"><a href="#cb55-1360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1361"><a href="#cb55-1361" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1362"><a href="#cb55-1362" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1363"><a href="#cb55-1363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Speed (1 / x)"</span>)<span class="sc">+</span></span>
<span id="cb55-1364"><a href="#cb55-1364" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1365"><a href="#cb55-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1366"><a href="#cb55-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1367"><a href="#cb55-1367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1368"><a href="#cb55-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1369"><a href="#cb55-1369" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 4-multivariate normal</span></span>
<span id="cb55-1370"><a href="#cb55-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1371"><a href="#cb55-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1374"><a href="#cb55-1374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1375"><a href="#cb55-1375" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1376"><a href="#cb55-1376" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1377"><a href="#cb55-1377" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1378"><a href="#cb55-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1379"><a href="#cb55-1379" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_normal"</span>, ]</span>
<span id="cb55-1380"><a href="#cb55-1380" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1381"><a href="#cb55-1381" aria-hidden="true" tabindex="-1"></a><span class="co"># sub_dat</span></span>
<span id="cb55-1382"><a href="#cb55-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1383"><a href="#cb55-1383" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1384"><a href="#cb55-1384" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1385"><a href="#cb55-1385" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb55-1386"><a href="#cb55-1386" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb55-1387"><a href="#cb55-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1388"><a href="#cb55-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1389"><a href="#cb55-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1390"><a href="#cb55-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1391"><a href="#cb55-1391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1392"><a href="#cb55-1392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1393"><a href="#cb55-1393" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1394"><a href="#cb55-1394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1395"><a href="#cb55-1395" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1396"><a href="#cb55-1396" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1397"><a href="#cb55-1397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (4-multivariate normal SAFE distribution)"</span>)<span class="sc">+</span></span>
<span id="cb55-1398"><a href="#cb55-1398" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1399"><a href="#cb55-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1400"><a href="#cb55-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1401"><a href="#cb55-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1402"><a href="#cb55-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1403"><a href="#cb55-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 2-multivariate normal and 2-Wishart</span></span>
<span id="cb55-1404"><a href="#cb55-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1405"><a href="#cb55-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1408"><a href="#cb55-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1409"><a href="#cb55-1409" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1410"><a href="#cb55-1410" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1411"><a href="#cb55-1411" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1412"><a href="#cb55-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1413"><a href="#cb55-1413" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_Wishart"</span>, ]</span>
<span id="cb55-1414"><a href="#cb55-1414" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1415"><a href="#cb55-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1416"><a href="#cb55-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1417"><a href="#cb55-1417" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1418"><a href="#cb55-1418" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb55-1419"><a href="#cb55-1419" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb55-1420"><a href="#cb55-1420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1421"><a href="#cb55-1421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1422"><a href="#cb55-1422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1423"><a href="#cb55-1423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1424"><a href="#cb55-1424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1425"><a href="#cb55-1425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1426"><a href="#cb55-1426" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1427"><a href="#cb55-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1428"><a href="#cb55-1428" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1429"><a href="#cb55-1429" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1430"><a href="#cb55-1430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (2-multivariate normal, 2-Wishart)"</span>)<span class="sc">+</span></span>
<span id="cb55-1431"><a href="#cb55-1431" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1432"><a href="#cb55-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1433"><a href="#cb55-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1434"><a href="#cb55-1434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1435"><a href="#cb55-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1436"><a href="#cb55-1436" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 4-multivariate normal</span></span>
<span id="cb55-1437"><a href="#cb55-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1438"><a href="#cb55-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1441"><a href="#cb55-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1442"><a href="#cb55-1442" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1443"><a href="#cb55-1443" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1444"><a href="#cb55-1444" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1445"><a href="#cb55-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1446"><a href="#cb55-1446" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_normal"</span>, ]</span>
<span id="cb55-1447"><a href="#cb55-1447" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1448"><a href="#cb55-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1449"><a href="#cb55-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1450"><a href="#cb55-1450" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1451"><a href="#cb55-1451" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb55-1452"><a href="#cb55-1452" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb55-1453"><a href="#cb55-1453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1454"><a href="#cb55-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1455"><a href="#cb55-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1456"><a href="#cb55-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1457"><a href="#cb55-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1458"><a href="#cb55-1458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1459"><a href="#cb55-1459" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1460"><a href="#cb55-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1461"><a href="#cb55-1461" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1462"><a href="#cb55-1462" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1463"><a href="#cb55-1463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR (4-multivariate normal)"</span>)<span class="sc">+</span></span>
<span id="cb55-1464"><a href="#cb55-1464" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1465"><a href="#cb55-1465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1466"><a href="#cb55-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1467"><a href="#cb55-1467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1468"><a href="#cb55-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1469"><a href="#cb55-1469" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 2-multivariate normal and 2-Wishart</span></span>
<span id="cb55-1470"><a href="#cb55-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1471"><a href="#cb55-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1474"><a href="#cb55-1474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1475"><a href="#cb55-1475" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1476"><a href="#cb55-1476" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1477"><a href="#cb55-1477" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1478"><a href="#cb55-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1479"><a href="#cb55-1479" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_Wishart"</span>, ]</span>
<span id="cb55-1480"><a href="#cb55-1480" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1481"><a href="#cb55-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1482"><a href="#cb55-1482" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1483"><a href="#cb55-1483" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1484"><a href="#cb55-1484" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb55-1485"><a href="#cb55-1485" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb55-1486"><a href="#cb55-1486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1487"><a href="#cb55-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1488"><a href="#cb55-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1489"><a href="#cb55-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1490"><a href="#cb55-1490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1491"><a href="#cb55-1491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1492"><a href="#cb55-1492" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1493"><a href="#cb55-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1494"><a href="#cb55-1494" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1495"><a href="#cb55-1495" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1496"><a href="#cb55-1496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (2-multivariate normal, 2-Wishart)"</span>)<span class="sc">+</span></span>
<span id="cb55-1497"><a href="#cb55-1497" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1498"><a href="#cb55-1498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1499"><a href="#cb55-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1500"><a href="#cb55-1500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1501"><a href="#cb55-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1502"><a href="#cb55-1502" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR</span></span>
<span id="cb55-1503"><a href="#cb55-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1504"><a href="#cb55-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1507"><a href="#cb55-1507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1508"><a href="#cb55-1508" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1509"><a href="#cb55-1509" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1510"><a href="#cb55-1510" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1511"><a href="#cb55-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1512"><a href="#cb55-1512" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR"</span>, ]</span>
<span id="cb55-1513"><a href="#cb55-1513" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1514"><a href="#cb55-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1515"><a href="#cb55-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1516"><a href="#cb55-1516" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1517"><a href="#cb55-1517" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n1,</span>
<span id="cb55-1518"><a href="#cb55-1518" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n1))<span class="sc">+</span></span>
<span id="cb55-1519"><a href="#cb55-1519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1520"><a href="#cb55-1520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1521"><a href="#cb55-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1522"><a href="#cb55-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1523"><a href="#cb55-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1524"><a href="#cb55-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1525"><a href="#cb55-1525" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1526"><a href="#cb55-1526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1527"><a href="#cb55-1527" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1528"><a href="#cb55-1528" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1529"><a href="#cb55-1529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>)<span class="sc">+</span></span>
<span id="cb55-1530"><a href="#cb55-1530" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1531"><a href="#cb55-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1532"><a href="#cb55-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1533"><a href="#cb55-1533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1534"><a href="#cb55-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1535"><a href="#cb55-1535" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR</span></span>
<span id="cb55-1536"><a href="#cb55-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1539"><a href="#cb55-1539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1540"><a href="#cb55-1540" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1541"><a href="#cb55-1541" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1542"><a href="#cb55-1542" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1543"><a href="#cb55-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1544"><a href="#cb55-1544" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR"</span>, ]</span>
<span id="cb55-1545"><a href="#cb55-1545" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1546"><a href="#cb55-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1547"><a href="#cb55-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1548"><a href="#cb55-1548" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1549"><a href="#cb55-1549" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n1,</span>
<span id="cb55-1550"><a href="#cb55-1550" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n1))<span class="sc">+</span></span>
<span id="cb55-1551"><a href="#cb55-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1552"><a href="#cb55-1552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1553"><a href="#cb55-1553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1554"><a href="#cb55-1554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1555"><a href="#cb55-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1556"><a href="#cb55-1556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1557"><a href="#cb55-1557" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1558"><a href="#cb55-1558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1559"><a href="#cb55-1559" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1560"><a href="#cb55-1560" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1561"><a href="#cb55-1561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>)<span class="sc">+</span></span>
<span id="cb55-1562"><a href="#cb55-1562" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1563"><a href="#cb55-1563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1564"><a href="#cb55-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1565"><a href="#cb55-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1566"><a href="#cb55-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1567"><a href="#cb55-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hardy Weinberg Disequilibrium</span></span>
<span id="cb55-1568"><a href="#cb55-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1571"><a href="#cb55-1571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1572"><a href="#cb55-1572" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-1573"><a href="#cb55-1573" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb55-1574"><a href="#cb55-1574" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb55-1575"><a href="#cb55-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1576"><a href="#cb55-1576" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnHWE_A"</span>, ]</span>
<span id="cb55-1577"><a href="#cb55-1577" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb55-1578"><a href="#cb55-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1579"><a href="#cb55-1579" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb55-1580"><a href="#cb55-1580" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb55-1581"><a href="#cb55-1581" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n,</span>
<span id="cb55-1582"><a href="#cb55-1582" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n))<span class="sc">+</span></span>
<span id="cb55-1583"><a href="#cb55-1583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-1584"><a href="#cb55-1584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb55-1585"><a href="#cb55-1585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb55-1586"><a href="#cb55-1586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb55-1587"><a href="#cb55-1587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb55-1588"><a href="#cb55-1588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb55-1589"><a href="#cb55-1589" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb55-1590"><a href="#cb55-1590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb55-1591"><a href="#cb55-1591" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb55-1592"><a href="#cb55-1592" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb55-1593"><a href="#cb55-1593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hardy Weinburg Disequilibrium"</span>)<span class="sc">+</span></span>
<span id="cb55-1594"><a href="#cb55-1594" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb55-1595"><a href="#cb55-1595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1596"><a href="#cb55-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1597"><a href="#cb55-1597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>