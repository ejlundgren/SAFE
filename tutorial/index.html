<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Shinichi Nakagawa">
<meta name="author" content="Ayumi Mizuno">
<meta name="author" content="Santiago Ortega">
<meta name="author" content="Daniel Noble">
<meta name="author" content="Alistair Senior">
<meta name="author" content="Erick J Lundgren">
<meta name="author" content="many others order TBD">
<meta name="dcterms.date" content="2025-09-18">
<title>SAFE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="SAFE simulations tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="SAFE simulations tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SAFE simulations tutorial_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SAFE simulations tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SAFE simulations tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SAFE simulations tutorial_files/libs/bootstrap/bootstrap-11255d631cf4d0e2063def319161670c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title"><strong>CONTENTS</strong></h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li>
<a href="#an-introduction-to-safe-bootstrapping" id="toc-an-introduction-to-safe-bootstrapping" class="nav-link" data-scroll-target="#an-introduction-to-safe-bootstrapping">An introduction to SAFE bootstrapping</a>
  <ul>
<li>
<a href="#how-does-it-work" id="toc-how-does-it-work" class="nav-link" data-scroll-target="#how-does-it-work">How does it work?</a>
  <ul>
<li><a href="#step-1-draw-hyperparameters." id="toc-step-1-draw-hyperparameters." class="nav-link" data-scroll-target="#step-1-draw-hyperparameters.">Step 1: draw hyperparameters.</a></li>
  <li><a href="#step-2-transform-hyperparameters-to-target-effect-size" id="toc-step-2-transform-hyperparameters-to-target-effect-size" class="nav-link" data-scroll-target="#step-2-transform-hyperparameters-to-target-effect-size">Step 2: transform hyperparameters to target effect size</a></li>
  <li><a href="#step-3-calculate-sampling-variance" id="toc-step-3-calculate-sampling-variance" class="nav-link" data-scroll-target="#step-3-calculate-sampling-variance">Step 3: Calculate sampling variance</a></li>
  <li><a href="#step-4-calculate-bias-corrected-effect-size" id="toc-step-4-calculate-bias-corrected-effect-size" class="nav-link" data-scroll-target="#step-4-calculate-bias-corrected-effect-size">Step 4: Calculate bias-corrected effect size</a></li>
  </ul>
</li>
  <li><a href="#load-encapsulated-functions" id="toc-load-encapsulated-functions" class="nav-link" data-scroll-target="#load-encapsulated-functions">Load encapsulated functions</a></li>
  </ul>
</li>
  <li>
<a href="#how-good-is-safe" id="toc-how-good-is-safe" class="nav-link" data-scroll-target="#how-good-is-safe">How good is SAFE?</a>
  <ul>
<li>
<a href="#calculate-bias" id="toc-calculate-bias" class="nav-link" data-scroll-target="#calculate-bias">Calculate bias</a>
  <ul>
<li><a href="#effect-size-point-estimate-bias" id="toc-effect-size-point-estimate-bias" class="nav-link" data-scroll-target="#effect-size-point-estimate-bias">Effect size (point estimate) bias</a></li>
  <li><a href="#sampling-variance-bias" id="toc-sampling-variance-bias" class="nav-link" data-scroll-target="#sampling-variance-bias">Sampling variance bias</a></li>
  </ul>
</li>
  <li>
<a href="#plot-all-simulations-results" id="toc-plot-all-simulations-results" class="nav-link" data-scroll-target="#plot-all-simulations-results">Plot all simulations results</a>
  <ul>
<li><a href="#speed" id="toc-speed" class="nav-link" data-scroll-target="#speed">Speed</a></li>
  <li><a href="#smd-4-multivariate-normal" id="toc-smd-4-multivariate-normal" class="nav-link" data-scroll-target="#smd-4-multivariate-normal">SMD 4-multivariate normal</a></li>
  <li><a href="#smd-2-multivariate-normal-and-2-wishart" id="toc-smd-2-multivariate-normal-and-2-wishart" class="nav-link" data-scroll-target="#smd-2-multivariate-normal-and-2-wishart">SMD 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lncvr-4-multivariate-normal" id="toc-lncvr-4-multivariate-normal" class="nav-link" data-scroll-target="#lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</a></li>
  <li><a href="#lncvr-2-multivariate-normal-and-2-wishart" id="toc-lncvr-2-multivariate-normal-and-2-wishart" class="nav-link" data-scroll-target="#lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lnor" id="toc-lnor" class="nav-link" data-scroll-target="#lnor">lnOR</a></li>
  <li><a href="#lnrr" id="toc-lnrr" class="nav-link" data-scroll-target="#lnrr">lnRR</a></li>
  <li><a href="#hardy-weinberg-disequilibrium" id="toc-hardy-weinberg-disequilibrium" class="nav-link" data-scroll-target="#hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#how-many-safe-bootstraps" id="toc-how-many-safe-bootstraps" class="nav-link" data-scroll-target="#how-many-safe-bootstraps">How many SAFE bootstraps?</a>
  <ul>
<li>
<a href="#bootstrap-scenario-results" id="toc-bootstrap-scenario-results" class="nav-link" data-scroll-target="#bootstrap-scenario-results">Bootstrap scenario results</a>
  <ul>
<li><a href="#reciprocal" id="toc-reciprocal" class="nav-link" data-scroll-target="#reciprocal">Reciprocal</a></li>
  <li><a href="#smd-4-multivariate-normal-1" id="toc-smd-4-multivariate-normal-1" class="nav-link" data-scroll-target="#smd-4-multivariate-normal-1">SMD 4-multivariate normal</a></li>
  <li><a href="#smd-2-multivariate-normal-and-2-wishart-1" id="toc-smd-2-multivariate-normal-and-2-wishart-1" class="nav-link" data-scroll-target="#smd-2-multivariate-normal-and-2-wishart-1">SMD 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lncvr-4-multivariate-normal-1" id="toc-lncvr-4-multivariate-normal-1" class="nav-link" data-scroll-target="#lncvr-4-multivariate-normal-1">lnCVR 4-multivariate normal</a></li>
  <li><a href="#lncvr-2-multivariate-normal-and-2-wishart-1" id="toc-lncvr-2-multivariate-normal-and-2-wishart-1" class="nav-link" data-scroll-target="#lncvr-2-multivariate-normal-and-2-wishart-1">lnCVR 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lnor-1" id="toc-lnor-1" class="nav-link" data-scroll-target="#lnor-1">lnOR</a></li>
  <li><a href="#lnrr-1" id="toc-lnrr-1" class="nav-link" data-scroll-target="#lnrr-1">lnRR</a></li>
  <li><a href="#hardy-weinberg-disequilibrium-1" id="toc-hardy-weinberg-disequilibrium-1" class="nav-link" data-scroll-target="#hardy-weinberg-disequilibrium-1">Hardy Weinberg Disequilibrium</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">SAFE</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">step by step online tutorial</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Shinichi Nakagawa </p>
             <p>Ayumi Mizuno </p>
             <p>Santiago Ortega </p>
             <p>Daniel Noble </p>
             <p>Alistair Senior </p>
             <p>Erick J Lundgren </p>
             <p>many others order TBD </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 18, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren@gmail.com).</p>
<p>The simulations take a long time to run on a personal computer. We have therefore uploaded all simulation results as .Rds files, though we show exactly how we ran the simulations.</p>
<p>To run the code interactively (instead of just reading this lovely tutorial), do the following:</p>
<ol type="1">
<li>Clone the github repo: https://github.com/ejlundgren/SAFE.git</li>
<li>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session or just follow along here on the web :)</li>
</ol></section><section id="load-libraries" class="level2"><h2 class="anchored" data-anchor-id="load-libraries">Load libraries</h2>
<p>The <code>groundhog</code> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <code>groundhog</code> if it is not already installed with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, clean the environment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now load packages:</span></span>
<span><span class="co"># install.packages("groundhog")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://groundhogr.com/">"groundhog"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/groundhog/man/groundhog.library.html">groundhog.library</a></span><span class="op">(</span>pkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"crayon"</span>, </span>
<span>                          <span class="st">"tmvtnorm"</span>, <span class="st">"here"</span>,</span>
<span>                          <span class="st">"parallel"</span>, <span class="st">"foreach"</span>, <span class="st">"doSNOW"</span>,</span>
<span>                          <span class="st">"ggplot2"</span>, <span class="st">"patchwork"</span>, <span class="st">"scico"</span><span class="op">)</span>,</span>
<span>                  date <span class="op">=</span> <span class="st">"2025-04-15"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="an-introduction-to-safe-bootstrapping" class="level1"><h1>An introduction to SAFE bootstrapping</h1>
<p>SAFE bootstrapping is an incredible, seemingly magical, technique to calculate variance estimates for effect sizes, for which sampling variance formulas may not be known. In some cases, it is also more unbiased than traditional plugin formulas for variance and point estimates (i.e., the effect size itself).</p>
<section id="how-does-it-work" class="level2"><h2 class="anchored" data-anchor-id="how-does-it-work">How does it work?</h2>
<p>With SAFE bootstrapping, one draws a cloud of <em>hyperparameters</em> of all variables used in an effect size formula. You then apply your effect size formula to this cloud. The variance of this transformed cloud, is the sampling variance of your effect size!</p>
<p>You can then calculate a bias-transformed point estimate by taking the mean of this transformed cloud and subtracting 2 times the point estimate derived simply from the original variables.</p>
<p>Let’s demonstrate.</p>
<p>Imagine you want to create an effect size of ‘speed’ from mean latency time (e.g., time until an event happens). Here let’s start with 3 mean latency times and convert to our new ‘speed’ effect size</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mean_latency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">31</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.6</span>, <span class="fl">3.1</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># New effect size:</span></span>
<span><span class="fl">1</span><span class="op">/</span><span class="va">mean_latency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667 0.03333333 0.04761905</code></pre>
</div>
</div>
<p>The effect size is trivial to calculate. But what is the sampling variance of this effect size, given that each of these measurements was associated with measurement sample size and standard deviation?</p>
<p>You could use calculus to derive a first-order sampling variance formula. Or you could use SAFE.</p>
<section id="step-1-draw-hyperparameters." class="level3"><h3 class="anchored" data-anchor-id="step-1-draw-hyperparameters.">Step 1: draw hyperparameters.</h3>
<p>If the word ‘hyperparameter’ is scary, what we mean is a distribution of the variables associated with the definition formula of the effect size, in this case <code>latency</code>. Let’s draw 10,000 samples of this hyperparameter from a normal distribution. To avoid using <code>lapply</code> or loops, let’s just use SAFE to calculate variance for the first mean latency time. We’ll calculate standard error from the associated standard deviation and sample size to capture the dispersion of this hyperparameter.</p>
<p><strong>Shinichi, I don’t fully understand why we square root the N for this effect size but not the others</strong></p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">15</span> <span class="co"># The mean</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fl">4.6</span> <span class="co"># standard deviation</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">25</span> <span class="co"># sample size</span></span>
<span></span>
<span><span class="va">cloud</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1e6</span>,</span>
<span>               mean <span class="op">=</span> <span class="va">x</span>,</span>
<span>               sd <span class="op">=</span> <span class="va">sd</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cloud</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.56013 14.29316 15.76593 17.16014 14.68945 14.48633</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">cloud</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="step-2-transform-hyperparameters-to-target-effect-size" class="level3"><h3 class="anchored" data-anchor-id="step-2-transform-hyperparameters-to-target-effect-size">Step 2: transform hyperparameters to target effect size</h3>
<p>Now, let’s transform this cloud of hyperparameters to ‘speed’ with our definition formula <code>1/x</code></p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cloud_trans</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">cloud</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">cloud_trans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These values are similar to our transformed effect size:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="va">plugin_effect_size</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span></span>
<span></span>
<span><span class="va">plugin_effect_size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667</code></pre>
</div>
</div>
</section><section id="step-3-calculate-sampling-variance" class="level3"><h3 class="anchored" data-anchor-id="step-3-calculate-sampling-variance">Step 3: Calculate sampling variance</h3>
<p>To calculate sampling variance for our effect size we calculate standard error of this transformed cloud. This can be confusing: you do this with <code>sd</code>, the standard deviation function because this is a hyperparameter (not a population). Squaring this produces sampling variance:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">cloud_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="va">safe_vi</span> <span class="op">&lt;-</span> <span class="va">safe_SE</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">safe_vi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.723067e-05</code></pre>
</div>
</div>
<p>Voila! Sampling variance for a novel effect size.</p>
</section><section id="step-4-calculate-bias-corrected-effect-size" class="level3"><h3 class="anchored" data-anchor-id="step-4-calculate-bias-corrected-effect-size">Step 4: Calculate bias-corrected effect size</h3>
<p>However, given low sample sizes for some measurements, and the knowledge that point estimates can be biased at low N, let’s also calculate a bias-corrected point estimate from this cloud of hyperparameters:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_yi</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">plugin_effect_size</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cloud_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="va">safe_yi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06641769</code></pre>
</div>
</div>
<p>Let’s compare this to the original point estimate:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_yi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06641769</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plugin_effect_size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667</code></pre>
</div>
</div>
<p>So similar! And potentially less biased. We’ll find out below, where we use Monte Carlo simulations to compare the bias of estimates from SAFE to estimates from plugging into a formula.</p>
</section></section><section id="load-encapsulated-functions" class="level2"><h2 class="anchored" data-anchor-id="load-encapsulated-functions">Load encapsulated functions</h2>
<p>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let’s load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at tutorial/SAFE_function.R. This function returns a data.table (basically a <em>fast</em> data.frame) with columns for plugin effect sizes and sampling variances (denoted with <code>_first</code> or <code>_second</code> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <code>_safe</code>). Point estimates (effect sizes) are denoted with <code>yi_</code> while sampling variances are denoted with <code>vi_</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' *COMMENT OUT FOR RENDERING AND DELETE PRIOR TO PUBLICATION:*</span></span>
<span><span class="co"># setwd("tutorial")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"SAFE_function.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For a single effect size and sampling variance:</span></span>
<span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">14.5</span>, x2 <span class="op">=</span> <span class="fl">7.9</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fl">1.3</span>, sd2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fl">20</span>, n2 <span class="op">=</span> <span class="fl">20</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>lnRoM cannot accept x1 or x2 ≤ 0. Leaving it to user's discretion to check prior to execution. Negative values will be returned as NA.

Using the formulas:
     yi_first &lt;- log(x1 / x2)
     yi_second &lt;- log(x1 / x2) + 0.5 * (sd1^2/(n1 * x1^2) - sd2^2/(n2 * x2^2))
     vi_first &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2)
     vi_second &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2) + 0.5 * ( (sd1^4 / (n1^2 * x1^4)) + (sd2^4 / (n2^2 * x2^4))) 
Be sure that all variables in formula are correctly named.

SAFE: 1 / 1 
Running SAFE with 1e+06 bootstraps</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second    vi_first   vi_second  yi_safe  vi_safe    SE_safe
       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;       &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;
1: 0.6072859 0.6058845 0.003606517 0.003611733 0.605911 0.003625 0.06020797</code></pre>
</div>
</div>
<p>Or with a vector of raw data:</p>
<p><strong>UPDATE TO BE PARALLELIZED VERSION</strong></p>
<div class="cell">
<div class="sourceCode" id="cb21" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14.5</span>, <span class="fl">13</span>, <span class="fl">15.8</span><span class="op">)</span>, </span>
<span>         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.9</span>, <span class="fl">21</span>, <span class="fl">18.4</span><span class="op">)</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">2</span>, <span class="fl">1.9</span><span class="op">)</span>, </span>
<span>         sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span><span class="op">)</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>, </span>
<span>         n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"SMD"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second  vi_first vi_second   yi_safe   vi_safe   SE_safe
       &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;
1:  3.912937  3.835196 0.3014615 0.2975274  3.820715 0.3654276 0.6045060
2: -3.167230 -3.094698 0.2686568 0.2633745 -3.408408 0.2533951 0.5033837
3: -1.545312 -1.512893 0.1387221 0.1343396 -1.540899 0.1403610 0.3746478</code></pre>
</div>
</div>
<p>For a full list of options that eff_size can calculate, please see information by running:</p>
<div class="cell">
<div class="sourceCode" id="cb23" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>
Must specify an effect size type ('effect_type') and necessary variables (named in arguments to function call) to match formula equations.
 
Returning effect size names &amp; required variables for reference.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>            name               vars_required
          &lt;char&gt;                      &lt;char&gt;
 1:          SMD    x1, x2, sd1, sd2, n1, n2
 2:   SMD_paired x1, x2, sd1, sd2, r, n1, n2
 3:        lnCVR    x1, x2, sd1, sd2, n1, n2
 4: lnCVR_paired x1, x2, sd1, sd2, r, n1, n2
 5:      lnHWE_A            n_AA, n_Aa, n_aa
 6:          lnM    x1, x2, sd1, sd2, n1, n2
 7:   lnM_paired x1, x2, sd1, sd2, n1, n2, r
 8:         lnOR                  a, b, c, d
 9:         lnRR                a, c, n1, n2
10:        lnRoM    x1, x2, sd1, sd2, n1, n2
11: lnRoM_paired x1, x2, sd1, sd2, r, n1, n2
12:   reciprocal                    n, x, sd</code></pre>
</div>
</div>
</section></section><section id="how-good-is-safe" class="level1"><h1>How good is SAFE?</h1>
<p>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size and the number of SAFE bootstraps. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let’s look at the simulations for lnRoM:</p>
<div class="cell">
<div class="sourceCode" id="cb26" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/scenarios.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset scenarios:</span></span>
<span><span class="va">guide</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span><span class="va">effect_type</span> <span class="op">==</span> <span class="st">"lnRoM"</span> <span class="op">&amp;</span></span>
<span>                     <span class="va">boots</span> <span class="op">==</span> <span class="fl">1e6</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">guide</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">effect_type</span>, <span class="va">scenario_id</span>, <span class="va">boots</span>,</span>
<span>                   <span class="va">true_mean1</span>, <span class="va">true_mean2</span>, </span>
<span>                   <span class="va">true_sd1</span>, <span class="va">true_sd2</span>,</span>
<span>                   <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>   effect_type       scenario_id boots true_mean1 true_mean2 true_sd1 true_sd2
        &lt;char&gt;            &lt;char&gt; &lt;num&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1:       lnRoM  lnRoM_scenario_4 1e+06       13.4       16.1      4.6      3.9
2:       lnRoM lnRoM_scenario_10 1e+06       13.4       16.1      4.6      3.9
3:       lnRoM lnRoM_scenario_16 1e+06       13.4       16.1      4.6      3.9
4:       lnRoM lnRoM_scenario_22 1e+06       13.4       16.1      4.6      3.9
5:       lnRoM lnRoM_scenario_28 1e+06       13.4       16.1      4.6      3.9
   sample_size1 sample_size2
          &lt;num&gt;        &lt;num&gt;
1:            5            5
2:           10           10
3:           50           50
4:          100          100
5:          150          150</code></pre>
</div>
</div>
<p>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the ‘true’ values and based on the simulated dataset. We did this 1e5 times for each scenario.</p>
<p>In these Monte Carlo simulation, we were interested in bias, or the difference between the ‘true’ estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We’ll explain the difference between estimands, estimators, and estimates below.</p>
<p>To illustrate, we’ll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we’ll only run 100 simulations.</p>
<p>To speed things up we will do this in parallel. The function <code>prepare_cluster()</code> below can help set things up and provides a progress bar so you don’t lose your mind wondering what’s going on in there.</p>
<div class="cell">
<div class="sourceCode" id="cb28" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare cluster:</span></span>
<span><span class="va">prepare_cluster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>,</span>
<span>                             <span class="va">progress_bar</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/RevolutionAnalytics/foreach">"foreach"</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"doSNOW"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">nCores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span> </span>
<span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">nCores</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/doSNOW/man/registerDoSNOW.html">registerDoSNOW</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Progress bar</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">progress_bar</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">txtProgressBar</a></span><span class="op">(</span>max <span class="op">=</span> <span class="va">n</span>, style <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>      <span class="va">progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">pb</span>, <span class="va">n</span><span class="op">)</span></span>
<span>      <span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>progress <span class="op">=</span> <span class="va">progress</span><span class="op">)</span></span>
<span>      <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">opts</span>, <span class="va">pb</span>, <span class="va">cl</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>      <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cluster"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized in Section <strong>XXXX.</strong> The first part of this code (inside the <code>lapply</code>) creates simulated data based on ‘true’ means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the ‘true’ values and simulated values. Note that even with only 100 iterations, this can take a minute, so feel free to load the already run dummy dataset in the next code block.</p>
<div class="cell">
<div class="sourceCode" id="cb29" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rerun</span> <span class="op">&lt;-</span> <span class="cn">F</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">rerun</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">monte_carlo_N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  </span>
<span>  <span class="va">clust_out</span> <span class="op">&lt;-</span> <span class="fu">prepare_cluster</span><span class="op">(</span>n <span class="op">=</span> <span class="va">monte_carlo_N</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">monte_carlo_N</span>, </span>
<span>         .options.snow <span class="op">=</span> <span class="va">clust_out</span><span class="op">$</span><span class="va">options</span>,</span>
<span>         .errorhandling <span class="op">=</span> <span class="st">"pass"</span>,</span>
<span>         .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">%dopar%</a></span> <span class="op">{</span></span>
<span>           </span>
<span>   <span class="co"># Calculate 'true' values from scenario:</span></span>
<span>   <span class="va">true_point</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span>, x2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                          sd1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span>,  sd2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                          n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                          effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                          SAFE <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">true_point</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>    <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span>   <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">guide</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>     </span>
<span>     <span class="co"># Simulate data for guide</span></span>
<span>     <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                   <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                m2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rtmvnorm</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     mean <span class="op">=</span> <span class="va">means</span>,</span>
<span>                     sigma <span class="op">=</span> <span class="va">sig</span>,</span>
<span>                     lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     algorithm <span class="op">=</span> <span class="st">"gibbs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu">setDT</span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="st">"m2"</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="co"># Filter to number of samples per treatment</span></span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m1</span>,</span>
<span>                     x2 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m2</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>sim_mean1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_mean2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_sample_size1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_sample_size2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span>
<span>   <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="op">)</span></span>
<span>   </span>
<span>  </span>
<span>   <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean1</span>, x2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean2</span>,</span>
<span>                   sd1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd1</span>,  sd2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd2</span>,</span>
<span>                   n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                   effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                   SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">out</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># Store results:</span></span>
<span>   <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">guide</span>,</span>
<span>                         <span class="va">sim_dat</span>,</span>
<span>                         <span class="va">true_point</span>,</span>
<span>                         <span class="va">out</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">progress</span>, <span class="va">i</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">res</span><span class="op">)</span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or just load the full simulation (1e5) here:</p>
<div class="cell">
<div class="sourceCode" id="cb30" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/lnRoM_simulation.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id boots effect_type true_mean1 true_mean2 true_sd1 true_sd2
             &lt;char&gt; &lt;num&gt;      &lt;char&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
2: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
3: lnRoM_scenario_4 1e+06       lnRoM       13.4       16.1      4.6      3.9
   sample_size1 sample_size_ratio sample_size2 sim_mean1 sim_mean2  sim_sd1
          &lt;num&gt;             &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;    &lt;num&gt;
1:            5                 1            5  13.12934  16.59769 4.986235
2:            5                 1            5  12.73781  14.25180 4.363871
3:            5                 1            5  14.81564  14.87446 1.991222
    sim_sd2 sim_sample_size1 sim_sample_size2 true_y_plugin_1st
      &lt;num&gt;            &lt;int&gt;            &lt;int&gt;             &lt;num&gt;
1: 4.004230                5                5        -0.1835646
2: 3.704075                5                5        -0.1835646
3: 3.157322                5                5        -0.1835646
   true_y_plugin_2nd true_v_plugin_1st true_v_plugin_2nd sim_y_plugin_1st
               &lt;num&gt;             &lt;num&gt;             &lt;num&gt;            &lt;num&gt;
1:         -0.177648        0.03530438        0.03565099     -0.234413837
2:         -0.177648        0.03530438        0.03565099     -0.112308908
3:         -0.177648        0.03530438        0.03565099     -0.003962011
   sim_y_plugin_2nd sim_v_plugin_1st sim_v_plugin_2nd      yi_safe    vi_safe
              &lt;num&gt;            &lt;num&gt;            &lt;num&gt;        &lt;num&gt;      &lt;num&gt;
1:     -0.225810970       0.04048679       0.04097060 -0.225408279 0.04328101
2:     -0.107326891       0.03698369       0.03735046 -0.106866241 0.03915580
3:     -0.006661305       0.01262393       0.01267106 -0.006623332 0.01285204
     SE_safe  iter
       &lt;num&gt; &lt;int&gt;
1: 0.2080409     1
2: 0.1978783     2
3: 0.1133668     3</code></pre>
</div>
</div>
<section id="calculate-bias" class="level2"><h2 class="anchored" data-anchor-id="calculate-bias">Calculate bias</h2>
<p>To interpret the simulation results, it is essential to understand the difference between <em>estimands</em>, <em>estimators</em>, and <em>estimates</em>.</p>
<p><strong>Estimands</strong> are the ‘true’ value.</p>
<p><strong>Estimators</strong> are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges’ g) to reduce bias, and the SAFE method.</p>
<p><strong>Estimates</strong> are the estimates of the estimands produced by the estimators.</p>
<section id="effect-size-point-estimate-bias" class="level3"><h3 class="anchored" data-anchor-id="effect-size-point-estimate-bias">Effect size (point estimate) bias</h3>
<p>In the case of our effect sizes, there are two estimands that we’re interested in estimating: the ‘true’ effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the ‘true’ values).</p>
<p>Here we will calculate bias in our estimates of effect sizes:</p>
<div class="cell">
<div class="sourceCode" id="cb32" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>, <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">point.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>plugin_1st <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_1st</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      plugin_2nd <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      safe <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">yi_safe</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2   plugin_1st  plugin_2nd
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;        &lt;num&gt;       &lt;num&gt;
1:  lnRoM_scenario_4            5            5 -0.003738263 0.002470844
2: lnRoM_scenario_10           10           10 -0.000385537 0.002574180
3: lnRoM_scenario_16           50           50  0.001587492 0.002159629
4: lnRoM_scenario_22          100          100  0.001640940 0.001925938
5: lnRoM_scenario_28          150          150  0.001657941 0.001847710
          safe
         &lt;num&gt;
1: 0.003160768
2: 0.002682675
3: 0.002163063
4: 0.001926593
5: 0.001848109</code></pre>
</div>
<div class="sourceCode" id="cb34" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Melt this to make it plottable:</span></span>
<span><span class="va">point.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">point.bias</span>,</span>
<span>                        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span>,</span>
<span>                        value.name <span class="op">=</span> <span class="st">"bias"</span>,</span>
<span>                        variable.name <span class="op">=</span> <span class="st">"estimator"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2  estimator         bias
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;fctr&gt;        &lt;num&gt;
1:  lnRoM_scenario_4            5            5 plugin_1st -0.003738263
2: lnRoM_scenario_10           10           10 plugin_1st -0.000385537
3: lnRoM_scenario_16           50           50 plugin_1st  0.001587492
4: lnRoM_scenario_22          100          100 plugin_1st  0.001640940
5: lnRoM_scenario_28          150          150 plugin_1st  0.001657941
6:  lnRoM_scenario_4            5            5 plugin_2nd  0.002470844</code></pre>
</div>
<div class="sourceCode" id="cb36" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort by sample size </span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">point.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">bias</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Bias"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_bias"</span> <span class="op">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd_bias"</span> <span class="op">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"safe_bias"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span>,</span>
<span>                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st"</span> <span class="op">=</span> <span class="st">"#A8DADC"</span>,</span>
<span>                                   <span class="st">"plugin_2nd"</span> <span class="op">=</span> <span class="st">"#1D3557"</span>,</span>
<span>                                   <span class="st">"safe"</span> <span class="op">=</span> <span class="st">"#E63946"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This indicates that the least biased estimator is the first order definition formula (light blue). SAFE (red) and the 2nd order plugin (navy blue) perform similarly. These bias values are incredibly small, indicating that all options are fair, except for at low sample sizes, when the first-order definition formula is quite biased.</p>
</section><section id="sampling-variance-bias" class="level3"><h3 class="anchored" data-anchor-id="sampling-variance-bias">Sampling variance bias</h3>
<p>Interestingly, there is no way to know the ‘true’ estimand for sampling variance. <strong>WHICH I DON’T FULLY UNDERSTAND</strong>. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use <em>each</em> of these as the estimand. With 3 estimators, and thus 3 estimands, we’ll thus end up with 9 calculations of bias.</p>
<p>Since we’re interested in relative bias (<strong>Not entirely sure why</strong>), we’ll calculate bias as above but divide by the estimand and multiply by 100.</p>
<div class="cell">
<div class="sourceCode" id="cb37" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_1st</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_1st</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_2nd</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_SAFE</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">yi_safe</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span><span class="va">relative_bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>,</span>
<span>                          <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">estimand</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span><span class="va">var.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>SAFE_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Now melt:</span></span>
<span><span class="va">var.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">var.bias</span>,</span>
<span>                      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">var.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>         scenario_id sample_size1 sample_size2                   variable
              &lt;char&gt;        &lt;num&gt;        &lt;num&gt;                     &lt;fctr&gt;
1:  lnRoM_scenario_4            5            5 SAFE_estimate.1st_estimand
2: lnRoM_scenario_10           10           10 SAFE_estimate.1st_estimand
3: lnRoM_scenario_16           50           50 SAFE_estimate.1st_estimand
4: lnRoM_scenario_22          100          100 SAFE_estimate.1st_estimand
5: lnRoM_scenario_28          150          150 SAFE_estimate.1st_estimand
6:  lnRoM_scenario_4            5            5 SAFE_estimate.2nd_estimand
        value
        &lt;num&gt;
1: 12.2824838
2:  3.5304146
3:  0.1791294
4:  0.5912706
5:  0.3287710
6: 16.6524224</code></pre>
</div>
<div class="sourceCode" id="cb39" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span><span class="va">var.bias.long</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimator"</span>, <span class="st">"Estimand"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">tstrsplit</span><span class="op">(</span><span class="va">variable</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Sort the dataset by sample size</span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">var.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">var.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative bias (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_estimate"</span> <span class="op">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="op">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"SAFE_estimate"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_estimate"</span> <span class="op">=</span> <span class="st">"#A8DADC"</span>,</span>
<span>                               <span class="st">"plugin_2nd_estimate"</span> <span class="op">=</span> <span class="st">"#1D3557"</span>,</span>
<span>                               <span class="st">"SAFE_estimate"</span> <span class="op">=</span> <span class="st">"#E63946"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">Estimand</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st_estimand"</span> <span class="op">=</span> <span class="st">"1st order plugin estimand\n(definition formula)"</span>,</span>
<span>                                    <span class="st">"2nd_estimand"</span> <span class="op">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span>                                    <span class="st">"SAFE_estimand"</span> <span class="op">=</span> <span class="st">"SAFE estimand"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see here that SAFE (red) is slightly more biased, but in a conservative direction, than the other estimators.</p>
</section></section><section id="plot-all-simulations-results" class="level2"><h2 class="anchored" data-anchor-id="plot-all-simulations-results">Plot all simulations results</h2>
<p>Now let’s look at the rest of the simulation results.</p>
<div class="cell">
<div class="sourceCode" id="cb40" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/all_scenarios_summarized.Rds"</span><span class="op">)</span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="va">sim_results</span><span class="op">[</span><span class="va">boots</span> <span class="op">==</span> <span class="fl">1e6</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="speed" class="level3"><h3 class="anchored" data-anchor-id="speed">Speed</h3>
<p>This was our dummy effect size in the beginning. How do the point and variance estimates calculated by SAFE compare to just calculating 1 / x for point estimates?</p>
<p>Moreover, we compared the variance estimates from SAFE to variance estimates produced by a 1st-order derivative sampling variance formula derived with the delta method (denoted 1st order plugin here). Let’s see which did better!</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="smd-4-multivariate-normal">SMD 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-2-multivariate-normal-and-2-wishart" class="level3"><h3 class="anchored" data-anchor-id="smd-2-multivariate-normal-and-2-wishart">SMD 2-multivariate normal and 2-Wishart</h3>
<p>With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</p>
</section><section id="lncvr-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-2-multivariate-normal-and-2-wishart" class="level3"><h3 class="anchored" data-anchor-id="lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
</section><section id="lnor" class="level3"><h3 class="anchored" data-anchor-id="lnor">lnOR</h3>
<p>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for ‘a’ and ‘c’.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr" class="level3"><h3 class="anchored" data-anchor-id="lnrr">lnRR</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘a’ and ‘c’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="hardy-weinberg-disequilibrium" class="level3"><h3 class="anchored" data-anchor-id="hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘n_AA’, ‘n_Aa’, and ‘n_aa’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="how-many-safe-bootstraps" class="level1"><h1>How many SAFE bootstraps?</h1>
<p>The SAFE method relies on bootstrapping to calculate effect size point estimates and sampling variance. It’s sort of magical how well it works! But, how many bootstraps are necessary? Let’s find out by doing another Monte Carlo simulation, again of lnRoM. This time, instead of calculating bias, we’ll look at the standard deviation of the point and sampling variance estimates as we change the number of bootstraps.</p>
<p>Let’s two bootstrap lengths: 100 and 1,000. We’ll run the Monte Carlo simulation itself 1,000 times just to make this easy. (See below for full 1e5 simulation results)</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="co"># Create some scenarios based on combinations of sample size and boot-length</span></span>
<span>  <span class="va">scenario</span> <span class="op">&lt;-</span> <span class="fu">CJ</span><span class="op">(</span>effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                 true_mean1 <span class="op">=</span> <span class="fl">13.4</span>, true_sd1 <span class="op">=</span> <span class="fl">4.6</span>,</span>
<span>                 true_mean2 <span class="op">=</span> <span class="fl">16.1</span>, true_sd2 <span class="op">=</span> <span class="fl">3.9</span>,</span>
<span>                 sample_size1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">150</span><span class="op">)</span>,</span>
<span>                 boots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">scenario</span><span class="op">[</span>, <span class="va">sample_size2</span> <span class="op">:=</span> <span class="va">sample_size1</span><span class="op">]</span></span>
<span>  <span class="va">scenario</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;effect_type, true_mean1, true_sd1, true_mean2, true_sd2, sample_size1, boots&gt;
   effect_type true_mean1 true_sd1 true_mean2 true_sd2 sample_size1 boots
        &lt;char&gt;      &lt;num&gt;    &lt;num&gt;      &lt;num&gt;    &lt;num&gt;        &lt;num&gt; &lt;num&gt;
1:       lnRoM       13.4      4.6       16.1      3.9            5   100
2:       lnRoM       13.4      4.6       16.1      3.9            5  1000
3:       lnRoM       13.4      4.6       16.1      3.9           10   100
4:       lnRoM       13.4      4.6       16.1      3.9           10  1000
5:       lnRoM       13.4      4.6       16.1      3.9          150   100
6:       lnRoM       13.4      4.6       16.1      3.9          150  1000
   sample_size2
          &lt;num&gt;
1:            5
2:            5
3:           10
4:           10
5:          150
6:          150</code></pre>
</div>
</div>
<p>Now let’s run this in a foreach loop. If you’d rather not run this on your machine, this will load the finished result below if <code>run</code> == FALSE.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">run</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">sub_scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>  <span class="va">clust_out</span> <span class="op">&lt;-</span> <span class="fu">prepare_cluster</span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, </span>
<span>                               progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>, </span>
<span>                .options.snow <span class="op">=</span> <span class="va">clust_out</span><span class="op">$</span><span class="va">options</span>,</span>
<span>               .errorhandling <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>               .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>,</span>
<span>                             <span class="st">"crayon"</span>, <span class="st">"tmvtnorm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">%dopar%</a></span> <span class="op">{</span></span>
<span>                               </span>
<span>   <span class="va">sub_scenario</span> <span class="op">&lt;-</span> <span class="va">scenario</span><span class="op">[</span><span class="va">boots</span> <span class="op">==</span> <span class="fl">100</span>, <span class="op">]</span>                                        </span>
<span>   <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_mean1</span>,</span>
<span>                   x2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                   sd1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_sd1</span>,</span>
<span>                   sd2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                   n1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                   n2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">sample_size2</span>,</span>
<span>                   effect_type <span class="op">=</span> <span class="st">"SMD"</span>,</span>
<span>                   SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   SAFE_boots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sub_scenario</span><span class="op">$</span><span class="va">boots</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">sub_scenario</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">boots</span>, <span class="va">sample_size1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">sub_scenario</span> <span class="op">&lt;-</span> <span class="va">scenario</span><span class="op">[</span><span class="va">boots</span> <span class="op">==</span> <span class="fl">1000</span>, <span class="op">]</span>                                        </span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_mean1</span>,</span>
<span>                   x2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                   sd1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_sd1</span>,</span>
<span>                   sd2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                   n1 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">sample_size1</span>,</span>
<span>                   n2 <span class="op">=</span> <span class="va">sub_scenario</span><span class="op">$</span><span class="va">sample_size2</span>,</span>
<span>                   effect_type <span class="op">=</span> <span class="st">"SMD"</span>,</span>
<span>                   SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   SAFE_boots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sub_scenario</span><span class="op">$</span><span class="va">boots</span><span class="op">)</span><span class="op">)</span> </span>
<span>     <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           <span class="va">sub_scenario</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">boots</span>, <span class="va">sample_size1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>     <span class="va">out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>   </span>
<span>    </span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">rbindlist</span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">res.dt</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  <span class="va">res.dt</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">res.dt</span>, <span class="st">"data/dummy_bootstrap_simulation.Rds"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">res.dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/dummy_bootstrap_simulation.Rds"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the dispersion of the SAFE estimates as a function of sample size and bootstrap length</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, the point estimates:</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.dt</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">sample_size1</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">yi_safe</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">boots</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size1</span>, <span class="va">boots</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>              position <span class="op">=</span> <span class="fu">position_jitterdodge</span><span class="op">(</span>dodge.width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"SAFE Point Estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_scico</span><span class="op">(</span><span class="st">"Number of SAFE bootstraps"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s look at the variance estimates:</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.dt</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">sample_size1</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">vi_safe</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">boots</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size1</span>, <span class="va">boots</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, shape <span class="op">=</span> <span class="fl">21</span>,</span>
<span>              position <span class="op">=</span> <span class="fu">position_jitterdodge</span><span class="op">(</span>dodge.width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"SAFE Variance Estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_fill_scico</span><span class="op">(</span><span class="st">"Number of SAFE bootstraps"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the dispersion in estimates is shaped by number of SAFE bootstraps and improves considerably with 1,000 bootstraps, especially at low sample sizes. Another way to visualize this (which we’ll use below in the actual 1e5 simulations) is to plot the standard deviation.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res.summary</span> <span class="op">&lt;-</span> <span class="va">res.dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>sd_point_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">yi_safe</span><span class="op">)</span>,</span>
<span>                       sd_variance_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">vi_safe</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">sample_size1</span>, <span class="va">boots</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res.summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   sample_size1 boots sd_point_estimate sd_variance_estimate
          &lt;num&gt; &lt;num&gt;             &lt;num&gt;                &lt;num&gt;
1:            5   100       0.078522330         0.1174573606
2:           10   100       0.047790090         0.0391410785
3:          150   100       0.011788125         0.0020039743
4:            5  1000       0.024059606         0.0349769486
5:           10  1000       0.015988862         0.0121667549
6:          150  1000       0.003783855         0.0006159835</code></pre>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Let's melt this to make a single plot:</span></span>
<span><span class="va">res.summary.mlt</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">res.summary</span>,</span>
<span>                        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample_size1"</span>, <span class="st">"boots"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res.summary.mlt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    sample_size1 boots             variable        value
           &lt;num&gt; &lt;num&gt;               &lt;fctr&gt;        &lt;num&gt;
 1:            5   100    sd_point_estimate 0.0785223300
 2:           10   100    sd_point_estimate 0.0477900903
 3:          150   100    sd_point_estimate 0.0117881247
 4:            5  1000    sd_point_estimate 0.0240596056
 5:           10  1000    sd_point_estimate 0.0159888624
 6:          150  1000    sd_point_estimate 0.0037838546
 7:            5   100 sd_variance_estimate 0.1174573606
 8:           10   100 sd_variance_estimate 0.0391410785
 9:          150   100 sd_variance_estimate 0.0020039743
10:            5  1000 sd_variance_estimate 0.0349769486
11:           10  1000 sd_variance_estimate 0.0121667549
12:          150  1000 sd_variance_estimate 0.0006159835</code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">setorder</span><span class="op">(</span><span class="va">res.summary.mlt</span>, <span class="va">boots</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">res.summary.mlt</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">boots</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">sample_size1</span>,</span>
<span>           group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">sample_size1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="va">pt_size</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sd_point_estimate"</span> <span class="op">=</span> <span class="st">"Point estimate"</span>,</span>
<span>                                      <span class="st">"sd_variance_estimate"</span> <span class="op">=</span> <span class="st">"Variance estimate"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_scico</span><span class="op">(</span><span class="st">"Scenario sample size"</span>,</span>
<span>                   palette <span class="op">=</span> <span class="st">"hawaii"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"SAFE bootstrap length"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Standard deviation of estimate"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="bootstrap-scenario-results" class="level2"><h2 class="anchored" data-anchor-id="bootstrap-scenario-results">Bootstrap scenario results</h2>
<p>Now let’s look at the full Monte Carlo simulation results for the influence of bootstrap length.</p>
<div class="cell">
<div class="sourceCode" id="cb51" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/all_scenarios_summarized.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="va">sim_results</span><span class="op">[</span><span class="va">calculation</span> <span class="op">==</span> <span class="st">"SD"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>                   scenario_id true_mean true_sd sample_size boots effect_type
                        &lt;char&gt;     &lt;num&gt;   &lt;num&gt;       &lt;num&gt; &lt;num&gt;      &lt;char&gt;
1: SMD_Wishart_scenario_10_1e1        NA      NA          NA    10 SMD_Wishart
2: SMD_Wishart_scenario_10_1e1        NA      NA          NA    10 SMD_Wishart
3: SMD_Wishart_scenario_10_1e2        NA      NA          NA   100 SMD_Wishart
4: SMD_Wishart_scenario_10_1e2        NA      NA          NA   100 SMD_Wishart
5:     SMD_Wishart_scenario_14        NA      NA          NA 10000 SMD_Wishart
6:     SMD_Wishart_scenario_14        NA      NA          NA 10000 SMD_Wishart
   true_mean1 true_mean2 true_sd1 true_sd2 sample_size1 sample_size_ratio
        &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;        &lt;num&gt;             &lt;num&gt;
1:       13.4       16.1      4.6      3.9           10                 1
2:       13.4       16.1      4.6      3.9           10                 1
3:       13.4       16.1      4.6      3.9           10                 1
4:       13.4       16.1      4.6      3.9           10                 1
5:       13.4       16.1      4.6      3.9           50                 1
6:       13.4       16.1      4.6      3.9           50                 1
   sample_size2 true_p_a true_p_c    n1 n_ratio    n2 true_a true_c true_b
          &lt;num&gt;    &lt;num&gt;    &lt;num&gt; &lt;num&gt;   &lt;num&gt; &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;
1:           10       NA       NA    NA      NA    NA     NA     NA     NA
2:           10       NA       NA    NA      NA    NA     NA     NA     NA
3:           10       NA       NA    NA      NA    NA     NA     NA     NA
4:           10       NA       NA    NA      NA    NA     NA     NA     NA
5:           50       NA       NA    NA      NA    NA     NA     NA     NA
6:           50       NA       NA    NA      NA    NA     NA     NA     NA
   true_d  p_AA  p_Aa  p_aa     n true_n_AA true_n_Aa true_n_aa       value
    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;       &lt;num&gt;
1:     NA    NA    NA    NA    NA        NA        NA        NA 0.492694243
2:     NA    NA    NA    NA    NA        NA        NA        NA 0.140427345
3:     NA    NA    NA    NA    NA        NA        NA        NA 0.468915976
4:     NA    NA    NA    NA    NA        NA        NA        NA 0.052888152
5:     NA    NA    NA    NA    NA        NA        NA        NA 0.206112903
6:     NA    NA    NA    NA    NA        NA        NA        NA 0.001654534
   estimator estimand calculation estimate_of
      &lt;char&gt;   &lt;char&gt;      &lt;char&gt;      &lt;char&gt;
1:      safe       NA          SD       point
2:      safe       NA          SD    variance
3:      safe       NA          SD       point
4:      safe       NA          SD    variance
5:      safe       NA          SD       point
6:      safe       NA          SD    variance</code></pre>
</div>
</div>
<section id="reciprocal" class="level3"><h3 class="anchored" data-anchor-id="reciprocal">Reciprocal</h3>
<p>1 / x</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-4-multivariate-normal-1" class="level3"><h3 class="anchored" data-anchor-id="smd-4-multivariate-normal-1">SMD 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>                   scenario_id true_mean true_sd sample_size boots effect_type
                        &lt;char&gt;     &lt;num&gt;   &lt;num&gt;       &lt;num&gt; &lt;num&gt;      &lt;char&gt;
 1: SMD_normal_scenario_10_1e1        NA      NA          NA 1e+01  SMD_normal
 2: SMD_normal_scenario_10_1e1        NA      NA          NA 1e+01  SMD_normal
 3: SMD_normal_scenario_16_1e1        NA      NA          NA 1e+01  SMD_normal
 4: SMD_normal_scenario_16_1e1        NA      NA          NA 1e+01  SMD_normal
 5: SMD_normal_scenario_22_1e1        NA      NA          NA 1e+01  SMD_normal
 6: SMD_normal_scenario_22_1e1        NA      NA          NA 1e+01  SMD_normal
 7: SMD_normal_scenario_28_1e1        NA      NA          NA 1e+01  SMD_normal
 8: SMD_normal_scenario_28_1e1        NA      NA          NA 1e+01  SMD_normal
 9:  SMD_normal_scenario_4_1e1        NA      NA          NA 1e+01  SMD_normal
10:  SMD_normal_scenario_4_1e1        NA      NA          NA 1e+01  SMD_normal
11: SMD_normal_scenario_10_1e2        NA      NA          NA 1e+02  SMD_normal
12: SMD_normal_scenario_10_1e2        NA      NA          NA 1e+02  SMD_normal
13: SMD_normal_scenario_16_1e2        NA      NA          NA 1e+02  SMD_normal
14: SMD_normal_scenario_16_1e2        NA      NA          NA 1e+02  SMD_normal
15: SMD_normal_scenario_22_1e2        NA      NA          NA 1e+02  SMD_normal
16: SMD_normal_scenario_22_1e2        NA      NA          NA 1e+02  SMD_normal
17: SMD_normal_scenario_28_1e2        NA      NA          NA 1e+02  SMD_normal
18: SMD_normal_scenario_28_1e2        NA      NA          NA 1e+02  SMD_normal
19:  SMD_normal_scenario_4_1e2        NA      NA          NA 1e+02  SMD_normal
20:  SMD_normal_scenario_4_1e2        NA      NA          NA 1e+02  SMD_normal
21:     SMD_normal_scenario_15        NA      NA          NA 1e+05  SMD_normal
22:     SMD_normal_scenario_15        NA      NA          NA 1e+05  SMD_normal
23:     SMD_normal_scenario_27        NA      NA          NA 1e+05  SMD_normal
24:     SMD_normal_scenario_27        NA      NA          NA 1e+05  SMD_normal
25:      SMD_normal_scenario_3        NA      NA          NA 1e+05  SMD_normal
26:      SMD_normal_scenario_3        NA      NA          NA 1e+05  SMD_normal
27:     SMD_normal_scenario_10        NA      NA          NA 1e+06  SMD_normal
28:     SMD_normal_scenario_10        NA      NA          NA 1e+06  SMD_normal
29:     SMD_normal_scenario_16        NA      NA          NA 1e+06  SMD_normal
30:     SMD_normal_scenario_16        NA      NA          NA 1e+06  SMD_normal
31:     SMD_normal_scenario_22        NA      NA          NA 1e+06  SMD_normal
32:     SMD_normal_scenario_22        NA      NA          NA 1e+06  SMD_normal
33:     SMD_normal_scenario_28        NA      NA          NA 1e+06  SMD_normal
34:     SMD_normal_scenario_28        NA      NA          NA 1e+06  SMD_normal
35:      SMD_normal_scenario_4        NA      NA          NA 1e+06  SMD_normal
36:      SMD_normal_scenario_4        NA      NA          NA 1e+06  SMD_normal
                   scenario_id true_mean true_sd sample_size boots effect_type
    true_mean1 true_mean2 true_sd1 true_sd2 sample_size1 sample_size_ratio
         &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;        &lt;num&gt;             &lt;num&gt;
 1:       13.4       16.1      4.6      3.9           10                 1
 2:       13.4       16.1      4.6      3.9           10                 1
 3:       13.4       16.1      4.6      3.9           50                 1
 4:       13.4       16.1      4.6      3.9           50                 1
 5:       13.4       16.1      4.6      3.9          100                 1
 6:       13.4       16.1      4.6      3.9          100                 1
 7:       13.4       16.1      4.6      3.9          150                 1
 8:       13.4       16.1      4.6      3.9          150                 1
 9:       13.4       16.1      4.6      3.9            5                 1
10:       13.4       16.1      4.6      3.9            5                 1
11:       13.4       16.1      4.6      3.9           10                 1
12:       13.4       16.1      4.6      3.9           10                 1
13:       13.4       16.1      4.6      3.9           50                 1
14:       13.4       16.1      4.6      3.9           50                 1
15:       13.4       16.1      4.6      3.9          100                 1
16:       13.4       16.1      4.6      3.9          100                 1
17:       13.4       16.1      4.6      3.9          150                 1
18:       13.4       16.1      4.6      3.9          150                 1
19:       13.4       16.1      4.6      3.9            5                 1
20:       13.4       16.1      4.6      3.9            5                 1
21:       13.4       16.1      4.6      3.9           50                 1
22:       13.4       16.1      4.6      3.9           50                 1
23:       13.4       16.1      4.6      3.9          150                 1
24:       13.4       16.1      4.6      3.9          150                 1
25:       13.4       16.1      4.6      3.9            5                 1
26:       13.4       16.1      4.6      3.9            5                 1
27:       13.4       16.1      4.6      3.9           10                 1
28:       13.4       16.1      4.6      3.9           10                 1
29:       13.4       16.1      4.6      3.9           50                 1
30:       13.4       16.1      4.6      3.9           50                 1
31:       13.4       16.1      4.6      3.9          100                 1
32:       13.4       16.1      4.6      3.9          100                 1
33:       13.4       16.1      4.6      3.9          150                 1
34:       13.4       16.1      4.6      3.9          150                 1
35:       13.4       16.1      4.6      3.9            5                 1
36:       13.4       16.1      4.6      3.9            5                 1
    true_mean1 true_mean2 true_sd1 true_sd2 sample_size1 sample_size_ratio
    sample_size2 true_p_a true_p_c    n1 n_ratio    n2 true_a true_c true_b
           &lt;num&gt;    &lt;num&gt;    &lt;num&gt; &lt;num&gt;   &lt;num&gt; &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt;
 1:           10       NA       NA    NA      NA    NA     NA     NA     NA
 2:           10       NA       NA    NA      NA    NA     NA     NA     NA
 3:           50       NA       NA    NA      NA    NA     NA     NA     NA
 4:           50       NA       NA    NA      NA    NA     NA     NA     NA
 5:          100       NA       NA    NA      NA    NA     NA     NA     NA
 6:          100       NA       NA    NA      NA    NA     NA     NA     NA
 7:          150       NA       NA    NA      NA    NA     NA     NA     NA
 8:          150       NA       NA    NA      NA    NA     NA     NA     NA
 9:            5       NA       NA    NA      NA    NA     NA     NA     NA
10:            5       NA       NA    NA      NA    NA     NA     NA     NA
11:           10       NA       NA    NA      NA    NA     NA     NA     NA
12:           10       NA       NA    NA      NA    NA     NA     NA     NA
13:           50       NA       NA    NA      NA    NA     NA     NA     NA
14:           50       NA       NA    NA      NA    NA     NA     NA     NA
15:          100       NA       NA    NA      NA    NA     NA     NA     NA
16:          100       NA       NA    NA      NA    NA     NA     NA     NA
17:          150       NA       NA    NA      NA    NA     NA     NA     NA
18:          150       NA       NA    NA      NA    NA     NA     NA     NA
19:            5       NA       NA    NA      NA    NA     NA     NA     NA
20:            5       NA       NA    NA      NA    NA     NA     NA     NA
21:           50       NA       NA    NA      NA    NA     NA     NA     NA
22:           50       NA       NA    NA      NA    NA     NA     NA     NA
23:          150       NA       NA    NA      NA    NA     NA     NA     NA
24:          150       NA       NA    NA      NA    NA     NA     NA     NA
25:            5       NA       NA    NA      NA    NA     NA     NA     NA
26:            5       NA       NA    NA      NA    NA     NA     NA     NA
27:           10       NA       NA    NA      NA    NA     NA     NA     NA
28:           10       NA       NA    NA      NA    NA     NA     NA     NA
29:           50       NA       NA    NA      NA    NA     NA     NA     NA
30:           50       NA       NA    NA      NA    NA     NA     NA     NA
31:          100       NA       NA    NA      NA    NA     NA     NA     NA
32:          100       NA       NA    NA      NA    NA     NA     NA     NA
33:          150       NA       NA    NA      NA    NA     NA     NA     NA
34:          150       NA       NA    NA      NA    NA     NA     NA     NA
35:            5       NA       NA    NA      NA    NA     NA     NA     NA
36:            5       NA       NA    NA      NA    NA     NA     NA     NA
    sample_size2 true_p_a true_p_c    n1 n_ratio    n2 true_a true_c true_b
    true_d  p_AA  p_Aa  p_aa     n true_n_AA true_n_Aa true_n_aa        value
     &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;        &lt;num&gt;
 1:     NA    NA    NA    NA    NA        NA        NA        NA 0.4977615026
 2:     NA    NA    NA    NA    NA        NA        NA        NA 0.2145877161
 3:     NA    NA    NA    NA    NA        NA        NA        NA 0.2165617273
 4:     NA    NA    NA    NA    NA        NA        NA        NA 0.0211108344
 5:     NA    NA    NA    NA    NA        NA        NA        NA 0.1529327990
 6:     NA    NA    NA    NA    NA        NA        NA        NA 0.0102218119
 7:     NA    NA    NA    NA    NA        NA        NA        NA 0.1246954929
 8:     NA    NA    NA    NA    NA        NA        NA        NA 0.0067395090
 9:     NA    NA    NA    NA    NA        NA        NA        NA 0.7746612804
10:     NA    NA    NA    NA    NA        NA        NA        NA 1.2801863188
11:     NA    NA    NA    NA    NA        NA        NA        NA 0.4735927112
12:     NA    NA    NA    NA    NA        NA        NA        NA 0.0801127097
13:     NA    NA    NA    NA    NA        NA        NA        NA 0.2066875984
14:     NA    NA    NA    NA    NA        NA        NA        NA 0.0066002261
15:     NA    NA    NA    NA    NA        NA        NA        NA 0.1458986233
16:     NA    NA    NA    NA    NA        NA        NA        NA 0.0031239117
17:     NA    NA    NA    NA    NA        NA        NA        NA 0.1193598430
18:     NA    NA    NA    NA    NA        NA        NA        NA 0.0020517964
19:     NA    NA    NA    NA    NA        NA        NA        NA 0.7366167096
20:     NA    NA    NA    NA    NA        NA        NA        NA 2.3868664331
21:     NA    NA    NA    NA    NA        NA        NA        NA 0.2060319522
22:     NA    NA    NA    NA    NA        NA        NA        NA 0.0016731784
23:     NA    NA    NA    NA    NA        NA        NA        NA 0.1187903536
24:     NA    NA    NA    NA    NA        NA        NA        NA 0.0002819999
25:     NA    NA    NA    NA    NA        NA        NA        NA 0.7350439120
26:     NA    NA    NA    NA    NA        NA        NA        NA 0.2459518810
27:     NA    NA    NA    NA    NA        NA        NA        NA 0.4681304850
28:     NA    NA    NA    NA    NA        NA        NA        NA 0.0443233430
29:     NA    NA    NA    NA    NA        NA        NA        NA 0.2055419453
30:     NA    NA    NA    NA    NA        NA        NA        NA 0.0016497141
31:     NA    NA    NA    NA    NA        NA        NA        NA 0.1454850541
32:     NA    NA    NA    NA    NA        NA        NA        NA 0.0005229205
33:     NA    NA    NA    NA    NA        NA        NA        NA 0.1185157995
34:     NA    NA    NA    NA    NA        NA        NA        NA 0.0002752958
35:     NA    NA    NA    NA    NA        NA        NA        NA 0.7326821610
36:     NA    NA    NA    NA    NA        NA        NA        NA 0.2393500176
    true_d  p_AA  p_Aa  p_aa     n true_n_AA true_n_Aa true_n_aa        value
    estimator estimand calculation estimate_of
       &lt;char&gt;   &lt;char&gt;      &lt;char&gt;      &lt;char&gt;
 1:      safe       NA          SD       point
 2:      safe       NA          SD    variance
 3:      safe       NA          SD       point
 4:      safe       NA          SD    variance
 5:      safe       NA          SD       point
 6:      safe       NA          SD    variance
 7:      safe       NA          SD       point
 8:      safe       NA          SD    variance
 9:      safe       NA          SD       point
10:      safe       NA          SD    variance
11:      safe       NA          SD       point
12:      safe       NA          SD    variance
13:      safe       NA          SD       point
14:      safe       NA          SD    variance
15:      safe       NA          SD       point
16:      safe       NA          SD    variance
17:      safe       NA          SD       point
18:      safe       NA          SD    variance
19:      safe       NA          SD       point
20:      safe       NA          SD    variance
21:      safe       NA          SD       point
22:      safe       NA          SD    variance
23:      safe       NA          SD       point
24:      safe       NA          SD    variance
25:      safe       NA          SD       point
26:      safe       NA          SD    variance
27:      safe       NA          SD       point
28:      safe       NA          SD    variance
29:      safe       NA          SD       point
30:      safe       NA          SD    variance
31:      safe       NA          SD       point
32:      safe       NA          SD    variance
33:      safe       NA          SD       point
34:      safe       NA          SD    variance
35:      safe       NA          SD       point
36:      safe       NA          SD    variance
    estimator estimand calculation estimate_of</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-2-multivariate-normal-and-2-wishart-1" class="level3"><h3 class="anchored" data-anchor-id="smd-2-multivariate-normal-and-2-wishart-1">SMD 2-multivariate normal and 2-Wishart</h3>
<p>With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-4-multivariate-normal-1" class="level3"><h3 class="anchored" data-anchor-id="lncvr-4-multivariate-normal-1">lnCVR 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-2-multivariate-normal-and-2-wishart-1" class="level3"><h3 class="anchored" data-anchor-id="lncvr-2-multivariate-normal-and-2-wishart-1">lnCVR 2-multivariate normal and 2-Wishart</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnor-1" class="level3"><h3 class="anchored" data-anchor-id="lnor-1">lnOR</h3>
<p>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for ‘a’ and ‘c’.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr-1" class="level3"><h3 class="anchored" data-anchor-id="lnrr-1">lnRR</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘a’ and ‘c’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="hardy-weinberg-disequilibrium-1" class="level3"><h3 class="anchored" data-anchor-id="hardy-weinberg-disequilibrium-1">Hardy Weinberg Disequilibrium</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘n_AA’, ‘n_Aa’, and ‘n_aa’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->

</section></section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb54" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "SAFE"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "step by step online tutorial"</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Shinichi Nakagawa</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ayumi Mizuno</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Santiago Ortega</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Daniel Noble</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Alistair Senior</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Erick J Lundgren</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: many others order TBD</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 6</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: true</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "**CONTENTS**"</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co">    output-file: "index.html"</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co">    # embed-resources: true</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co">    # code-fold: true</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="co">    # number-sections: false</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="co">    # bibliography: ./bib/ref.bib</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: "10"</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Helvetica"</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: "Fira Code"</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="co">    # fontcolor: ""</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: article</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="co">    df_print: paged</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="co">    code-line-numbers: false</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="co">      margin-width: 120px</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="co"># crossref: </span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-title: Figure     # (default is "Figure")</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-title: Table     # (default is "Table")</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   title-delim: "—"     # (default is ":")</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-prefix: Fig.     # (default is "Figure")</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-prefix: Table.   # (default is "Table")</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="co">  tidy: true</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren\@gmail.com).</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>The simulations take a long time to run on a personal computer. We have therefore uploaded all simulation results as .Rds files, though we show exactly how we ran the simulations.</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>To run the code interactively (instead of just reading this lovely tutorial), do the following:</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Clone the github repo: https://github.com/ejlundgren/SAFE.git</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session or just follow along here on the web :)</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load libraries</span></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>The <span class="in">`groundhog`</span> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <span class="in">`groundhog`</span> if it is not already installed with <span class="in">`install.packages()`</span>.</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a><span class="co"># First, clean the environment:</span></span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Now load packages:</span></span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("groundhog")</span></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"groundhog"</span>)</span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a><span class="fu">groundhog.library</span>(<span class="at">pkg =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"crayon"</span>, </span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"tmvtnorm"</span>, <span class="st">"here"</span>,</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"parallel"</span>, <span class="st">"foreach"</span>, <span class="st">"doSNOW"</span>,</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ggplot2"</span>, <span class="st">"patchwork"</span>, <span class="st">"scico"</span>),</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date =</span> <span class="st">"2025-04-15"</span>)</span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="fu"># An introduction to SAFE bootstrapping</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>SAFE bootstrapping is an incredible, seemingly magical, technique to calculate variance estimates for effect sizes, for which sampling variance formulas may not be known. In some cases, it is also more unbiased than traditional plugin formulas for variance and point estimates (i.e., the effect size itself).</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## How does it work?</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a>With SAFE bootstrapping, one draws a cloud of *hyperparameters* of all variables used in an effect size formula. You then apply your effect size formula to this cloud. The variance of this transformed cloud, is the sampling variance of your effect size! </span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>You can then calculate a bias-transformed point estimate by taking the mean of this transformed cloud and subtracting 2 times the point estimate derived simply from the original variables.</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a>Let's demonstrate.</span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a>Imagine you want to create an effect size of 'speed' from mean latency time (e.g., time until an event happens). Here let's start with 3 mean latency times and convert to our new 'speed' effect size</span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a>mean_latency <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">21</span>)</span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">31</span>, <span class="dv">50</span>)</span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.6</span>, <span class="fl">3.1</span>, <span class="fl">2.5</span>)</span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a><span class="co"># New effect size:</span></span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>mean_latency</span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a>The effect size is trivial to calculate. But what is the sampling variance of this effect size, given that each of these measurements was associated with measurement sample size and standard deviation?</span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a>You could use calculus to derive a first-order sampling variance formula. Or you could use SAFE. </span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: draw hyperparameters.</span></span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a>If the word 'hyperparameter' is scary, what we mean is a distribution of the variables associated with the definition formula of the effect size, in this case <span class="in">`latency`</span>. Let's draw 10,000 samples of this hyperparameter from a normal distribution. To avoid using <span class="in">`lapply`</span> or loops, let's just use SAFE to calculate variance for the first mean latency time. We'll calculate standard error from the associated standard deviation and sample size to capture the dispersion of this hyperparameter.</span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a>**Shinichi, I don't fully understand why we square root the N for this effect size but not the others**</span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">15</span> <span class="co"># The mean</span></span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fl">4.6</span> <span class="co"># standard deviation</span></span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span> <span class="co"># sample size</span></span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a>cloud <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e6</span>,</span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a>               <span class="at">mean =</span> x,</span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a>               <span class="at">sd =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n))</span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cloud)</span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cloud)</span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: transform hyperparameters to target effect size</span></span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a>Now, let's transform this cloud of hyperparameters to 'speed' with our definition formula <span class="in">`1/x`</span></span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a>cloud_trans <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>cloud</span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cloud_trans)</span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-146"><a href="#cb54-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-147"><a href="#cb54-147" aria-hidden="true" tabindex="-1"></a>These values are similar to our transformed effect size:</span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a>plugin_effect_size <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>x</span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a>plugin_effect_size</span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Calculate sampling variance</span></span>
<span id="cb54-160"><a href="#cb54-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-161"><a href="#cb54-161" aria-hidden="true" tabindex="-1"></a>To calculate sampling variance for our effect size we calculate standard error of this transformed cloud. This can be confusing: you do this with <span class="in">`sd`</span>, the standard deviation function because this is a hyperparameter (not a population). Squaring this produces sampling variance:</span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a>safe_SE <span class="ot">&lt;-</span> <span class="fu">sd</span>(cloud_trans)</span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-168"><a href="#cb54-168" aria-hidden="true" tabindex="-1"></a>safe_vi <span class="ot">&lt;-</span> safe_SE<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb54-169"><a href="#cb54-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a>safe_vi</span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a>Voila! Sampling variance for a novel effect size. </span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Calculate bias-corrected effect size</span></span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-177"><a href="#cb54-177" aria-hidden="true" tabindex="-1"></a>However, given low sample sizes for some measurements, and the knowledge that point estimates can be biased at low N, let's also calculate a bias-corrected point estimate from this cloud of hyperparameters:</span>
<span id="cb54-178"><a href="#cb54-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-182"><a href="#cb54-182" aria-hidden="true" tabindex="-1"></a>safe_yi <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> plugin_effect_size) <span class="sc">-</span> <span class="fu">mean</span>(cloud_trans)</span>
<span id="cb54-183"><a href="#cb54-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a>safe_yi</span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a>Let's compare this to the original point estimate:</span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-192"><a href="#cb54-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-193"><a href="#cb54-193" aria-hidden="true" tabindex="-1"></a>safe_yi</span>
<span id="cb54-194"><a href="#cb54-194" aria-hidden="true" tabindex="-1"></a>plugin_effect_size</span>
<span id="cb54-195"><a href="#cb54-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-196"><a href="#cb54-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-197"><a href="#cb54-197" aria-hidden="true" tabindex="-1"></a>So similar! And potentially less biased. We'll find out below, where we use Monte Carlo simulations to compare the bias of estimates from SAFE to estimates from plugging into a formula.</span>
<span id="cb54-198"><a href="#cb54-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-199"><a href="#cb54-199" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load encapsulated functions</span></span>
<span id="cb54-200"><a href="#cb54-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-201"><a href="#cb54-201" aria-hidden="true" tabindex="-1"></a>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let's load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at tutorial/SAFE_function.R. This function returns a data.table (basically a *fast* data.frame) with columns for plugin effect sizes and sampling variances (denoted with <span class="in">`_first`</span> or <span class="in">`_second`</span> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <span class="in">`_safe`</span>). Point estimates (effect sizes) are denoted with <span class="in">`yi_`</span> while sampling variances are denoted with <span class="in">`vi_`</span>.</span>
<span id="cb54-202"><a href="#cb54-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-205"><a href="#cb54-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-206"><a href="#cb54-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-207"><a href="#cb54-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-208"><a href="#cb54-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-209"><a href="#cb54-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-210"><a href="#cb54-210" aria-hidden="true" tabindex="-1"></a><span class="co">#' *COMMENT OUT FOR RENDERING AND DELETE PRIOR TO PUBLICATION:*</span></span>
<span id="cb54-211"><a href="#cb54-211" aria-hidden="true" tabindex="-1"></a><span class="co"># setwd("tutorial")</span></span>
<span id="cb54-212"><a href="#cb54-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-213"><a href="#cb54-213" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"SAFE_function.R"</span>)</span>
<span id="cb54-214"><a href="#cb54-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-215"><a href="#cb54-215" aria-hidden="true" tabindex="-1"></a><span class="co"># For a single effect size and sampling variance:</span></span>
<span id="cb54-216"><a href="#cb54-216" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fl">14.5</span>, <span class="at">x2 =</span> <span class="fl">7.9</span>, </span>
<span id="cb54-217"><a href="#cb54-217" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fl">1.3</span>, <span class="at">sd2 =</span> <span class="dv">2</span>,</span>
<span id="cb54-218"><a href="#cb54-218" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="dv">20</span>, <span class="at">n2 =</span> <span class="dv">20</span>, </span>
<span id="cb54-219"><a href="#cb54-219" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb54-220"><a href="#cb54-220" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-221"><a href="#cb54-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-222"><a href="#cb54-222" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb54-223"><a href="#cb54-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-224"><a href="#cb54-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-225"><a href="#cb54-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-226"><a href="#cb54-226" aria-hidden="true" tabindex="-1"></a>Or with a vector of raw data:</span>
<span id="cb54-227"><a href="#cb54-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-228"><a href="#cb54-228" aria-hidden="true" tabindex="-1"></a>**UPDATE TO BE PARALLELIZED VERSION**</span>
<span id="cb54-229"><a href="#cb54-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-232"><a href="#cb54-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-233"><a href="#cb54-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-234"><a href="#cb54-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-235"><a href="#cb54-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-236"><a href="#cb54-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-237"><a href="#cb54-237" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">14.5</span>, <span class="dv">13</span>, <span class="fl">15.8</span>), </span>
<span id="cb54-238"><a href="#cb54-238" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">7.9</span>, <span class="dv">21</span>, <span class="fl">18.4</span>), </span>
<span id="cb54-239"><a href="#cb54-239" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fu">c</span>(<span class="fl">1.3</span>, <span class="dv">2</span>, <span class="fl">1.9</span>), </span>
<span id="cb54-240"><a href="#cb54-240" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd2 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span>),</span>
<span id="cb54-241"><a href="#cb54-241" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), </span>
<span id="cb54-242"><a href="#cb54-242" aria-hidden="true" tabindex="-1"></a>         <span class="at">n2 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">18</span>), </span>
<span id="cb54-243"><a href="#cb54-243" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"SMD"</span>,</span>
<span id="cb54-244"><a href="#cb54-244" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-245"><a href="#cb54-245" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-246"><a href="#cb54-246" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb54-247"><a href="#cb54-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-248"><a href="#cb54-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-249"><a href="#cb54-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-250"><a href="#cb54-250" aria-hidden="true" tabindex="-1"></a>For a full list of options that eff_size can calculate, please see information by running:</span>
<span id="cb54-251"><a href="#cb54-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-254"><a href="#cb54-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-255"><a href="#cb54-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-256"><a href="#cb54-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-257"><a href="#cb54-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-258"><a href="#cb54-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-259"><a href="#cb54-259" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>()</span>
<span id="cb54-260"><a href="#cb54-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-261"><a href="#cb54-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-262"><a href="#cb54-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-263"><a href="#cb54-263" aria-hidden="true" tabindex="-1"></a><span class="fu"># How good is SAFE?</span></span>
<span id="cb54-264"><a href="#cb54-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-265"><a href="#cb54-265" aria-hidden="true" tabindex="-1"></a>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size and the number of SAFE bootstraps. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let's look at the simulations for lnRoM:</span>
<span id="cb54-266"><a href="#cb54-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-269"><a href="#cb54-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-270"><a href="#cb54-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-271"><a href="#cb54-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-272"><a href="#cb54-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-273"><a href="#cb54-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-274"><a href="#cb54-274" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/scenarios.Rds"</span>)</span>
<span id="cb54-275"><a href="#cb54-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-276"><a href="#cb54-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset scenarios:</span></span>
<span id="cb54-277"><a href="#cb54-277" aria-hidden="true" tabindex="-1"></a>guide <span class="ot">&lt;-</span> scenarios[effect_type <span class="sc">==</span> <span class="st">"lnRoM"</span> <span class="sc">&amp;</span></span>
<span id="cb54-278"><a href="#cb54-278" aria-hidden="true" tabindex="-1"></a>                     boots <span class="sc">==</span> <span class="fl">1e6</span>, ]</span>
<span id="cb54-279"><a href="#cb54-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-280"><a href="#cb54-280" aria-hidden="true" tabindex="-1"></a>guide[, .(effect_type, scenario_id, boots,</span>
<span id="cb54-281"><a href="#cb54-281" aria-hidden="true" tabindex="-1"></a>                   true_mean1, true_mean2, </span>
<span id="cb54-282"><a href="#cb54-282" aria-hidden="true" tabindex="-1"></a>                   true_sd1, true_sd2,</span>
<span id="cb54-283"><a href="#cb54-283" aria-hidden="true" tabindex="-1"></a>                   sample_size1, sample_size2)]</span>
<span id="cb54-284"><a href="#cb54-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-285"><a href="#cb54-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-286"><a href="#cb54-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-287"><a href="#cb54-287" aria-hidden="true" tabindex="-1"></a>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the 'true' values and based on the simulated dataset. We did this 1e5 times for each scenario.</span>
<span id="cb54-288"><a href="#cb54-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-289"><a href="#cb54-289" aria-hidden="true" tabindex="-1"></a>In these Monte Carlo simulation, we were interested in bias, or the difference between the 'true' estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We'll explain the difference between estimands, estimators, and estimates below.</span>
<span id="cb54-290"><a href="#cb54-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-291"><a href="#cb54-291" aria-hidden="true" tabindex="-1"></a>To illustrate, we'll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we'll only run 100 simulations.</span>
<span id="cb54-292"><a href="#cb54-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-293"><a href="#cb54-293" aria-hidden="true" tabindex="-1"></a>To speed things up we will do this in parallel. The function <span class="in">`prepare_cluster()`</span> below can help set things up and provides a progress bar so you don't lose your mind wondering what's going on in there.</span>
<span id="cb54-294"><a href="#cb54-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-297"><a href="#cb54-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-298"><a href="#cb54-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-299"><a href="#cb54-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-300"><a href="#cb54-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-301"><a href="#cb54-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-302"><a href="#cb54-302" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb54-303"><a href="#cb54-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-304"><a href="#cb54-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare cluster:</span></span>
<span id="cb54-305"><a href="#cb54-305" aria-hidden="true" tabindex="-1"></a>prepare_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(n,</span>
<span id="cb54-306"><a href="#cb54-306" aria-hidden="true" tabindex="-1"></a>                             <span class="at">progress_bar =</span> <span class="cn">TRUE</span>){</span>
<span id="cb54-307"><a href="#cb54-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"parallel"</span>)</span>
<span id="cb54-308"><a href="#cb54-308" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"foreach"</span>)</span>
<span id="cb54-309"><a href="#cb54-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(<span class="st">"doSNOW"</span>)</span>
<span id="cb54-310"><a href="#cb54-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-311"><a href="#cb54-311" aria-hidden="true" tabindex="-1"></a>    nCores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb54-312"><a href="#cb54-312" aria-hidden="true" tabindex="-1"></a>    cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(nCores)</span>
<span id="cb54-313"><a href="#cb54-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb54-314"><a href="#cb54-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-315"><a href="#cb54-315" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Progress bar</span></span>
<span id="cb54-316"><a href="#cb54-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(progress_bar <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb54-317"><a href="#cb54-317" aria-hidden="true" tabindex="-1"></a>      pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">max =</span> n, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb54-318"><a href="#cb54-318" aria-hidden="true" tabindex="-1"></a>      progress <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="fu">setTxtProgressBar</span>(pb, n)</span>
<span id="cb54-319"><a href="#cb54-319" aria-hidden="true" tabindex="-1"></a>      opts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">progress =</span> progress)</span>
<span id="cb54-320"><a href="#cb54-320" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="fu">list</span>(opts, pb, cl)</span>
<span id="cb54-321"><a href="#cb54-321" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(ret) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span>)</span>
<span id="cb54-322"><a href="#cb54-322" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb54-323"><a href="#cb54-323" aria-hidden="true" tabindex="-1"></a>      ret <span class="ot">&lt;-</span> <span class="fu">list</span>(cl)</span>
<span id="cb54-324"><a href="#cb54-324" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(ret) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cluster"</span>)</span>
<span id="cb54-325"><a href="#cb54-325" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-326"><a href="#cb54-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-327"><a href="#cb54-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb54-328"><a href="#cb54-328" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-329"><a href="#cb54-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span id="cb54-330"><a href="#cb54-330" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span id="cb54-331"><a href="#cb54-331" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span>)</span>
<span id="cb54-332"><a href="#cb54-332" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-333"><a href="#cb54-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-334"><a href="#cb54-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-335"><a href="#cb54-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-336"><a href="#cb54-336" aria-hidden="true" tabindex="-1"></a>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized in Section **XXXX.** The first part of this code (inside the <span class="in">`lapply`</span>) creates simulated data based on 'true' means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the 'true' values and simulated values. Note that even with only 100 iterations, this can take a minute, so feel free to load the already run dummy dataset in the next code block.</span>
<span id="cb54-337"><a href="#cb54-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-340"><a href="#cb54-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-341"><a href="#cb54-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb54-342"><a href="#cb54-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-343"><a href="#cb54-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-344"><a href="#cb54-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-345"><a href="#cb54-345" aria-hidden="true" tabindex="-1"></a>rerun <span class="ot">&lt;-</span> F</span>
<span id="cb54-346"><a href="#cb54-346" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(rerun){</span>
<span id="cb54-347"><a href="#cb54-347" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-348"><a href="#cb54-348" aria-hidden="true" tabindex="-1"></a>  monte_carlo_N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb54-349"><a href="#cb54-349" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-350"><a href="#cb54-350" aria-hidden="true" tabindex="-1"></a>  clust_out <span class="ot">&lt;-</span> <span class="fu">prepare_cluster</span>(<span class="at">n =</span> monte_carlo_N)</span>
<span id="cb54-351"><a href="#cb54-351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-352"><a href="#cb54-352" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>monte_carlo_N, </span>
<span id="cb54-353"><a href="#cb54-353" aria-hidden="true" tabindex="-1"></a>         <span class="at">.options.snow =</span> clust_out<span class="sc">$</span>options,</span>
<span id="cb54-354"><a href="#cb54-354" aria-hidden="true" tabindex="-1"></a>         <span class="at">.errorhandling =</span> <span class="st">"pass"</span>,</span>
<span id="cb54-355"><a href="#cb54-355" aria-hidden="true" tabindex="-1"></a>         <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb54-356"><a href="#cb54-356" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb54-357"><a href="#cb54-357" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate 'true' values from scenario:</span></span>
<span id="cb54-358"><a href="#cb54-358" aria-hidden="true" tabindex="-1"></a>   true_point <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> guide<span class="sc">$</span>true_mean1, <span class="at">x2 =</span> guide<span class="sc">$</span>true_mean2,</span>
<span id="cb54-359"><a href="#cb54-359" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sd1 =</span> guide<span class="sc">$</span>true_sd1,  <span class="at">sd2 =</span> guide<span class="sc">$</span>true_sd2,</span>
<span id="cb54-360"><a href="#cb54-360" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb54-361"><a href="#cb54-361" aria-hidden="true" tabindex="-1"></a>                          <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb54-362"><a href="#cb54-362" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-363"><a href="#cb54-363" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-364"><a href="#cb54-364" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb54-365"><a href="#cb54-365" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(true_point,</span>
<span id="cb54-366"><a href="#cb54-366" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb54-367"><a href="#cb54-367" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb54-368"><a href="#cb54-368" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span id="cb54-369"><a href="#cb54-369" aria-hidden="true" tabindex="-1"></a>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span>))</span>
<span id="cb54-370"><a href="#cb54-370" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb54-371"><a href="#cb54-371" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span id="cb54-372"><a href="#cb54-372" aria-hidden="true" tabindex="-1"></a>   sim_dat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(guide), <span class="cf">function</span>(x){</span>
<span id="cb54-373"><a href="#cb54-373" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb54-374"><a href="#cb54-374" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Simulate data for guide</span></span>
<span id="cb54-375"><a href="#cb54-375" aria-hidden="true" tabindex="-1"></a>     sig <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">c</span>(guide<span class="sc">$</span>true_sd1[x]<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb54-376"><a href="#cb54-376" aria-hidden="true" tabindex="-1"></a>                   guide<span class="sc">$</span>true_sd2[x]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb54-377"><a href="#cb54-377" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb54-378"><a href="#cb54-378" aria-hidden="true" tabindex="-1"></a>     means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">m1 =</span> guide<span class="sc">$</span>true_mean1[x],</span>
<span id="cb54-379"><a href="#cb54-379" aria-hidden="true" tabindex="-1"></a>                <span class="at">m2 =</span> guide<span class="sc">$</span>true_mean2[x])</span>
<span id="cb54-380"><a href="#cb54-380" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb54-381"><a href="#cb54-381" aria-hidden="true" tabindex="-1"></a>     y <span class="ot">&lt;-</span> <span class="fu">rtmvnorm</span>(<span class="at">n =</span> <span class="fu">max</span>(<span class="fu">c</span>(guide<span class="sc">$</span>sample_size1[x], guide<span class="sc">$</span>sample_size2[x])),</span>
<span id="cb54-382"><a href="#cb54-382" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> means,</span>
<span id="cb54-383"><a href="#cb54-383" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma =</span> sig,</span>
<span id="cb54-384"><a href="#cb54-384" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lower =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(means)),</span>
<span id="cb54-385"><a href="#cb54-385" aria-hidden="true" tabindex="-1"></a>                     <span class="at">upper =</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, <span class="fu">length</span>(means)),</span>
<span id="cb54-386"><a href="#cb54-386" aria-hidden="true" tabindex="-1"></a>                     <span class="at">algorithm =</span> <span class="st">"gibbs"</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-387"><a href="#cb54-387" aria-hidden="true" tabindex="-1"></a>       <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb54-388"><a href="#cb54-388" aria-hidden="true" tabindex="-1"></a>       <span class="fu">setDT</span>()</span>
<span id="cb54-389"><a href="#cb54-389" aria-hidden="true" tabindex="-1"></a>     <span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m1"</span>, <span class="st">"m2"</span>)</span>
<span id="cb54-390"><a href="#cb54-390" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb54-391"><a href="#cb54-391" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Filter to number of samples per treatment</span></span>
<span id="cb54-392"><a href="#cb54-392" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x1 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size1[x], ]<span class="sc">$</span>m1,</span>
<span id="cb54-393"><a href="#cb54-393" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x2 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size2[x], ]<span class="sc">$</span>m2)</span>
<span id="cb54-394"><a href="#cb54-394" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb54-395"><a href="#cb54-395" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">sim_mean1 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb54-396"><a href="#cb54-396" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_mean2 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb54-397"><a href="#cb54-397" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd1 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb54-398"><a href="#cb54-398" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd2 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb54-399"><a href="#cb54-399" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sample_size1 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb54-400"><a href="#cb54-400" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sample_size2 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x2))</span>
<span id="cb54-401"><a href="#cb54-401" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>(sim_dat)</span>
<span id="cb54-402"><a href="#cb54-402" aria-hidden="true" tabindex="-1"></a>   }) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>()</span>
<span id="cb54-403"><a href="#cb54-403" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb54-404"><a href="#cb54-404" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-405"><a href="#cb54-405" aria-hidden="true" tabindex="-1"></a>   out <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> sim_dat<span class="sc">$</span>sim_mean1, <span class="at">x2 =</span> sim_dat<span class="sc">$</span>sim_mean2,</span>
<span id="cb54-406"><a href="#cb54-406" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd1 =</span> sim_dat<span class="sc">$</span>sim_sd1,  <span class="at">sd2 =</span> sim_dat<span class="sc">$</span>sim_sd2,</span>
<span id="cb54-407"><a href="#cb54-407" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb54-408"><a href="#cb54-408" aria-hidden="true" tabindex="-1"></a>                   <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb54-409"><a href="#cb54-409" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-410"><a href="#cb54-410" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-411"><a href="#cb54-411" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb54-412"><a href="#cb54-412" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(out,</span>
<span id="cb54-413"><a href="#cb54-413" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb54-414"><a href="#cb54-414" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb54-415"><a href="#cb54-415" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span id="cb54-416"><a href="#cb54-416" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span>))</span>
<span id="cb54-417"><a href="#cb54-417" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb54-418"><a href="#cb54-418" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Store results:</span></span>
<span id="cb54-419"><a href="#cb54-419" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> <span class="fu">data.table</span>(guide,</span>
<span id="cb54-420"><a href="#cb54-420" aria-hidden="true" tabindex="-1"></a>                         sim_dat,</span>
<span id="cb54-421"><a href="#cb54-421" aria-hidden="true" tabindex="-1"></a>                         true_point,</span>
<span id="cb54-422"><a href="#cb54-422" aria-hidden="true" tabindex="-1"></a>                         out)</span>
<span id="cb54-423"><a href="#cb54-423" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb54-424"><a href="#cb54-424" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setTxtProgressBar</span>(clust_out<span class="sc">$</span>progress, i)</span>
<span id="cb54-425"><a href="#cb54-425" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb54-426"><a href="#cb54-426" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(results)</span>
<span id="cb54-427"><a href="#cb54-427" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-428"><a href="#cb54-428" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-429"><a href="#cb54-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopCluster</span>(clust_out<span class="sc">$</span>cluster)</span>
<span id="cb54-430"><a href="#cb54-430" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-431"><a href="#cb54-431" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(res)  </span>
<span id="cb54-432"><a href="#cb54-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(res)</span>
<span id="cb54-433"><a href="#cb54-433" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-434"><a href="#cb54-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-435"><a href="#cb54-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-436"><a href="#cb54-436" aria-hidden="true" tabindex="-1"></a>Or just load the full simulation (1e5) here:</span>
<span id="cb54-437"><a href="#cb54-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-440"><a href="#cb54-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-441"><a href="#cb54-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-442"><a href="#cb54-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-443"><a href="#cb54-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-444"><a href="#cb54-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-445"><a href="#cb54-445" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/lnRoM_simulation.Rds"</span>)</span>
<span id="cb54-446"><a href="#cb54-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-447"><a href="#cb54-447" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res, <span class="dv">3</span>)</span>
<span id="cb54-448"><a href="#cb54-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-449"><a href="#cb54-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-450"><a href="#cb54-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-451"><a href="#cb54-451" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate bias</span></span>
<span id="cb54-452"><a href="#cb54-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-453"><a href="#cb54-453" aria-hidden="true" tabindex="-1"></a>To interpret the simulation results, it is essential to understand the difference between *estimands*, *estimators*, and *estimates*.</span>
<span id="cb54-454"><a href="#cb54-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-455"><a href="#cb54-455" aria-hidden="true" tabindex="-1"></a>**Estimands** are the 'true' value.</span>
<span id="cb54-456"><a href="#cb54-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-457"><a href="#cb54-457" aria-hidden="true" tabindex="-1"></a>**Estimators** are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges' g) to reduce bias, and the SAFE method.</span>
<span id="cb54-458"><a href="#cb54-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-459"><a href="#cb54-459" aria-hidden="true" tabindex="-1"></a>**Estimates** are the estimates of the estimands produced by the estimators.</span>
<span id="cb54-460"><a href="#cb54-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-461"><a href="#cb54-461" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect size (point estimate) bias</span></span>
<span id="cb54-462"><a href="#cb54-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-463"><a href="#cb54-463" aria-hidden="true" tabindex="-1"></a>In the case of our effect sizes, there are two estimands that we're interested in estimating: the 'true' effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the 'true' values).</span>
<span id="cb54-464"><a href="#cb54-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-465"><a href="#cb54-465" aria-hidden="true" tabindex="-1"></a>Here we will calculate bias in our estimates of effect sizes:</span>
<span id="cb54-466"><a href="#cb54-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-469"><a href="#cb54-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-470"><a href="#cb54-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-471"><a href="#cb54-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-472"><a href="#cb54-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-473"><a href="#cb54-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-474"><a href="#cb54-474" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates, estimand){</span>
<span id="cb54-475"><a href="#cb54-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand))</span>
<span id="cb54-476"><a href="#cb54-476" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-477"><a href="#cb54-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-478"><a href="#cb54-478" aria-hidden="true" tabindex="-1"></a>point.bias <span class="ot">&lt;-</span> res[, .(<span class="at">plugin_1st =</span> <span class="fu">bias</span>(sim_y_plugin_1st, true_y_plugin_1st),</span>
<span id="cb54-479"><a href="#cb54-479" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plugin_2nd =</span> <span class="fu">bias</span>(sim_y_plugin_2nd, true_y_plugin_1st),</span>
<span id="cb54-480"><a href="#cb54-480" aria-hidden="true" tabindex="-1"></a>                      <span class="at">safe =</span> <span class="fu">bias</span>(yi_safe, true_y_plugin_1st)),</span>
<span id="cb54-481"><a href="#cb54-481" aria-hidden="true" tabindex="-1"></a>                  by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb54-482"><a href="#cb54-482" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias)</span>
<span id="cb54-483"><a href="#cb54-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-484"><a href="#cb54-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt this to make it plottable:</span></span>
<span id="cb54-485"><a href="#cb54-485" aria-hidden="true" tabindex="-1"></a>point.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(point.bias,</span>
<span id="cb54-486"><a href="#cb54-486" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>),</span>
<span id="cb54-487"><a href="#cb54-487" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value.name =</span> <span class="st">"bias"</span>,</span>
<span id="cb54-488"><a href="#cb54-488" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.name =</span> <span class="st">"estimator"</span>)</span>
<span id="cb54-489"><a href="#cb54-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-490"><a href="#cb54-490" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias.long)</span>
<span id="cb54-491"><a href="#cb54-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-492"><a href="#cb54-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by sample size </span></span>
<span id="cb54-493"><a href="#cb54-493" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(point.bias.long, sample_size1)</span>
<span id="cb54-494"><a href="#cb54-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-495"><a href="#cb54-495" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> point.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ],</span>
<span id="cb54-496"><a href="#cb54-496" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> bias, <span class="at">color =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-497"><a href="#cb54-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-498"><a href="#cb54-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-499"><a href="#cb54-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-500"><a href="#cb54-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Bias"</span>)<span class="sc">+</span></span>
<span id="cb54-501"><a href="#cb54-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb54-502"><a href="#cb54-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb54-503"><a href="#cb54-503" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_bias"</span> <span class="ot">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span id="cb54-504"><a href="#cb54-504" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd_bias"</span> <span class="ot">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span id="cb54-505"><a href="#cb54-505" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"safe_bias"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>),</span>
<span id="cb54-506"><a href="#cb54-506" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb54-507"><a href="#cb54-507" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb54-508"><a href="#cb54-508" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>))<span class="sc">+</span></span>
<span id="cb54-509"><a href="#cb54-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-510"><a href="#cb54-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-511"><a href="#cb54-511" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-512"><a href="#cb54-512" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-513"><a href="#cb54-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-514"><a href="#cb54-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-515"><a href="#cb54-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-516"><a href="#cb54-516" aria-hidden="true" tabindex="-1"></a>This indicates that the least biased estimator is the first order definition formula (light blue). SAFE (red) and the 2nd order plugin (navy blue) perform similarly. These bias values are incredibly small, indicating that all options are fair, except for at low sample sizes, when the first-order definition formula is quite biased.</span>
<span id="cb54-517"><a href="#cb54-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-518"><a href="#cb54-518" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling variance bias</span></span>
<span id="cb54-519"><a href="#cb54-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-520"><a href="#cb54-520" aria-hidden="true" tabindex="-1"></a>Interestingly, there is no way to know the 'true' estimand for sampling variance. **WHICH I DON'T FULLY UNDERSTAND**. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use *each* of these as the estimand. With 3 estimators, and thus 3 estimands, we'll thus end up with 9 calculations of bias.</span>
<span id="cb54-521"><a href="#cb54-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-522"><a href="#cb54-522" aria-hidden="true" tabindex="-1"></a>Since we're interested in relative bias (**Not entirely sure why**), we'll calculate bias as above but divide by the estimand and multiply by 100.</span>
<span id="cb54-523"><a href="#cb54-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-526"><a href="#cb54-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-527"><a href="#cb54-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb54-528"><a href="#cb54-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-529"><a href="#cb54-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-530"><a href="#cb54-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-531"><a href="#cb54-531" aria-hidden="true" tabindex="-1"></a><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span id="cb54-532"><a href="#cb54-532" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_1st <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_1st), </span>
<span id="cb54-533"><a href="#cb54-533" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb54-534"><a href="#cb54-534" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_2nd <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_2nd), </span>
<span id="cb54-535"><a href="#cb54-535" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb54-536"><a href="#cb54-536" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_SAFE <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(yi_safe), </span>
<span id="cb54-537"><a href="#cb54-537" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb54-538"><a href="#cb54-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-539"><a href="#cb54-539" aria-hidden="true" tabindex="-1"></a><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span id="cb54-540"><a href="#cb54-540" aria-hidden="true" tabindex="-1"></a>relative_bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates,</span>
<span id="cb54-541"><a href="#cb54-541" aria-hidden="true" tabindex="-1"></a>                          estimand){</span>
<span id="cb54-542"><a href="#cb54-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(((<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand)) <span class="sc">/</span> estimand) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb54-543"><a href="#cb54-543" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-544"><a href="#cb54-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-545"><a href="#cb54-545" aria-hidden="true" tabindex="-1"></a><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span id="cb54-546"><a href="#cb54-546" aria-hidden="true" tabindex="-1"></a>var.bias <span class="ot">&lt;-</span> res[, .(<span class="at">SAFE_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_1st),</span>
<span id="cb54-547"><a href="#cb54-547" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_2nd),</span>
<span id="cb54-548"><a href="#cb54-548" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_SAFE),</span>
<span id="cb54-549"><a href="#cb54-549" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_1st),</span>
<span id="cb54-550"><a href="#cb54-550" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_2nd),</span>
<span id="cb54-551"><a href="#cb54-551" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_SAFE),</span>
<span id="cb54-552"><a href="#cb54-552" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_1st),</span>
<span id="cb54-553"><a href="#cb54-553" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_2nd),</span>
<span id="cb54-554"><a href="#cb54-554" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_SAFE)),</span>
<span id="cb54-555"><a href="#cb54-555" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb54-556"><a href="#cb54-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-557"><a href="#cb54-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-558"><a href="#cb54-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Now melt:</span></span>
<span id="cb54-559"><a href="#cb54-559" aria-hidden="true" tabindex="-1"></a>var.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(var.bias,</span>
<span id="cb54-560"><a href="#cb54-560" aria-hidden="true" tabindex="-1"></a>                      <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>))</span>
<span id="cb54-561"><a href="#cb54-561" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(var.bias.long)</span>
<span id="cb54-562"><a href="#cb54-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-563"><a href="#cb54-563" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span id="cb54-564"><a href="#cb54-564" aria-hidden="true" tabindex="-1"></a>var.bias.long[, <span class="fu">c</span>(<span class="st">"Estimator"</span>, <span class="st">"Estimand"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable, <span class="st">"."</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb54-565"><a href="#cb54-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-566"><a href="#cb54-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataset by sample size</span></span>
<span id="cb54-567"><a href="#cb54-567" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(var.bias.long, sample_size1)</span>
<span id="cb54-568"><a href="#cb54-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-569"><a href="#cb54-569" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb54-570"><a href="#cb54-570" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> var.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ], </span>
<span id="cb54-571"><a href="#cb54-571" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> Estimator))<span class="sc">+</span></span>
<span id="cb54-572"><a href="#cb54-572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-573"><a href="#cb54-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-574"><a href="#cb54-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-575"><a href="#cb54-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Relative bias (%)"</span>)<span class="sc">+</span></span>
<span id="cb54-576"><a href="#cb54-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb54-577"><a href="#cb54-577" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_estimate"</span> <span class="ot">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span id="cb54-578"><a href="#cb54-578" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="ot">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span id="cb54-579"><a href="#cb54-579" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"SAFE_estimate"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>),</span>
<span id="cb54-580"><a href="#cb54-580" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_estimate"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb54-581"><a href="#cb54-581" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"plugin_2nd_estimate"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb54-582"><a href="#cb54-582" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"SAFE_estimate"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>))<span class="sc">+</span></span>
<span id="cb54-583"><a href="#cb54-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Estimand,</span>
<span id="cb54-584"><a href="#cb54-584" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-585"><a href="#cb54-585" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"1st_estimand"</span> <span class="ot">=</span> <span class="st">"1st order plugin estimand</span><span class="sc">\n</span><span class="st">(definition formula)"</span>,</span>
<span id="cb54-586"><a href="#cb54-586" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"2nd_estimand"</span> <span class="ot">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span id="cb54-587"><a href="#cb54-587" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"SAFE_estimand"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>)))<span class="sc">+</span></span>
<span id="cb54-588"><a href="#cb54-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-589"><a href="#cb54-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-590"><a href="#cb54-590" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-591"><a href="#cb54-591" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-592"><a href="#cb54-592" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-593"><a href="#cb54-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-594"><a href="#cb54-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-595"><a href="#cb54-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-596"><a href="#cb54-596" aria-hidden="true" tabindex="-1"></a>We see here that SAFE (red) is slightly more biased, but in a conservative direction, than the other estimators.</span>
<span id="cb54-597"><a href="#cb54-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-598"><a href="#cb54-598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot all simulations results</span></span>
<span id="cb54-599"><a href="#cb54-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-600"><a href="#cb54-600" aria-hidden="true" tabindex="-1"></a>Now let's look at the rest of the simulation results.</span>
<span id="cb54-601"><a href="#cb54-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-604"><a href="#cb54-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-605"><a href="#cb54-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb54-606"><a href="#cb54-606" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-607"><a href="#cb54-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-608"><a href="#cb54-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-609"><a href="#cb54-609" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/all_scenarios_summarized.Rds"</span>)</span>
<span id="cb54-610"><a href="#cb54-610" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> sim_results[boots <span class="sc">==</span> <span class="fl">1e6</span>, ]</span>
<span id="cb54-611"><a href="#cb54-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-612"><a href="#cb54-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-613"><a href="#cb54-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-614"><a href="#cb54-614" aria-hidden="true" tabindex="-1"></a><span class="fu">### Speed</span></span>
<span id="cb54-615"><a href="#cb54-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-616"><a href="#cb54-616" aria-hidden="true" tabindex="-1"></a>This was our dummy effect size in the beginning. How do the point and variance estimates calculated by SAFE compare to just calculating 1 / x for point estimates? </span>
<span id="cb54-617"><a href="#cb54-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-618"><a href="#cb54-618" aria-hidden="true" tabindex="-1"></a>Moreover, we compared the variance estimates from SAFE to variance estimates produced by a 1st-order derivative sampling variance formula derived with the delta method (denoted 1st order plugin here). Let's see which did better!</span>
<span id="cb54-619"><a href="#cb54-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-622"><a href="#cb54-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-623"><a href="#cb54-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-624"><a href="#cb54-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-625"><a href="#cb54-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-626"><a href="#cb54-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-627"><a href="#cb54-627" aria-hidden="true" tabindex="-1"></a>var_lab <span class="ot">&lt;-</span> <span class="st">"Relative bias of</span><span class="sc">\n</span><span class="st">variance estimates (%)"</span></span>
<span id="cb54-628"><a href="#cb54-628" aria-hidden="true" tabindex="-1"></a>point_lab <span class="ot">&lt;-</span> <span class="st">"Bias of point</span><span class="sc">\n</span><span class="st">estimates"</span></span>
<span id="cb54-629"><a href="#cb54-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-630"><a href="#cb54-630" aria-hidden="true" tabindex="-1"></a>theme_SAFE <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-631"><a href="#cb54-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-632"><a href="#cb54-632" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-633"><a href="#cb54-633" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-634"><a href="#cb54-634" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-635"><a href="#cb54-635" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb54-636"><a href="#cb54-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-637"><a href="#cb54-637" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"1st order plugin"</span>,</span>
<span id="cb54-638"><a href="#cb54-638" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"2nd order plugin"</span>,</span>
<span id="cb54-639"><a href="#cb54-639" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE"</span>)</span>
<span id="cb54-640"><a href="#cb54-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-641"><a href="#cb54-641" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb54-642"><a href="#cb54-642" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb54-643"><a href="#cb54-643" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>)</span>
<span id="cb54-644"><a href="#cb54-644" aria-hidden="true" tabindex="-1"></a>pt_size <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb54-645"><a href="#cb54-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-646"><a href="#cb54-646" aria-hidden="true" tabindex="-1"></a>facet_labs <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo 1st order plugin estimand"</span>,</span>
<span id="cb54-647"><a href="#cb54-647" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"plugin_2nd_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo 2nd order plugin estimand"</span>,</span>
<span id="cb54-648"><a href="#cb54-648" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"safe_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo SAFE variance estimand"</span>,</span>
<span id="cb54-649"><a href="#cb54-649" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"true_1st"</span> <span class="ot">=</span> <span class="st">"True 1st order point estimand"</span>,</span>
<span id="cb54-650"><a href="#cb54-650" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"true_2nd"</span> <span class="ot">=</span> <span class="st">"True 2nd order point estimand"</span>))</span>
<span id="cb54-651"><a href="#cb54-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-652"><a href="#cb54-652" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"reciprocal"</span>, ]</span>
<span id="cb54-653"><a href="#cb54-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-654"><a href="#cb54-654" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size)</span>
<span id="cb54-655"><a href="#cb54-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-656"><a href="#cb54-656" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb54-657"><a href="#cb54-657" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-658"><a href="#cb54-658" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-659"><a href="#cb54-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-660"><a href="#cb54-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-661"><a href="#cb54-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-662"><a href="#cb54-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-663"><a href="#cb54-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-664"><a href="#cb54-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-665"><a href="#cb54-665" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-666"><a href="#cb54-666" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-667"><a href="#cb54-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-668"><a href="#cb54-668" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-669"><a href="#cb54-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.0001</span>, <span class="fl">0.0001</span>))<span class="sc">+</span></span>
<span id="cb54-670"><a href="#cb54-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Speed (1 / x)"</span>)<span class="sc">+</span></span>
<span id="cb54-671"><a href="#cb54-671" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-672"><a href="#cb54-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-673"><a href="#cb54-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-674"><a href="#cb54-674" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb54-675"><a href="#cb54-675" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-676"><a href="#cb54-676" aria-hidden="true" tabindex="-1"></a>                 <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-677"><a href="#cb54-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-678"><a href="#cb54-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-679"><a href="#cb54-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-680"><a href="#cb54-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-681"><a href="#cb54-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-682"><a href="#cb54-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-683"><a href="#cb54-683" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-684"><a href="#cb54-684" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-685"><a href="#cb54-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-686"><a href="#cb54-686" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs,</span>
<span id="cb54-687"><a href="#cb54-687" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb54-688"><a href="#cb54-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb54-689"><a href="#cb54-689" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-690"><a href="#cb54-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-691"><a href="#cb54-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-692"><a href="#cb54-692" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb54-693"><a href="#cb54-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-694"><a href="#cb54-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-695"><a href="#cb54-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-696"><a href="#cb54-696" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 4-multivariate normal</span></span>
<span id="cb54-697"><a href="#cb54-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-698"><a href="#cb54-698" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-699"><a href="#cb54-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-702"><a href="#cb54-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-703"><a href="#cb54-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-704"><a href="#cb54-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-705"><a href="#cb54-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-706"><a href="#cb54-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-707"><a href="#cb54-707" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_normal"</span>, ]</span>
<span id="cb54-708"><a href="#cb54-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-709"><a href="#cb54-709" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb54-710"><a href="#cb54-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-711"><a href="#cb54-711" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb54-712"><a href="#cb54-712" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-713"><a href="#cb54-713" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-714"><a href="#cb54-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-715"><a href="#cb54-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-716"><a href="#cb54-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-717"><a href="#cb54-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-718"><a href="#cb54-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-719"><a href="#cb54-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-720"><a href="#cb54-720" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-721"><a href="#cb54-721" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-722"><a href="#cb54-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-723"><a href="#cb54-723" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-724"><a href="#cb54-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb54-725"><a href="#cb54-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD"</span>)<span class="sc">+</span></span>
<span id="cb54-726"><a href="#cb54-726" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-727"><a href="#cb54-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-728"><a href="#cb54-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-729"><a href="#cb54-729" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-730"><a href="#cb54-730" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb54-731"><a href="#cb54-731" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-732"><a href="#cb54-732" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-733"><a href="#cb54-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-734"><a href="#cb54-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-735"><a href="#cb54-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-736"><a href="#cb54-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-737"><a href="#cb54-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-738"><a href="#cb54-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-739"><a href="#cb54-739" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-740"><a href="#cb54-740" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">plugin_1st =</span> <span class="st">"Cohen's d"</span>, </span>
<span id="cb54-741"><a href="#cb54-741" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plugin_2nd =</span> <span class="st">"Hedges' g"</span>, </span>
<span id="cb54-742"><a href="#cb54-742" aria-hidden="true" tabindex="-1"></a>                                <span class="at">safe =</span> <span class="st">"SAFE"</span>))<span class="sc">+</span></span>
<span id="cb54-743"><a href="#cb54-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb54-744"><a href="#cb54-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-745"><a href="#cb54-745" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-746"><a href="#cb54-746" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Cohen's d estimand"</span>,</span>
<span id="cb54-747"><a href="#cb54-747" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"plugin_2nd_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Hedges' g estimand"</span>,</span>
<span id="cb54-748"><a href="#cb54-748" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"safe_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo SAFE variance estimand"</span>,</span>
<span id="cb54-749"><a href="#cb54-749" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_1st"</span> <span class="ot">=</span> <span class="st">"True Cohen's d point estimand"</span>,</span>
<span id="cb54-750"><a href="#cb54-750" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_2nd"</span> <span class="ot">=</span> <span class="st">"True Hedges' g point estimand"</span>)))<span class="sc">+</span></span>
<span id="cb54-751"><a href="#cb54-751" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-752"><a href="#cb54-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-753"><a href="#cb54-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-754"><a href="#cb54-754" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb54-755"><a href="#cb54-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-756"><a href="#cb54-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-757"><a href="#cb54-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-758"><a href="#cb54-758" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 2-multivariate normal and 2-Wishart</span></span>
<span id="cb54-759"><a href="#cb54-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-760"><a href="#cb54-760" aria-hidden="true" tabindex="-1"></a>With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</span>
<span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-768"><a href="#cb54-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-769"><a href="#cb54-769" aria-hidden="true" tabindex="-1"></a><span class="co"># sub_dat &lt;- sim_results[effect_type == "SMD_Wishart", ]</span></span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a><span class="co"># setorder(sub_dat, sample_size1)</span></span>
<span id="cb54-771"><a href="#cb54-771" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-772"><a href="#cb54-772" aria-hidden="true" tabindex="-1"></a><span class="co"># p.point &lt;- ggplot(data = sub_dat[calculation %in% c("bias") &amp; sample_size_ratio == 1, ], </span></span>
<span id="cb54-773"><a href="#cb54-773" aria-hidden="true" tabindex="-1"></a><span class="co">#                   aes(x = sample_size1, y = value, color = estimator,</span></span>
<span id="cb54-774"><a href="#cb54-774" aria-hidden="true" tabindex="-1"></a><span class="co">#                       group = estimator))+</span></span>
<span id="cb54-775"><a href="#cb54-775" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(yintercept = 0)+</span></span>
<span id="cb54-776"><a href="#cb54-776" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(lwd = 1)+</span></span>
<span id="cb54-777"><a href="#cb54-777" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = pt_size)+</span></span>
<span id="cb54-778"><a href="#cb54-778" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(point_lab)+</span></span>
<span id="cb54-779"><a href="#cb54-779" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab("Sample size")+</span></span>
<span id="cb54-780"><a href="#cb54-780" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "Estimator", </span></span>
<span id="cb54-781"><a href="#cb54-781" aria-hidden="true" tabindex="-1"></a><span class="co">#                      values = pal,</span></span>
<span id="cb54-782"><a href="#cb54-782" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = labs)+</span></span>
<span id="cb54-783"><a href="#cb54-783" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~estimand, </span></span>
<span id="cb54-784"><a href="#cb54-784" aria-hidden="true" tabindex="-1"></a><span class="co">#              labeller = facet_labs)+</span></span>
<span id="cb54-785"><a href="#cb54-785" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_cartesian(ylim = c(-0.1, 0.1))+</span></span>
<span id="cb54-786"><a href="#cb54-786" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("SMD (x1 - x2) / pooled SD",</span></span>
<span id="cb54-787"><a href="#cb54-787" aria-hidden="true" tabindex="-1"></a><span class="co">#           subtitle = "with n1==n2")+</span></span>
<span id="cb54-788"><a href="#cb54-788" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_SAFE+</span></span>
<span id="cb54-789"><a href="#cb54-789" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "none") </span></span>
<span id="cb54-790"><a href="#cb54-790" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-791"><a href="#cb54-791" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb54-792"><a href="#cb54-792" aria-hidden="true" tabindex="-1"></a><span class="co"># p.variance &lt;- ggplot(data = sub_dat[calculation %in% c("relative_bias") &amp; sample_size_ratio == 1, ], </span></span>
<span id="cb54-793"><a href="#cb54-793" aria-hidden="true" tabindex="-1"></a><span class="co">#                      aes(x = sample_size1, y = value, color = estimator,</span></span>
<span id="cb54-794"><a href="#cb54-794" aria-hidden="true" tabindex="-1"></a><span class="co">#                          group = estimator))+</span></span>
<span id="cb54-795"><a href="#cb54-795" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(yintercept = 0)+</span></span>
<span id="cb54-796"><a href="#cb54-796" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(lwd = 1)+</span></span>
<span id="cb54-797"><a href="#cb54-797" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = pt_size)+</span></span>
<span id="cb54-798"><a href="#cb54-798" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(var_lab)+</span></span>
<span id="cb54-799"><a href="#cb54-799" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab("Sample size")+</span></span>
<span id="cb54-800"><a href="#cb54-800" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "Estimator", </span></span>
<span id="cb54-801"><a href="#cb54-801" aria-hidden="true" tabindex="-1"></a><span class="co">#                      values = pal,</span></span>
<span id="cb54-802"><a href="#cb54-802" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c(plugin_1st = "Cohen's d", </span></span>
<span id="cb54-803"><a href="#cb54-803" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 plugin_2nd = "Hedges' g", </span></span>
<span id="cb54-804"><a href="#cb54-804" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 safe = "SAFE"))+</span></span>
<span id="cb54-805"><a href="#cb54-805" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~estimand, </span></span>
<span id="cb54-806"><a href="#cb54-806" aria-hidden="true" tabindex="-1"></a><span class="co">#              ncol = 1,</span></span>
<span id="cb54-807"><a href="#cb54-807" aria-hidden="true" tabindex="-1"></a><span class="co">#              labeller = as_labeller(c("plugin_1st_mc" = "Monte Carlo Cohen's d estimand",</span></span>
<span id="cb54-808"><a href="#cb54-808" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       "plugin_2nd_mc" = "Monte Carlo Hedges' g estimand",</span></span>
<span id="cb54-809"><a href="#cb54-809" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       "safe_mc" = "Monte Carlo SAFE variance estimand",</span></span>
<span id="cb54-810"><a href="#cb54-810" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       "true_1st" = "True Cohen's d point estimand",</span></span>
<span id="cb54-811"><a href="#cb54-811" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       "true_2nd" = "True Hedges' g point estimand")))+</span></span>
<span id="cb54-812"><a href="#cb54-812" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_cartesian(ylim = c(-60, 60))+</span></span>
<span id="cb54-813"><a href="#cb54-813" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_SAFE+</span></span>
<span id="cb54-814"><a href="#cb54-814" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom")</span></span>
<span id="cb54-815"><a href="#cb54-815" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-816"><a href="#cb54-816" aria-hidden="true" tabindex="-1"></a><span class="co"># p.point + xlab(NULL) + p.variance + plot_layout(ncol = 1, heights = c(1/4, 3/4))</span></span>
<span id="cb54-817"><a href="#cb54-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-818"><a href="#cb54-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-819"><a href="#cb54-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-820"><a href="#cb54-820" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 4-multivariate normal</span></span>
<span id="cb54-821"><a href="#cb54-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-822"><a href="#cb54-822" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-823"><a href="#cb54-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-826"><a href="#cb54-826" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-827"><a href="#cb54-827" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-828"><a href="#cb54-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-829"><a href="#cb54-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-830"><a href="#cb54-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-831"><a href="#cb54-831" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_normal"</span>, ]</span>
<span id="cb54-832"><a href="#cb54-832" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb54-833"><a href="#cb54-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-834"><a href="#cb54-834" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb54-835"><a href="#cb54-835" aria-hidden="true" tabindex="-1"></a>                                   sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb54-836"><a href="#cb54-836" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-837"><a href="#cb54-837" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-838"><a href="#cb54-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-839"><a href="#cb54-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-840"><a href="#cb54-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-841"><a href="#cb54-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-842"><a href="#cb54-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-843"><a href="#cb54-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-844"><a href="#cb54-844" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-845"><a href="#cb54-845" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-846"><a href="#cb54-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-847"><a href="#cb54-847" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-848"><a href="#cb54-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb54-849"><a href="#cb54-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR"</span>)<span class="sc">+</span></span>
<span id="cb54-850"><a href="#cb54-850" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-851"><a href="#cb54-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-852"><a href="#cb54-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-853"><a href="#cb54-853" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-854"><a href="#cb54-854" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb54-855"><a href="#cb54-855" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-856"><a href="#cb54-856" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-857"><a href="#cb54-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-858"><a href="#cb54-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-859"><a href="#cb54-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-860"><a href="#cb54-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-861"><a href="#cb54-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-862"><a href="#cb54-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-863"><a href="#cb54-863" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-864"><a href="#cb54-864" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-865"><a href="#cb54-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-866"><a href="#cb54-866" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-867"><a href="#cb54-867" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-868"><a href="#cb54-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">60</span>))<span class="sc">+</span></span>
<span id="cb54-869"><a href="#cb54-869" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-870"><a href="#cb54-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-871"><a href="#cb54-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-872"><a href="#cb54-872" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb54-873"><a href="#cb54-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-874"><a href="#cb54-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-875"><a href="#cb54-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-876"><a href="#cb54-876" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 2-multivariate normal and 2-Wishart</span></span>
<span id="cb54-877"><a href="#cb54-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-878"><a href="#cb54-878" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-879"><a href="#cb54-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-882"><a href="#cb54-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-883"><a href="#cb54-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-884"><a href="#cb54-884" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-885"><a href="#cb54-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-886"><a href="#cb54-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-887"><a href="#cb54-887" aria-hidden="true" tabindex="-1"></a><span class="co"># sub_dat &lt;- sim_results[effect_type == "lnCVR_Wishart", ]</span></span>
<span id="cb54-888"><a href="#cb54-888" aria-hidden="true" tabindex="-1"></a><span class="co"># setorder(sub_dat, sample_size1)</span></span>
<span id="cb54-889"><a href="#cb54-889" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-890"><a href="#cb54-890" aria-hidden="true" tabindex="-1"></a><span class="co"># p.point &lt;- ggplot(data = sub_dat[calculation %in% c("bias") &amp; </span></span>
<span id="cb54-891"><a href="#cb54-891" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    sample_size_ratio == 1, ], </span></span>
<span id="cb54-892"><a href="#cb54-892" aria-hidden="true" tabindex="-1"></a><span class="co">#                   aes(x = sample_size1, y = value, color = estimator,</span></span>
<span id="cb54-893"><a href="#cb54-893" aria-hidden="true" tabindex="-1"></a><span class="co">#                       group = estimator))+</span></span>
<span id="cb54-894"><a href="#cb54-894" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(yintercept = 0)+</span></span>
<span id="cb54-895"><a href="#cb54-895" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(lwd = 1)+</span></span>
<span id="cb54-896"><a href="#cb54-896" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = pt_size)+</span></span>
<span id="cb54-897"><a href="#cb54-897" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(point_lab)+</span></span>
<span id="cb54-898"><a href="#cb54-898" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab("Sample size")+</span></span>
<span id="cb54-899"><a href="#cb54-899" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "Estimator", </span></span>
<span id="cb54-900"><a href="#cb54-900" aria-hidden="true" tabindex="-1"></a><span class="co">#                      values = pal,</span></span>
<span id="cb54-901"><a href="#cb54-901" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = labs)+</span></span>
<span id="cb54-902"><a href="#cb54-902" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_cartesian(ylim = c(-0.05, 0.05))+</span></span>
<span id="cb54-903"><a href="#cb54-903" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~estimand, </span></span>
<span id="cb54-904"><a href="#cb54-904" aria-hidden="true" tabindex="-1"></a><span class="co">#              labeller = facet_labs)+</span></span>
<span id="cb54-905"><a href="#cb54-905" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("lnCVR",</span></span>
<span id="cb54-906"><a href="#cb54-906" aria-hidden="true" tabindex="-1"></a><span class="co">#           subtitle = "with n1==n2")+</span></span>
<span id="cb54-907"><a href="#cb54-907" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_SAFE+</span></span>
<span id="cb54-908"><a href="#cb54-908" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "none") #, legend.position.inside = c(.85, .85)</span></span>
<span id="cb54-909"><a href="#cb54-909" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-910"><a href="#cb54-910" aria-hidden="true" tabindex="-1"></a><span class="co"># #</span></span>
<span id="cb54-911"><a href="#cb54-911" aria-hidden="true" tabindex="-1"></a><span class="co"># p.variance &lt;- ggplot(data = sub_dat[calculation %in% c("relative_bias") &amp; sample_size_ratio == 1, ], </span></span>
<span id="cb54-912"><a href="#cb54-912" aria-hidden="true" tabindex="-1"></a><span class="co">#                      aes(x = sample_size1, y = value, color = estimator,</span></span>
<span id="cb54-913"><a href="#cb54-913" aria-hidden="true" tabindex="-1"></a><span class="co">#                          group = estimator))+</span></span>
<span id="cb54-914"><a href="#cb54-914" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_hline(yintercept = 0)+</span></span>
<span id="cb54-915"><a href="#cb54-915" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(lwd = 1)+</span></span>
<span id="cb54-916"><a href="#cb54-916" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = pt_size)+</span></span>
<span id="cb54-917"><a href="#cb54-917" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(var_lab)+</span></span>
<span id="cb54-918"><a href="#cb54-918" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab("Sample size")+</span></span>
<span id="cb54-919"><a href="#cb54-919" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "Estimator", </span></span>
<span id="cb54-920"><a href="#cb54-920" aria-hidden="true" tabindex="-1"></a><span class="co">#                      values = pal,</span></span>
<span id="cb54-921"><a href="#cb54-921" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = labs)+</span></span>
<span id="cb54-922"><a href="#cb54-922" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_cartesian(ylim = c(-30, 30))+</span></span>
<span id="cb54-923"><a href="#cb54-923" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~estimand, </span></span>
<span id="cb54-924"><a href="#cb54-924" aria-hidden="true" tabindex="-1"></a><span class="co">#              ncol = 1,</span></span>
<span id="cb54-925"><a href="#cb54-925" aria-hidden="true" tabindex="-1"></a><span class="co">#              labeller = facet_labs)+</span></span>
<span id="cb54-926"><a href="#cb54-926" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_SAFE+</span></span>
<span id="cb54-927"><a href="#cb54-927" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = "bottom")</span></span>
<span id="cb54-928"><a href="#cb54-928" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb54-929"><a href="#cb54-929" aria-hidden="true" tabindex="-1"></a><span class="co"># p.point + xlab(NULL) + p.variance + plot_layout(ncol = 1, heights = c(1/4, 3/4))</span></span>
<span id="cb54-930"><a href="#cb54-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-931"><a href="#cb54-931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-932"><a href="#cb54-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-933"><a href="#cb54-933" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR</span></span>
<span id="cb54-934"><a href="#cb54-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-935"><a href="#cb54-935" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for 'a' and 'c'.</span>
<span id="cb54-936"><a href="#cb54-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-939"><a href="#cb54-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-940"><a href="#cb54-940" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-941"><a href="#cb54-941" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-942"><a href="#cb54-942" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-943"><a href="#cb54-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-944"><a href="#cb54-944" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR"</span>, ]</span>
<span id="cb54-945"><a href="#cb54-945" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n1)</span>
<span id="cb54-946"><a href="#cb54-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-947"><a href="#cb54-947" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb54-948"><a href="#cb54-948" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-949"><a href="#cb54-949" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-950"><a href="#cb54-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-951"><a href="#cb54-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-952"><a href="#cb54-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-953"><a href="#cb54-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-954"><a href="#cb54-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-955"><a href="#cb54-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-956"><a href="#cb54-956" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-957"><a href="#cb54-957" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-958"><a href="#cb54-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand,</span>
<span id="cb54-959"><a href="#cb54-959" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-960"><a href="#cb54-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-961"><a href="#cb54-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>)<span class="sc">+</span></span>
<span id="cb54-962"><a href="#cb54-962" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-963"><a href="#cb54-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-964"><a href="#cb54-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-965"><a href="#cb54-965" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-966"><a href="#cb54-966" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb54-967"><a href="#cb54-967" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-968"><a href="#cb54-968" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-969"><a href="#cb54-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-970"><a href="#cb54-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-971"><a href="#cb54-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-972"><a href="#cb54-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-973"><a href="#cb54-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-974"><a href="#cb54-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-975"><a href="#cb54-975" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-976"><a href="#cb54-976" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-977"><a href="#cb54-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-978"><a href="#cb54-978" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-979"><a href="#cb54-979" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-980"><a href="#cb54-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>))<span class="sc">+</span></span>
<span id="cb54-981"><a href="#cb54-981" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-982"><a href="#cb54-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-983"><a href="#cb54-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-984"><a href="#cb54-984" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb54-985"><a href="#cb54-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-986"><a href="#cb54-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-987"><a href="#cb54-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-988"><a href="#cb54-988" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR</span></span>
<span id="cb54-989"><a href="#cb54-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-990"><a href="#cb54-990" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'a' and 'c' from a binomial distribution.</span>
<span id="cb54-991"><a href="#cb54-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-994"><a href="#cb54-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-995"><a href="#cb54-995" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-996"><a href="#cb54-996" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-997"><a href="#cb54-997" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-998"><a href="#cb54-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-999"><a href="#cb54-999" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR"</span>, ]</span>
<span id="cb54-1000"><a href="#cb54-1000" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n1)</span>
<span id="cb54-1001"><a href="#cb54-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1002"><a href="#cb54-1002" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) , ], </span>
<span id="cb54-1003"><a href="#cb54-1003" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-1004"><a href="#cb54-1004" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-1005"><a href="#cb54-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-1006"><a href="#cb54-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1007"><a href="#cb54-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1008"><a href="#cb54-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-1009"><a href="#cb54-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1010"><a href="#cb54-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-1011"><a href="#cb54-1011" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-1012"><a href="#cb54-1012" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-1013"><a href="#cb54-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-1014"><a href="#cb54-1014" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1015"><a href="#cb54-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, .<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-1016"><a href="#cb54-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>)<span class="sc">+</span></span>
<span id="cb54-1017"><a href="#cb54-1017" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1018"><a href="#cb54-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-1019"><a href="#cb54-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1020"><a href="#cb54-1020" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-1021"><a href="#cb54-1021" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb54-1022"><a href="#cb54-1022" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-1023"><a href="#cb54-1023" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-1024"><a href="#cb54-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-1025"><a href="#cb54-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1026"><a href="#cb54-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1027"><a href="#cb54-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-1028"><a href="#cb54-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1029"><a href="#cb54-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-1030"><a href="#cb54-1030" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-1031"><a href="#cb54-1031" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-1032"><a href="#cb54-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-1033"><a href="#cb54-1033" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-1034"><a href="#cb54-1034" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1035"><a href="#cb54-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb54-1036"><a href="#cb54-1036" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1037"><a href="#cb54-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1038"><a href="#cb54-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1039"><a href="#cb54-1039" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb54-1040"><a href="#cb54-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1041"><a href="#cb54-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1042"><a href="#cb54-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1043"><a href="#cb54-1043" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hardy Weinberg Disequilibrium</span></span>
<span id="cb54-1044"><a href="#cb54-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1045"><a href="#cb54-1045" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'n_AA', 'n_Aa', and 'n_aa' from a binomial distribution.</span>
<span id="cb54-1046"><a href="#cb54-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1049"><a href="#cb54-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1050"><a href="#cb54-1050" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1051"><a href="#cb54-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1052"><a href="#cb54-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1053"><a href="#cb54-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1054"><a href="#cb54-1054" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnHWE_A"</span>, ]</span>
<span id="cb54-1055"><a href="#cb54-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, n)</span>
<span id="cb54-1056"><a href="#cb54-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1057"><a href="#cb54-1057" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb54-1058"><a href="#cb54-1058" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-1059"><a href="#cb54-1059" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-1060"><a href="#cb54-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-1061"><a href="#cb54-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1062"><a href="#cb54-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1063"><a href="#cb54-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb54-1064"><a href="#cb54-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1065"><a href="#cb54-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-1066"><a href="#cb54-1066" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-1067"><a href="#cb54-1067" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-1068"><a href="#cb54-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-1069"><a href="#cb54-1069" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1070"><a href="#cb54-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb54-1071"><a href="#cb54-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnHWD"</span>)<span class="sc">+</span></span>
<span id="cb54-1072"><a href="#cb54-1072" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1073"><a href="#cb54-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb54-1074"><a href="#cb54-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1075"><a href="#cb54-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb54-1076"><a href="#cb54-1076" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb54-1077"><a href="#cb54-1077" aria-hidden="true" tabindex="-1"></a>                                   p_AA <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_aa <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_Aa <span class="sc">==</span> <span class="fl">0.5</span>, ], </span>
<span id="cb54-1078"><a href="#cb54-1078" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb54-1079"><a href="#cb54-1079" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb54-1080"><a href="#cb54-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb54-1081"><a href="#cb54-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1082"><a href="#cb54-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1083"><a href="#cb54-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb54-1084"><a href="#cb54-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1085"><a href="#cb54-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb54-1086"><a href="#cb54-1086" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb54-1087"><a href="#cb54-1087" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb54-1088"><a href="#cb54-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb54-1089"><a href="#cb54-1089" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb54-1090"><a href="#cb54-1090" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1091"><a href="#cb54-1091" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb54-1092"><a href="#cb54-1092" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1093"><a href="#cb54-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1094"><a href="#cb54-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1095"><a href="#cb54-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1096"><a href="#cb54-1096" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb54-1097"><a href="#cb54-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1098"><a href="#cb54-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1099"><a href="#cb54-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1100"><a href="#cb54-1100" aria-hidden="true" tabindex="-1"></a><span class="fu"># How many SAFE bootstraps?</span></span>
<span id="cb54-1101"><a href="#cb54-1101" aria-hidden="true" tabindex="-1"></a>The SAFE method relies on bootstrapping to calculate effect size point estimates and sampling variance. It's sort of magical how well it works! But, how many bootstraps are necessary? Let's find out by doing another Monte Carlo simulation, again of lnRoM. This time, instead of calculating bias, we'll look at the standard deviation of the point and sampling variance estimates as we change the number of bootstraps.</span>
<span id="cb54-1102"><a href="#cb54-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1103"><a href="#cb54-1103" aria-hidden="true" tabindex="-1"></a>Let's two bootstrap lengths: 100 and 1,000. We'll run the Monte Carlo simulation itself 1,000 times just to make this easy. (See below for full 1e5 simulation results)</span>
<span id="cb54-1104"><a href="#cb54-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1107"><a href="#cb54-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1108"><a href="#cb54-1108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create some scenarios based on combinations of sample size and boot-length</span></span>
<span id="cb54-1109"><a href="#cb54-1109" aria-hidden="true" tabindex="-1"></a>  scenario <span class="ot">&lt;-</span> <span class="fu">CJ</span>(<span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb54-1110"><a href="#cb54-1110" aria-hidden="true" tabindex="-1"></a>                 <span class="at">true_mean1 =</span> <span class="fl">13.4</span>, <span class="at">true_sd1 =</span> <span class="fl">4.6</span>,</span>
<span id="cb54-1111"><a href="#cb54-1111" aria-hidden="true" tabindex="-1"></a>                 <span class="at">true_mean2 =</span> <span class="fl">16.1</span>, <span class="at">true_sd2 =</span> <span class="fl">3.9</span>,</span>
<span id="cb54-1112"><a href="#cb54-1112" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sample_size1 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">150</span>),</span>
<span id="cb54-1113"><a href="#cb54-1113" aria-hidden="true" tabindex="-1"></a>                 <span class="at">boots =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">1000</span>))</span>
<span id="cb54-1114"><a href="#cb54-1114" aria-hidden="true" tabindex="-1"></a>  scenario[, sample_size2 <span class="sc">:</span><span class="er">=</span> sample_size1]</span>
<span id="cb54-1115"><a href="#cb54-1115" aria-hidden="true" tabindex="-1"></a>  scenario</span>
<span id="cb54-1116"><a href="#cb54-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1117"><a href="#cb54-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1118"><a href="#cb54-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1119"><a href="#cb54-1119" aria-hidden="true" tabindex="-1"></a>Now let's run this in a foreach loop. If you'd rather not run this on your machine, this will load the finished result below if <span class="in">`run`</span> == FALSE.</span>
<span id="cb54-1120"><a href="#cb54-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1123"><a href="#cb54-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1124"><a href="#cb54-1124" aria-hidden="true" tabindex="-1"></a>run <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb54-1125"><a href="#cb54-1125" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(run <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb54-1126"><a href="#cb54-1126" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb54-1127"><a href="#cb54-1127" aria-hidden="true" tabindex="-1"></a>  sub_scenario <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb54-1128"><a href="#cb54-1128" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb54-1129"><a href="#cb54-1129" aria-hidden="true" tabindex="-1"></a>  clust_out <span class="ot">&lt;-</span> <span class="fu">prepare_cluster</span>(<span class="at">n =</span> N, </span>
<span id="cb54-1130"><a href="#cb54-1130" aria-hidden="true" tabindex="-1"></a>                               <span class="at">progress_bar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-1131"><a href="#cb54-1131" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb54-1132"><a href="#cb54-1132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-1133"><a href="#cb54-1133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-1134"><a href="#cb54-1134" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>N, </span>
<span id="cb54-1135"><a href="#cb54-1135" aria-hidden="true" tabindex="-1"></a>                <span class="at">.options.snow =</span> clust_out<span class="sc">$</span>options,</span>
<span id="cb54-1136"><a href="#cb54-1136" aria-hidden="true" tabindex="-1"></a>               <span class="at">.errorhandling =</span> <span class="st">"stop"</span>,</span>
<span id="cb54-1137"><a href="#cb54-1137" aria-hidden="true" tabindex="-1"></a>               <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>,</span>
<span id="cb54-1138"><a href="#cb54-1138" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"crayon"</span>, <span class="st">"tmvtnorm"</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb54-1139"><a href="#cb54-1139" aria-hidden="true" tabindex="-1"></a>                               </span>
<span id="cb54-1140"><a href="#cb54-1140" aria-hidden="true" tabindex="-1"></a>   sub_scenario <span class="ot">&lt;-</span> scenario[boots <span class="sc">==</span> <span class="dv">100</span>, ]                                        </span>
<span id="cb54-1141"><a href="#cb54-1141" aria-hidden="true" tabindex="-1"></a>   out[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> sub_scenario<span class="sc">$</span>true_mean1,</span>
<span id="cb54-1142"><a href="#cb54-1142" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x2 =</span> sub_scenario<span class="sc">$</span>true_mean2,</span>
<span id="cb54-1143"><a href="#cb54-1143" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd1 =</span> sub_scenario<span class="sc">$</span>true_sd1,</span>
<span id="cb54-1144"><a href="#cb54-1144" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd2 =</span> sub_scenario<span class="sc">$</span>true_sd2,</span>
<span id="cb54-1145"><a href="#cb54-1145" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n1 =</span> sub_scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb54-1146"><a href="#cb54-1146" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n2 =</span> sub_scenario<span class="sc">$</span>sample_size2,</span>
<span id="cb54-1147"><a href="#cb54-1147" aria-hidden="true" tabindex="-1"></a>                   <span class="at">effect_type =</span> <span class="st">"SMD"</span>,</span>
<span id="cb54-1148"><a href="#cb54-1148" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-1149"><a href="#cb54-1149" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-1150"><a href="#cb54-1150" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE_boots =</span> <span class="fu">unique</span>(sub_scenario<span class="sc">$</span>boots)) </span>
<span id="cb54-1151"><a href="#cb54-1151" aria-hidden="true" tabindex="-1"></a>    out[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.table</span>(out[[<span class="dv">1</span>]],</span>
<span id="cb54-1152"><a href="#cb54-1152" aria-hidden="true" tabindex="-1"></a>                           sub_scenario[, .(boots, sample_size1)])</span>
<span id="cb54-1153"><a href="#cb54-1153" aria-hidden="true" tabindex="-1"></a>    out[[<span class="dv">1</span>]]</span>
<span id="cb54-1154"><a href="#cb54-1154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-1155"><a href="#cb54-1155" aria-hidden="true" tabindex="-1"></a>    sub_scenario <span class="ot">&lt;-</span> scenario[boots <span class="sc">==</span> <span class="dv">1000</span>, ]                                        </span>
<span id="cb54-1156"><a href="#cb54-1156" aria-hidden="true" tabindex="-1"></a>    out[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> sub_scenario<span class="sc">$</span>true_mean1,</span>
<span id="cb54-1157"><a href="#cb54-1157" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x2 =</span> sub_scenario<span class="sc">$</span>true_mean2,</span>
<span id="cb54-1158"><a href="#cb54-1158" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd1 =</span> sub_scenario<span class="sc">$</span>true_sd1,</span>
<span id="cb54-1159"><a href="#cb54-1159" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd2 =</span> sub_scenario<span class="sc">$</span>true_sd2,</span>
<span id="cb54-1160"><a href="#cb54-1160" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n1 =</span> sub_scenario<span class="sc">$</span>sample_size1,</span>
<span id="cb54-1161"><a href="#cb54-1161" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n2 =</span> sub_scenario<span class="sc">$</span>sample_size2,</span>
<span id="cb54-1162"><a href="#cb54-1162" aria-hidden="true" tabindex="-1"></a>                   <span class="at">effect_type =</span> <span class="st">"SMD"</span>,</span>
<span id="cb54-1163"><a href="#cb54-1163" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-1164"><a href="#cb54-1164" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-1165"><a href="#cb54-1165" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE_boots =</span> <span class="fu">unique</span>(sub_scenario<span class="sc">$</span>boots)) </span>
<span id="cb54-1166"><a href="#cb54-1166" aria-hidden="true" tabindex="-1"></a>     out[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">data.table</span>(out[[<span class="dv">2</span>]],</span>
<span id="cb54-1167"><a href="#cb54-1167" aria-hidden="true" tabindex="-1"></a>                           sub_scenario[, .(boots, sample_size1)])</span>
<span id="cb54-1168"><a href="#cb54-1168" aria-hidden="true" tabindex="-1"></a>     out[[<span class="dv">2</span>]]   </span>
<span id="cb54-1169"><a href="#cb54-1169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-1170"><a href="#cb54-1170" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>(<span class="fu">rbindlist</span>(out))</span>
<span id="cb54-1171"><a href="#cb54-1171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-1172"><a href="#cb54-1172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-1173"><a href="#cb54-1173" aria-hidden="true" tabindex="-1"></a>  res.dt <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(res)</span>
<span id="cb54-1174"><a href="#cb54-1174" aria-hidden="true" tabindex="-1"></a>  res.dt</span>
<span id="cb54-1175"><a href="#cb54-1175" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-1176"><a href="#cb54-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(res.dt, <span class="st">"data/dummy_bootstrap_simulation.Rds"</span>)</span>
<span id="cb54-1177"><a href="#cb54-1177" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb54-1178"><a href="#cb54-1178" aria-hidden="true" tabindex="-1"></a>  res.dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/dummy_bootstrap_simulation.Rds"</span>)</span>
<span id="cb54-1179"><a href="#cb54-1179" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-1180"><a href="#cb54-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1181"><a href="#cb54-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1182"><a href="#cb54-1182" aria-hidden="true" tabindex="-1"></a>Let's look at the dispersion of the SAFE estimates as a function of sample size and bootstrap length</span>
<span id="cb54-1183"><a href="#cb54-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1186"><a href="#cb54-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1187"><a href="#cb54-1187" aria-hidden="true" tabindex="-1"></a><span class="co"># First, the point estimates:</span></span>
<span id="cb54-1188"><a href="#cb54-1188" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.dt, </span>
<span id="cb54-1189"><a href="#cb54-1189" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(sample_size1), <span class="at">y =</span> yi_safe, </span>
<span id="cb54-1190"><a href="#cb54-1190" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> boots,</span>
<span id="cb54-1191"><a href="#cb54-1191" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size1, boots)))<span class="sc">+</span></span>
<span id="cb54-1192"><a href="#cb54-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb54-1193"><a href="#cb54-1193" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">dodge.width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-1194"><a href="#cb54-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-1195"><a href="#cb54-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"SAFE Point Estimate"</span>)<span class="sc">+</span></span>
<span id="cb54-1196"><a href="#cb54-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Scenario sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1197"><a href="#cb54-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_scico</span>(<span class="st">"Number of SAFE bootstraps"</span>,</span>
<span id="cb54-1198"><a href="#cb54-1198" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1199"><a href="#cb54-1199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-1200"><a href="#cb54-1200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1201"><a href="#cb54-1201" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1202"><a href="#cb54-1202" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1203"><a href="#cb54-1203" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1204"><a href="#cb54-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1205"><a href="#cb54-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1206"><a href="#cb54-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1207"><a href="#cb54-1207" aria-hidden="true" tabindex="-1"></a>Now let's look at the variance estimates:</span>
<span id="cb54-1208"><a href="#cb54-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1211"><a href="#cb54-1211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1212"><a href="#cb54-1212" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.dt, </span>
<span id="cb54-1213"><a href="#cb54-1213" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(sample_size1), <span class="at">y =</span> vi_safe, </span>
<span id="cb54-1214"><a href="#cb54-1214" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> boots,</span>
<span id="cb54-1215"><a href="#cb54-1215" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size1, boots)))<span class="sc">+</span></span>
<span id="cb54-1216"><a href="#cb54-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb54-1217"><a href="#cb54-1217" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">dodge.width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-1218"><a href="#cb54-1218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb54-1219"><a href="#cb54-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"SAFE Variance Estimate"</span>)<span class="sc">+</span></span>
<span id="cb54-1220"><a href="#cb54-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Scenario sample size"</span>)<span class="sc">+</span></span>
<span id="cb54-1221"><a href="#cb54-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_scico</span>(<span class="st">"Number of SAFE bootstraps"</span>,</span>
<span id="cb54-1222"><a href="#cb54-1222" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1223"><a href="#cb54-1223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-1224"><a href="#cb54-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1225"><a href="#cb54-1225" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1226"><a href="#cb54-1226" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1227"><a href="#cb54-1227" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1228"><a href="#cb54-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1229"><a href="#cb54-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1230"><a href="#cb54-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1231"><a href="#cb54-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1232"><a href="#cb54-1232" aria-hidden="true" tabindex="-1"></a>Looks like the dispersion in estimates is shaped by number of SAFE bootstraps and improves considerably with 1,000 bootstraps, especially at low sample sizes. Another way to visualize this (which we'll use below in the actual 1e5 simulations) is to plot the standard deviation.</span>
<span id="cb54-1233"><a href="#cb54-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1236"><a href="#cb54-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1237"><a href="#cb54-1237" aria-hidden="true" tabindex="-1"></a>res.summary <span class="ot">&lt;-</span> res.dt[, .(<span class="at">sd_point_estimate =</span> <span class="fu">sd</span>(yi_safe),</span>
<span id="cb54-1238"><a href="#cb54-1238" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sd_variance_estimate =</span> <span class="fu">sd</span>(vi_safe)),</span>
<span id="cb54-1239"><a href="#cb54-1239" aria-hidden="true" tabindex="-1"></a>                   by <span class="ot">=</span> .(sample_size1, boots)]</span>
<span id="cb54-1240"><a href="#cb54-1240" aria-hidden="true" tabindex="-1"></a>res.summary</span>
<span id="cb54-1241"><a href="#cb54-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1242"><a href="#cb54-1242" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's melt this to make a single plot:</span></span>
<span id="cb54-1243"><a href="#cb54-1243" aria-hidden="true" tabindex="-1"></a>res.summary.mlt <span class="ot">&lt;-</span> <span class="fu">melt</span>(res.summary,</span>
<span id="cb54-1244"><a href="#cb54-1244" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"sample_size1"</span>, <span class="st">"boots"</span>))</span>
<span id="cb54-1245"><a href="#cb54-1245" aria-hidden="true" tabindex="-1"></a>res.summary.mlt</span>
<span id="cb54-1246"><a href="#cb54-1246" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(res.summary.mlt, boots)</span>
<span id="cb54-1247"><a href="#cb54-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1248"><a href="#cb54-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> res.summary.mlt,</span>
<span id="cb54-1249"><a href="#cb54-1249" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, <span class="at">color =</span> sample_size1,</span>
<span id="cb54-1250"><a href="#cb54-1250" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">interaction</span>(sample_size1)))<span class="sc">+</span></span>
<span id="cb54-1251"><a href="#cb54-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb54-1252"><a href="#cb54-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1253"><a href="#cb54-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable,</span>
<span id="cb54-1254"><a href="#cb54-1254" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"sd_point_estimate"</span> <span class="ot">=</span> <span class="st">"Point estimate"</span>,</span>
<span id="cb54-1255"><a href="#cb54-1255" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd_variance_estimate"</span> <span class="ot">=</span> <span class="st">"Variance estimate"</span>)))<span class="sc">+</span></span>
<span id="cb54-1256"><a href="#cb54-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="st">"Scenario sample size"</span>,</span>
<span id="cb54-1257"><a href="#cb54-1257" aria-hidden="true" tabindex="-1"></a>                   <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1258"><a href="#cb54-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1259"><a href="#cb54-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standard deviation of estimate"</span>)<span class="sc">+</span></span>
<span id="cb54-1260"><a href="#cb54-1260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-1261"><a href="#cb54-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1262"><a href="#cb54-1262" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1263"><a href="#cb54-1263" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1264"><a href="#cb54-1264" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1265"><a href="#cb54-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1266"><a href="#cb54-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1267"><a href="#cb54-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1268"><a href="#cb54-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bootstrap scenario results</span></span>
<span id="cb54-1269"><a href="#cb54-1269" aria-hidden="true" tabindex="-1"></a>Now let's look at the full Monte Carlo simulation results for the influence of bootstrap length.</span>
<span id="cb54-1270"><a href="#cb54-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1273"><a href="#cb54-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1274"><a href="#cb54-1274" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb54-1275"><a href="#cb54-1275" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1276"><a href="#cb54-1276" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1277"><a href="#cb54-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1278"><a href="#cb54-1278" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/all_scenarios_summarized.Rds"</span>)</span>
<span id="cb54-1279"><a href="#cb54-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1280"><a href="#cb54-1280" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> sim_results[calculation <span class="sc">==</span> <span class="st">"SD"</span>, ]</span>
<span id="cb54-1281"><a href="#cb54-1281" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_results)</span>
<span id="cb54-1282"><a href="#cb54-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1283"><a href="#cb54-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1284"><a href="#cb54-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1285"><a href="#cb54-1285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reciprocal</span></span>
<span id="cb54-1286"><a href="#cb54-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1287"><a href="#cb54-1287" aria-hidden="true" tabindex="-1"></a>1 / x</span>
<span id="cb54-1288"><a href="#cb54-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1291"><a href="#cb54-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1292"><a href="#cb54-1292" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1293"><a href="#cb54-1293" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1294"><a href="#cb54-1294" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1295"><a href="#cb54-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1296"><a href="#cb54-1296" aria-hidden="true" tabindex="-1"></a>y_lab <span class="ot">&lt;-</span> <span class="st">"Standard deviation of estimate"</span></span>
<span id="cb54-1297"><a href="#cb54-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1298"><a href="#cb54-1298" aria-hidden="true" tabindex="-1"></a>theme_SAFE <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb54-1299"><a href="#cb54-1299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1300"><a href="#cb54-1300" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-1301"><a href="#cb54-1301" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-1302"><a href="#cb54-1302" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-1303"><a href="#cb54-1303" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb54-1304"><a href="#cb54-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1305"><a href="#cb54-1305" aria-hidden="true" tabindex="-1"></a>facet_labs <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"point"</span> <span class="ot">=</span> <span class="st">"Point estimate"</span>,</span>
<span id="cb54-1306"><a href="#cb54-1306" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"variance"</span> <span class="ot">=</span> <span class="st">"Variance estimate"</span>))</span>
<span id="cb54-1307"><a href="#cb54-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1308"><a href="#cb54-1308" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"reciprocal"</span>, ]</span>
<span id="cb54-1309"><a href="#cb54-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1310"><a href="#cb54-1310" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1311"><a href="#cb54-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1312"><a href="#cb54-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1313"><a href="#cb54-1313" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1314"><a href="#cb54-1314" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size,</span>
<span id="cb54-1315"><a href="#cb54-1315" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size))<span class="sc">+</span></span>
<span id="cb54-1316"><a href="#cb54-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1317"><a href="#cb54-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1318"><a href="#cb54-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1319"><a href="#cb54-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1320"><a href="#cb54-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1321"><a href="#cb54-1321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1322"><a href="#cb54-1322" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1323"><a href="#cb54-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1324"><a href="#cb54-1324" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1325"><a href="#cb54-1325" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1326"><a href="#cb54-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Reciprocal (1 / x)"</span>)<span class="sc">+</span></span>
<span id="cb54-1327"><a href="#cb54-1327" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1328"><a href="#cb54-1328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1329"><a href="#cb54-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1330"><a href="#cb54-1330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1331"><a href="#cb54-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1332"><a href="#cb54-1332" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 4-multivariate normal</span></span>
<span id="cb54-1333"><a href="#cb54-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1334"><a href="#cb54-1334" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-1335"><a href="#cb54-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1338"><a href="#cb54-1338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1339"><a href="#cb54-1339" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1340"><a href="#cb54-1340" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1341"><a href="#cb54-1341" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1342"><a href="#cb54-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1343"><a href="#cb54-1343" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_normal"</span>, ]</span>
<span id="cb54-1344"><a href="#cb54-1344" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1345"><a href="#cb54-1345" aria-hidden="true" tabindex="-1"></a>sub_dat</span>
<span id="cb54-1346"><a href="#cb54-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1347"><a href="#cb54-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1348"><a href="#cb54-1348" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1349"><a href="#cb54-1349" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb54-1350"><a href="#cb54-1350" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb54-1351"><a href="#cb54-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1352"><a href="#cb54-1352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1353"><a href="#cb54-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1354"><a href="#cb54-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1355"><a href="#cb54-1355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1356"><a href="#cb54-1356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1357"><a href="#cb54-1357" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1358"><a href="#cb54-1358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1359"><a href="#cb54-1359" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1360"><a href="#cb54-1360" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1361"><a href="#cb54-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (4-multivariate normal SAFE distribution)"</span>)<span class="sc">+</span></span>
<span id="cb54-1362"><a href="#cb54-1362" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1363"><a href="#cb54-1363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1364"><a href="#cb54-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1365"><a href="#cb54-1365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1366"><a href="#cb54-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1367"><a href="#cb54-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 2-multivariate normal and 2-Wishart</span></span>
<span id="cb54-1368"><a href="#cb54-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1369"><a href="#cb54-1369" aria-hidden="true" tabindex="-1"></a>With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</span>
<span id="cb54-1370"><a href="#cb54-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1373"><a href="#cb54-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1374"><a href="#cb54-1374" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1375"><a href="#cb54-1375" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1376"><a href="#cb54-1376" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1377"><a href="#cb54-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1378"><a href="#cb54-1378" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_Wishart"</span>, ]</span>
<span id="cb54-1379"><a href="#cb54-1379" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1380"><a href="#cb54-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1381"><a href="#cb54-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1382"><a href="#cb54-1382" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1383"><a href="#cb54-1383" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb54-1384"><a href="#cb54-1384" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb54-1385"><a href="#cb54-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1386"><a href="#cb54-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1387"><a href="#cb54-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1388"><a href="#cb54-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1389"><a href="#cb54-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1390"><a href="#cb54-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1391"><a href="#cb54-1391" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1392"><a href="#cb54-1392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1393"><a href="#cb54-1393" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1394"><a href="#cb54-1394" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1395"><a href="#cb54-1395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (2-multivariate normal, 2-Wishart)"</span>)<span class="sc">+</span></span>
<span id="cb54-1396"><a href="#cb54-1396" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1397"><a href="#cb54-1397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1398"><a href="#cb54-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1399"><a href="#cb54-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1400"><a href="#cb54-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1401"><a href="#cb54-1401" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 4-multivariate normal</span></span>
<span id="cb54-1402"><a href="#cb54-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1403"><a href="#cb54-1403" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-1404"><a href="#cb54-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1407"><a href="#cb54-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1408"><a href="#cb54-1408" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1409"><a href="#cb54-1409" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1410"><a href="#cb54-1410" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1411"><a href="#cb54-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1412"><a href="#cb54-1412" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_normal"</span>, ]</span>
<span id="cb54-1413"><a href="#cb54-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1414"><a href="#cb54-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1415"><a href="#cb54-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1416"><a href="#cb54-1416" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1417"><a href="#cb54-1417" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb54-1418"><a href="#cb54-1418" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb54-1419"><a href="#cb54-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1420"><a href="#cb54-1420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1421"><a href="#cb54-1421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1422"><a href="#cb54-1422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1423"><a href="#cb54-1423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1424"><a href="#cb54-1424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1425"><a href="#cb54-1425" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1426"><a href="#cb54-1426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1427"><a href="#cb54-1427" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1428"><a href="#cb54-1428" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1429"><a href="#cb54-1429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR (4-multivariate normal)"</span>)<span class="sc">+</span></span>
<span id="cb54-1430"><a href="#cb54-1430" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1431"><a href="#cb54-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1432"><a href="#cb54-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1433"><a href="#cb54-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1434"><a href="#cb54-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1435"><a href="#cb54-1435" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 2-multivariate normal and 2-Wishart</span></span>
<span id="cb54-1436"><a href="#cb54-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1437"><a href="#cb54-1437" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb54-1438"><a href="#cb54-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1441"><a href="#cb54-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1442"><a href="#cb54-1442" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1443"><a href="#cb54-1443" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1444"><a href="#cb54-1444" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1445"><a href="#cb54-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1446"><a href="#cb54-1446" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_Wishart"</span>, ]</span>
<span id="cb54-1447"><a href="#cb54-1447" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1448"><a href="#cb54-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1449"><a href="#cb54-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1450"><a href="#cb54-1450" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1451"><a href="#cb54-1451" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> sample_size1,</span>
<span id="cb54-1452"><a href="#cb54-1452" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> sample_size1))<span class="sc">+</span></span>
<span id="cb54-1453"><a href="#cb54-1453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1454"><a href="#cb54-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1455"><a href="#cb54-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1456"><a href="#cb54-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1457"><a href="#cb54-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1458"><a href="#cb54-1458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1459"><a href="#cb54-1459" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1460"><a href="#cb54-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1461"><a href="#cb54-1461" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1462"><a href="#cb54-1462" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1463"><a href="#cb54-1463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (2-multivariate normal, 2-Wishart)"</span>)<span class="sc">+</span></span>
<span id="cb54-1464"><a href="#cb54-1464" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1465"><a href="#cb54-1465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1466"><a href="#cb54-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1467"><a href="#cb54-1467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1468"><a href="#cb54-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1469"><a href="#cb54-1469" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR</span></span>
<span id="cb54-1470"><a href="#cb54-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1471"><a href="#cb54-1471" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for 'a' and 'c'.</span>
<span id="cb54-1472"><a href="#cb54-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1475"><a href="#cb54-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1476"><a href="#cb54-1476" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1477"><a href="#cb54-1477" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1478"><a href="#cb54-1478" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1479"><a href="#cb54-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1480"><a href="#cb54-1480" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR"</span>, ]</span>
<span id="cb54-1481"><a href="#cb54-1481" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1482"><a href="#cb54-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1483"><a href="#cb54-1483" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1484"><a href="#cb54-1484" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1485"><a href="#cb54-1485" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n1,</span>
<span id="cb54-1486"><a href="#cb54-1486" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n1))<span class="sc">+</span></span>
<span id="cb54-1487"><a href="#cb54-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1488"><a href="#cb54-1488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1489"><a href="#cb54-1489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1490"><a href="#cb54-1490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1491"><a href="#cb54-1491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1492"><a href="#cb54-1492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1493"><a href="#cb54-1493" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1494"><a href="#cb54-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1495"><a href="#cb54-1495" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1496"><a href="#cb54-1496" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1497"><a href="#cb54-1497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>)<span class="sc">+</span></span>
<span id="cb54-1498"><a href="#cb54-1498" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1499"><a href="#cb54-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1500"><a href="#cb54-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1501"><a href="#cb54-1501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1502"><a href="#cb54-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1503"><a href="#cb54-1503" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR</span></span>
<span id="cb54-1504"><a href="#cb54-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1505"><a href="#cb54-1505" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'a' and 'c' from a binomial distribution.</span>
<span id="cb54-1506"><a href="#cb54-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1509"><a href="#cb54-1509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1510"><a href="#cb54-1510" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1511"><a href="#cb54-1511" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1512"><a href="#cb54-1512" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1513"><a href="#cb54-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1514"><a href="#cb54-1514" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR"</span>, ]</span>
<span id="cb54-1515"><a href="#cb54-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1516"><a href="#cb54-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1517"><a href="#cb54-1517" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1518"><a href="#cb54-1518" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1519"><a href="#cb54-1519" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n1,</span>
<span id="cb54-1520"><a href="#cb54-1520" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n1))<span class="sc">+</span></span>
<span id="cb54-1521"><a href="#cb54-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1522"><a href="#cb54-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1523"><a href="#cb54-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1524"><a href="#cb54-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1525"><a href="#cb54-1525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1526"><a href="#cb54-1526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1527"><a href="#cb54-1527" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1528"><a href="#cb54-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1529"><a href="#cb54-1529" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1530"><a href="#cb54-1530" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1531"><a href="#cb54-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>)<span class="sc">+</span></span>
<span id="cb54-1532"><a href="#cb54-1532" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1533"><a href="#cb54-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1534"><a href="#cb54-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1535"><a href="#cb54-1535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1536"><a href="#cb54-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1537"><a href="#cb54-1537" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hardy Weinberg Disequilibrium</span></span>
<span id="cb54-1538"><a href="#cb54-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1539"><a href="#cb54-1539" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'n_AA', 'n_Aa', and 'n_aa' from a binomial distribution.</span>
<span id="cb54-1540"><a href="#cb54-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1543"><a href="#cb54-1543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1544"><a href="#cb54-1544" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb54-1545"><a href="#cb54-1545" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb54-1546"><a href="#cb54-1546" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb54-1547"><a href="#cb54-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1548"><a href="#cb54-1548" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnHWE_A"</span>, ]</span>
<span id="cb54-1549"><a href="#cb54-1549" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, boots)</span>
<span id="cb54-1550"><a href="#cb54-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1551"><a href="#cb54-1551" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat, </span>
<span id="cb54-1552"><a href="#cb54-1552" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> boots, <span class="at">y =</span> value, </span>
<span id="cb54-1553"><a href="#cb54-1553" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> n,</span>
<span id="cb54-1554"><a href="#cb54-1554" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> n))<span class="sc">+</span></span>
<span id="cb54-1555"><a href="#cb54-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-1556"><a href="#cb54-1556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> pt_size)<span class="sc">+</span></span>
<span id="cb54-1557"><a href="#cb54-1557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(y_lab)<span class="sc">+</span></span>
<span id="cb54-1558"><a href="#cb54-1558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"SAFE bootstrap length"</span>)<span class="sc">+</span></span>
<span id="cb54-1559"><a href="#cb54-1559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>))<span class="sc">+</span></span>
<span id="cb54-1560"><a href="#cb54-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_scico</span>(<span class="at">name =</span> <span class="st">"Scenario sample size"</span>, </span>
<span id="cb54-1561"><a href="#cb54-1561" aria-hidden="true" tabindex="-1"></a>                    <span class="at">palette =</span> <span class="st">"hawaii"</span>)<span class="sc">+</span></span>
<span id="cb54-1562"><a href="#cb54-1562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimate_of, </span>
<span id="cb54-1563"><a href="#cb54-1563" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb54-1564"><a href="#cb54-1564" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb54-1565"><a href="#cb54-1565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hardy Weinburg Disequilibrium"</span>)<span class="sc">+</span></span>
<span id="cb54-1566"><a href="#cb54-1566" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb54-1567"><a href="#cb54-1567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb54-1568"><a href="#cb54-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1569"><a href="#cb54-1569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>