<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Shinichi Nakagawa">
<meta name="author" content="Ayumi Mizuno">
<meta name="author" content="Santiago Ortega">
<meta name="author" content="Daniel Noble">
<meta name="author" content="Alistair Senior">
<meta name="author" content="Erick J Lundgren">
<meta name="author" content="many others order TBD">
<meta name="dcterms.date" content="2025-09-11">
<title>SAFE simulations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="SAFE simulations tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SAFE simulations tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="SAFE simulations tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SAFE simulations tutorial_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SAFE simulations tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SAFE simulations tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SAFE simulations tutorial_files/libs/bootstrap/bootstrap-11255d631cf4d0e2063def319161670c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title"><strong>CONTENTS</strong></h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#load-encapsulated-functions" id="toc-load-encapsulated-functions" class="nav-link" data-scroll-target="#load-encapsulated-functions">Load encapsulated functions</a></li>
  <li><a href="#run-sample-simulation" id="toc-run-sample-simulation" class="nav-link" data-scroll-target="#run-sample-simulation">Run sample simulation</a></li>
  <li>
<a href="#calculate-bias" id="toc-calculate-bias" class="nav-link" data-scroll-target="#calculate-bias">Calculate bias</a>
  <ul>
<li><a href="#effect-size-point-estimate-bias" id="toc-effect-size-point-estimate-bias" class="nav-link" data-scroll-target="#effect-size-point-estimate-bias">Effect size (point estimate) bias</a></li>
  <li><a href="#sampling-variance-bias" id="toc-sampling-variance-bias" class="nav-link" data-scroll-target="#sampling-variance-bias">Sampling variance bias</a></li>
  </ul>
</li>
  <li>
<a href="#plot-all-simulations-results" id="toc-plot-all-simulations-results" class="nav-link" data-scroll-target="#plot-all-simulations-results">Plot all simulations results</a>
  <ul>
<li><a href="#reciprocal" id="toc-reciprocal" class="nav-link" data-scroll-target="#reciprocal">Reciprocal</a></li>
  <li><a href="#smd-4-multivariate-normal" id="toc-smd-4-multivariate-normal" class="nav-link" data-scroll-target="#smd-4-multivariate-normal">SMD 4-multivariate normal</a></li>
  <li><a href="#lncvr-4-multivariate-normal" id="toc-lncvr-4-multivariate-normal" class="nav-link" data-scroll-target="#lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</a></li>
  <li><a href="#lncvr-2-multivariate-normal-and-2-wishart" id="toc-lncvr-2-multivariate-normal-and-2-wishart" class="nav-link" data-scroll-target="#lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</a></li>
  <li><a href="#lnor-binomial" id="toc-lnor-binomial" class="nav-link" data-scroll-target="#lnor-binomial">lnOR Binomial</a></li>
  <li><a href="#lnor-normal" id="toc-lnor-normal" class="nav-link" data-scroll-target="#lnor-normal">lnOR Normal</a></li>
  <li><a href="#lnrr-binomial" id="toc-lnrr-binomial" class="nav-link" data-scroll-target="#lnrr-binomial">lnRR Binomial</a></li>
  <li><a href="#lnrr-normal" id="toc-lnrr-normal" class="nav-link" data-scroll-target="#lnrr-normal">lnRR Normal</a></li>
  <li><a href="#hardy-weinberg-disequilibrium" id="toc-hardy-weinberg-disequilibrium" class="nav-link" data-scroll-target="#hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">SAFE simulations</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">step by step online tutorial</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Shinichi Nakagawa </p>
             <p>Ayumi Mizuno </p>
             <p>Santiago Ortega </p>
             <p>Daniel Noble </p>
             <p>Alistair Senior </p>
             <p>Erick J Lundgren </p>
             <p>many others order TBD </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren@gmail.com).</p>
<p>The simulations take a long time to run on a personal computer. We have therefore uploaded all simulation results as .Rds files, though we show exactly how we ran the simulations.</p>
<p>To run the code interactively (instead of just reading this lovely tutorial), do the following:</p>
<ol type="1">
<li>Clone the github repo: https://github.com/ejlundgren/SAFE.git</li>
<li>Download the raw simulation from <strong>XXXXX</strong> and place one directory level above the github project repo.</li>
<li>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session.</li>
</ol></section><section id="load-libraries" class="level2"><h2 class="anchored" data-anchor-id="load-libraries">Load libraries</h2>
<p>The <code>groundhog</code> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <code>groundhog</code> if it is not already installed with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, clean the environment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now load packages:</span></span>
<span><span class="co"># install.packages("groundhog")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://groundhogr.com/">"groundhog"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/groundhog/man/groundhog.library.html">groundhog.library</a></span><span class="op">(</span>pkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"crayon"</span>, </span>
<span>                          <span class="st">"tmvtnorm"</span>, <span class="st">"here"</span>,</span>
<span>                          <span class="st">"parallel"</span>, <span class="st">"foreach"</span>, <span class="st">"doSNOW"</span>,</span>
<span>                          <span class="st">"ggplot2"</span>, <span class="st">"patchwork"</span><span class="op">)</span>,</span>
<span>                  date <span class="op">=</span> <span class="st">"2025-04-15"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="load-encapsulated-functions" class="level2"><h2 class="anchored" data-anchor-id="load-encapsulated-functions">Load encapsulated functions</h2>
<p>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let’s load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at tutorial/SAFE_function.R. This function returns a data.table (basically a <em>fast</em> data.frame) with columns for plugin effect sizes and sampling variances (denoted with <code>_first</code> or <code>_second</code> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <code>_safe</code>). Point estimates (effect sizes) are denoted with <code>yi_</code> while sampling variances are denoted with <code>vi_</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># COMMENT OUT FOR RENDERING AND DELETE PRIOR TO PUBLICATION:</span></span>
<span><span class="co"># setwd("tutorial")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"SAFE_function.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For a single effect size and sampling variance:</span></span>
<span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">14.5</span>, x2 <span class="op">=</span> <span class="fl">7.9</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fl">1.3</span>, sd2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fl">20</span>, n2 <span class="op">=</span> <span class="fl">20</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         parallelize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>lnRoM cannot accept x1 or x2 ≤ 0. Leaving it to user's discretion to check prior to execution. Negative values will be returned as NA.

Using the formulas:
     yi_first &lt;- log(x1 / x2)
     yi_second &lt;- log(x1 / x2) + 0.5 * (sd1^2/(n1 * x1^2) - sd2^2/(n2 * x2^2))
     vi_first &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2)
     vi_second &lt;- sd1^2 / (n1 * x1^2) + sd2^2 / (n2 * x2^2) + 0.5 * ( (sd1^4 / (n1^2 * x1^4)) + (sd2^4 / (n2^2 * x2^4))) 
Be sure that all variables in formula are correctly named.

SAFE: 1 / 1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second    vi_first   vi_second   yi_safe     vi_safe    SE_safe
       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;      &lt;num&gt;
1: 0.6072859 0.6058845 0.003606517 0.003611733 0.6058596 0.003637854 0.06031463</code></pre>
</div>
</div>
<p>Or with a vector of raw data:</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">14.5</span>, <span class="fl">13</span>, <span class="fl">15.8</span><span class="op">)</span>, </span>
<span>         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.9</span>, <span class="fl">21</span>, <span class="fl">18.4</span><span class="op">)</span>, </span>
<span>         sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">2</span>, <span class="fl">1.9</span><span class="op">)</span>, </span>
<span>         sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span><span class="op">)</span>,</span>
<span>         n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>, </span>
<span>         n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span>, </span>
<span>         effect_type <span class="op">=</span> <span class="st">"SMD"</span>,</span>
<span>         SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         parallelize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>SMD can use normal or Wishart distribution to model variances. If unspecified with 'SAFE_distribution' argument, defaulting to Wishart Leaving it to user's discretion to check prior to execution. Negative values will be returned as NA.

Using the formulas:
     yi_first &lt;- (x1 - x2) / sqrt( ((n1 - 1) * sd1^2 + (n2 - 1) * sd2^2) / (n1 + n2 - 2) )
     yi_second &lt;- (1 - 3 / (4 * (n1 + n2 - 2) - 1) ) * ((x1 - x2) / sqrt( ((n1 - 1) * sd1^2 + (n2 - 1) * sd2^2) / (n1 + n2 - 2) ) )
     vi_first &lt;- ((n1 + n2) / (n1 * n2)) + ((x1 - x2) / sqrt( ((n1 - 1) * sd1^2 + (n2 - 1) * sd2^2) / (n1 + n2 - 2) ))^2 / (2 * (n1 + n2 - 2))
     vi_second &lt;- (1 - 3 / (4 * (n1 + n2 - 2) - 1) )^2 * ((n1 + n2) / (n1 * n2)) + ((x1 - x2) / sqrt( ((n1 - 1) * sd1^2 + (n2 - 1) * sd2^2) / (n1 + n2 - 2) ))^2 / (2 * (n1 + n2 - 2)) 
Be sure that all variables in formula are correctly named.

SAFE: 1 / 3 
SAFE: 2 / 3 
SAFE: 3 / 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>    yi_first yi_second  vi_first vi_second   yi_safe   vi_safe   SE_safe
       &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;
1:  3.912937  3.835196 0.3014615 0.2975274  3.821303 0.3649950 0.6041481
2: -3.167230 -3.094698 0.2686568 0.2633745 -3.410340 0.2529064 0.5028980
3: -1.545312 -1.512893 0.1387221 0.1343396 -1.540896 0.1406629 0.3750506</code></pre>
</div>
</div>
<p>For a full list of options that eff_size can calculate, please see information by running:</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">eff_size</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>
Must specify an effect size type ('effect_type') and necessary variables (named in arguments to function call) to match formula equations.
 
Returning effect size names &amp; required variables for reference.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>            name               vars_required
          &lt;char&gt;                      &lt;char&gt;
 1:          SMD    x1, x2, sd1, sd2, n1, n2
 2:   SMD_paired x1, x2, sd1, sd2, r, n1, n2
 3:        lnCVR    x1, x2, sd1, sd2, n1, n2
 4: lnCVR_paired x1, x2, sd1, sd2, r, n1, n2
 5:      lnHWE_A            n_AA, n_Aa, n_aa
 6:          lnM    x1, x2, sd1, sd2, n1, n2
 7:   lnM_paired x1, x2, sd1, sd2, n1, n2, r
 8:         lnOR                  a, b, c, d
 9:         lnRR                a, c, n1, n2
10:        lnRoM    x1, x2, sd1, sd2, n1, n2
11: lnRoM_paired x1, x2, sd1, sd2, r, n1, n2
12:   reciprocal                    n, x, sd</code></pre>
</div>
</div>
</section><section id="run-sample-simulation" class="level2"><h2 class="anchored" data-anchor-id="run-sample-simulation">Run sample simulation</h2>
<p>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let’s look at the simulations for lnRoM:</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/scenarios.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset scenarios:</span></span>
<span><span class="va">guide</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span><span class="va">effect_type</span> <span class="op">==</span> <span class="st">"lnRoM"</span> <span class="op">&amp;</span> <span class="va">sample_size_ratio</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">guide</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">effect_type</span>, <span class="va">scenario_id</span>, </span>
<span>                   <span class="va">true_mean1</span>, <span class="va">true_mean2</span>, </span>
<span>                   <span class="va">true_sd1</span>, <span class="va">true_sd2</span>, </span>
<span>                   <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>   effect_type       scenario_id true_mean1 true_mean2 true_sd1 true_sd2
        &lt;char&gt;            &lt;char&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1:       lnRoM  lnRoM_scenario_3       13.4       16.1      4.6      3.9
2:       lnRoM  lnRoM_scenario_6       13.4       16.1      4.6      3.9
3:       lnRoM  lnRoM_scenario_9       13.4       16.1      4.6      3.9
4:       lnRoM lnRoM_scenario_12       13.4       16.1      4.6      3.9
5:       lnRoM lnRoM_scenario_15       13.4       16.1      4.6      3.9
   sample_size1 sample_size2
          &lt;num&gt;        &lt;num&gt;
1:            5            5
2:           10           10
3:           50           50
4:          100          100
5:          150          150</code></pre>
</div>
</div>
<p>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the ‘true’ values and based on the simulated dataset. We did this 1e5 times for each scenario.</p>
<p>In these Monte Carlo simulation, we were interested in bias, or the difference between the ‘true’ estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We’ll explain the difference between estimands, estimators, and estimates below.</p>
<p>To illustrate, we’ll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we’ll only run 100 simulations.</p>
<p>To speed things up we will do this in parallel. The function <code>prepare_cluster()</code> below can help set things up and provides a progress bar so you don’t lose your mind wondering what’s going on in there.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2025</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare cluster:</span></span>
<span><span class="va">prepare_cluster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/RevolutionAnalytics/foreach">"foreach"</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st">"doSNOW"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">nCores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span> </span>
<span>  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">makeCluster</a></span><span class="op">(</span><span class="va">nCores</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/doSNOW/man/registerDoSNOW.html">registerDoSNOW</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Progress bar</span></span>
<span>  <span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">txtProgressBar</a></span><span class="op">(</span>max <span class="op">=</span> <span class="va">n</span>, style <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">progress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">pb</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>progress <span class="op">=</span> <span class="va">progress</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">opts</span>, <span class="va">pb</span>, <span class="va">cl</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized in Section <strong>XXXX.</strong> The first part of this code (inside the <code>lapply</code>) creates simulated data based on ‘true’ means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the ‘true’ values and simulated values. Note that even with only 100 iterations, this can take a minute. Feel free to skip this step and load the actual 1e5 processed simulation in the subsequent code block.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rerun</span> <span class="op">&lt;-</span> <span class="cn">F</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">rerun</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">clust_out</span> <span class="op">&lt;-</span> <span class="fu">prepare_cluster</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>         .options.snow <span class="op">=</span> <span class="va">clust_out</span><span class="op">$</span><span class="va">options</span>,</span>
<span>         .errorhandling <span class="op">=</span> <span class="st">"pass"</span>,</span>
<span>         .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html">%dopar%</a></span> <span class="op">{</span></span>
<span>           </span>
<span>  <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span>   <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">guide</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>     </span>
<span>     <span class="co"># Simulate data for guide</span></span>
<span>     <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                   <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                m2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">rtmvnorm</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     mean <span class="op">=</span> <span class="va">means</span>,</span>
<span>                     sigma <span class="op">=</span> <span class="va">sig</span>,</span>
<span>                     lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     algorithm <span class="op">=</span> <span class="st">"gibbs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu">setDT</span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1"</span>, <span class="st">"m2"</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="co"># Filter to number of samples per treatment</span></span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m1</span>,</span>
<span>                     x2 <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, <span class="op">]</span><span class="op">$</span><span class="va">m2</span><span class="op">)</span></span>
<span>     </span>
<span>     <span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>sim_mean1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_mean2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_sd1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_sd2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>                           sim_n1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>,</span>
<span>                           sim_n2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span>
<span>   <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co">#</span></span>
<span>   <span class="va">true_point</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean1</span>, x2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_mean2</span>,</span>
<span>                          sd1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd1</span>,  sd2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">true_sd2</span>,</span>
<span>                          n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                          effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                          SAFE <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          parallelize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">true_point</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">eff_size</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean1</span>, x2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_mean2</span>,</span>
<span>                   sd1 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd1</span>,  sd2 <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">sim_sd2</span>,</span>
<span>                   n1 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size1</span>, n2 <span class="op">=</span> <span class="va">guide</span><span class="op">$</span><span class="va">sample_size2</span>, </span>
<span>                   effect_type <span class="op">=</span> <span class="st">"lnRoM"</span>,</span>
<span>                   SAFE <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   parallelize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   SAFE_boots <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span>   <span class="fu">setnames</span><span class="op">(</span><span class="va">out</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="co"># Store results:</span></span>
<span>   <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">guide</span>,</span>
<span>                         <span class="va">sim_dat</span>,</span>
<span>                         <span class="va">true_point</span>,</span>
<span>                         <span class="va">out</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html">setTxtProgressBar</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">progress</span>, <span class="va">i</span><span class="op">)</span></span>
<span>   </span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html">stopCluster</a></span><span class="op">(</span><span class="va">clust_out</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">res</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the final simulation (with 1e5 iterations) for lnRoM here:</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"../../large_data/simulation_summaries/lnRoM.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id effect_type     run_ID true_mean1 true_mean2 true_sd1
             &lt;char&gt;      &lt;char&gt;     &lt;char&gt;      &lt;num&gt;      &lt;num&gt;    &lt;num&gt;
1: lnRoM_scenario_1       lnRoM lnRoM_run1       13.4       16.1      4.6
2: lnRoM_scenario_1       lnRoM lnRoM_run1       13.4       16.1      4.6
3: lnRoM_scenario_1       lnRoM lnRoM_run1       13.4       16.1      4.6
   true_sd2 sample_size1 sample_size_ratio sample_size2 sim_mean1 sim_mean2
      &lt;num&gt;        &lt;num&gt;             &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;
1:      3.9            5               0.6            3  12.80536  15.57313
2:      3.9            5               0.6            3  14.79994  17.96824
3:      3.9            5               0.6            3  15.82959  16.74330
    sim_sd1  sim_sd2 true_y_plugin_1st true_y_plugin_2nd true_v_plugin_1st
      &lt;num&gt;    &lt;num&gt;             &lt;num&gt;             &lt;num&gt;             &lt;num&gt;
1: 4.420781 3.264287        -0.1835646        -0.1815599        0.04312815
2: 6.106194 2.594294        -0.1835646        -0.1815599        0.04312815
3: 4.041201 4.835295        -0.1835646        -0.1815599        0.04312815
   true_v_plugin_2nd sim_y_plugin_1st sim_y_plugin_2nd sim_v_plugin_1st
               &lt;num&gt;            &lt;num&gt;            &lt;num&gt;            &lt;num&gt;
1:        0.04359718      -0.19568322      -0.19108765       0.03848210
2:        0.04359718      -0.19398262      -0.18043457       0.04099359
3:        0.04359718      -0.05611709      -0.06349951       0.04083489
   sim_v_plugin_2nd     yi_safe    vi_safe   SE_safe
              &lt;num&gt;       &lt;num&gt;      &lt;num&gt;     &lt;num&gt;
1:       0.03887343 -0.19075138 0.04062773 0.2015632
2:       0.04159726 -0.17948460 0.04446871 0.2108760
3:       0.04130626 -0.06344918 0.04348882 0.2085397</code></pre>
</div>
</div>
</section><section id="calculate-bias" class="level2"><h2 class="anchored" data-anchor-id="calculate-bias">Calculate bias</h2>
<p>To interpret the simulation results, it is essential to understand the difference between <em>estimands</em>, <em>estimators</em>, and <em>estimates</em>.</p>
<p><strong>Estimands</strong> are the ‘true’ value.</p>
<p><strong>Estimators</strong> are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges’ g) to reduce bias, and the SAFE method.</p>
<p><strong>Estimates</strong> are the estimates of the estimands produced by the estimators.</p>
<section id="effect-size-point-estimate-bias" class="level3"><h3 class="anchored" data-anchor-id="effect-size-point-estimate-bias">Effect size (point estimate) bias</h3>
<p>In the case of our effect sizes, there are two estimands that we’re interested in estimating: the ‘true’ effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the ‘true’ values).</p>
<p>Here we will calculate bias in our estimates of effect sizes:</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>, <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">point.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>plugin_1st_bias <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_1st</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      plugin_2nd_bias <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span>,</span>
<span>                      safe_bias <span class="op">=</span> <span class="fu">bias</span><span class="op">(</span><span class="va">yi_safe</span>, <span class="va">true_y_plugin_1st</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id sample_size1 sample_size2 plugin_1st_bias plugin_2nd_bias
             &lt;char&gt;        &lt;num&gt;        &lt;num&gt;           &lt;num&gt;           &lt;num&gt;
1: lnRoM_scenario_1            5            3    3.989181e-04     0.002280239
2: lnRoM_scenario_2            5            4   -2.973280e-03     0.001671633
3: lnRoM_scenario_3            5            5   -5.319397e-03     0.000935872
4: lnRoM_scenario_4           10            6    1.402827e-03     0.002345248
5: lnRoM_scenario_5           10            8    8.916183e-05     0.002274825
6: lnRoM_scenario_6           10           10   -4.254343e-04     0.002538770
     safe_bias
         &lt;num&gt;
1: 0.002336165
2: 0.002193715
3: 0.001623817
4: 0.002371409
5: 0.002359481
6: 0.002648168</code></pre>
</div>
<div class="sourceCode" id="cb19" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Melt this to make it plottable:</span></span>
<span><span class="va">point.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">point.bias</span>,</span>
<span>                        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">point.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id sample_size1 sample_size2        variable         value
             &lt;char&gt;        &lt;num&gt;        &lt;num&gt;          &lt;fctr&gt;         &lt;num&gt;
1: lnRoM_scenario_1            5            3 plugin_1st_bias  3.989181e-04
2: lnRoM_scenario_2            5            4 plugin_1st_bias -2.973280e-03
3: lnRoM_scenario_3            5            5 plugin_1st_bias -5.319397e-03
4: lnRoM_scenario_4           10            6 plugin_1st_bias  1.402827e-03
5: lnRoM_scenario_5           10            8 plugin_1st_bias  8.916183e-05
6: lnRoM_scenario_6           10           10 plugin_1st_bias -4.254343e-04</code></pre>
</div>
<div class="sourceCode" id="cb21" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort by sample size </span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">point.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Bias"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_bias"</span> <span class="op">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd_bias"</span> <span class="op">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"safe_bias"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.75</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This indicates that the least biased estimator is the first order definition formula. SAFE bootstrapping and the 2nd order plugin perform similarly.</p>
</section><section id="sampling-variance-bias" class="level3"><h3 class="anchored" data-anchor-id="sampling-variance-bias">Sampling variance bias</h3>
<p>Interestingly, there is no way to know the ‘true’ estimand for sampling variance. <strong>WHICH I DON’T FULLY UNDERSTAND</strong>. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use each of these as the estimand. With 3 estimators, we’ll thus end up with 9 calculations of bias.</p>
<p>Since we’re interested in relative bias (<strong>Not entirely sure why</strong>), we’ll calculate bias as above but divide by the estimand and multiply by 100.</p>
<div class="cell">
<div class="sourceCode" id="cb22" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_1st</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_1st</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_2nd</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_y_plugin_2nd</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span><span class="op">[</span>, <span class="va">var_estimand_SAFE</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">yi_safe</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span><span class="va">relative_bias</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimates</span>,</span>
<span>                          <span class="va">estimand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">estimand</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span><span class="va">var.bias</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>SAFE_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    SAFE_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">vi_safe</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_1st_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_1st</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.1st_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_1st</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.2nd_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_2nd</span><span class="op">)</span>,</span>
<span>                    plugin_2nd_estimate.SAFE_estimand <span class="op">=</span> <span class="fu">relative_bias</span><span class="op">(</span><span class="va">sim_v_plugin_2nd</span>, <span class="va">var_estimand_SAFE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">scenario_id</span>, <span class="va">sample_size1</span>, <span class="va">sample_size2</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Now melt:</span></span>
<span><span class="va">var.bias.long</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">var.bias</span>,</span>
<span>                      id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">var.bias.long</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="font-size: 0.7em"><code>        scenario_id sample_size1 sample_size2                   variable
             &lt;char&gt;        &lt;num&gt;        &lt;num&gt;                     &lt;fctr&gt;
1: lnRoM_scenario_1            5            3 SAFE_estimate.1st_estimand
2: lnRoM_scenario_2            5            4 SAFE_estimate.1st_estimand
3: lnRoM_scenario_3            5            5 SAFE_estimate.1st_estimand
4: lnRoM_scenario_4           10            6 SAFE_estimate.1st_estimand
5: lnRoM_scenario_5           10            8 SAFE_estimate.1st_estimand
6: lnRoM_scenario_6           10           10 SAFE_estimate.1st_estimand
       value
       &lt;num&gt;
1: 15.690315
2: 11.677590
3: 11.960961
4:  4.815807
5:  3.667076
6:  3.547004</code></pre>
</div>
<div class="sourceCode" id="cb24" style="font-size: 0.8em;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span><span class="va">var.bias.long</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimator"</span>, <span class="st">"Estimand"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">tstrsplit</span><span class="op">(</span><span class="va">variable</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Sort the dataset by sample size</span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">var.bias.long</span>, <span class="va">sample_size1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">var.bias.long</span><span class="op">[</span><span class="va">sample_size1</span> <span class="op">==</span> <span class="va">sample_size2</span>, <span class="op">]</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_size1</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Estimator</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_path</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Sample size"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Relative bias (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Estimator"</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"plugin_1st_estimate"</span> <span class="op">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="op">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span>                                  <span class="st">"SAFE_estimate"</span> <span class="op">=</span> <span class="st">"SAFE bootstrapping"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">Estimand</span>,</span>
<span>             ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1st_estimand"</span> <span class="op">=</span> <span class="st">"1st order plugin estimand\n(definition formula)"</span>,</span>
<span>                                    <span class="st">"2nd_estimand"</span> <span class="op">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span>                                    <span class="st">"SAFE_estimand"</span> <span class="op">=</span> <span class="st">"SAFE estimand"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>        legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see here that SAFE is slightly more biased than the other estimators.</p>
</section></section><section id="plot-all-simulations-results" class="level2"><h2 class="anchored" data-anchor-id="plot-all-simulations-results">Plot all simulations results</h2>
<p>Now let’s look at the rest of the simulation results. The summaries are saved as an .Rds in the ‘builds’ folder in the repo.</p>
<section id="reciprocal" class="level3"><h3 class="anchored" data-anchor-id="reciprocal">Reciprocal</h3>
<p>1 / x</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="smd-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="smd-4-multivariate-normal">SMD 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>###SMD 2-multivariate normal and 2-Wishart With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-4-multivariate-normal" class="level3"><h3 class="anchored" data-anchor-id="lncvr-4-multivariate-normal">lnCVR 4-multivariate normal</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lncvr-2-multivariate-normal-and-2-wishart" class="level3"><h3 class="anchored" data-anchor-id="lncvr-2-multivariate-normal-and-2-wishart">lnCVR 2-multivariate normal and 2-Wishart</h3>
<p>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnor-binomial" class="level3"><h3 class="anchored" data-anchor-id="lnor-binomial">lnOR Binomial</h3>
<p>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for ‘a’ and ‘c’.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnor-normal" class="level3"><h3 class="anchored" data-anchor-id="lnor-normal">lnOR Normal</h3>
<p>In this effect size estimation, the SAFE calculation used a normal distribution to draw ‘p1’ and ‘p2’ from which ‘a’ and ‘c’ were calculated. <strong>Something is still off…</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr-binomial" class="level3"><h3 class="anchored" data-anchor-id="lnrr-binomial">lnRR Binomial</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘a’ and ‘c’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="lnrr-normal" class="level3"><h3 class="anchored" data-anchor-id="lnrr-normal">lnRR Normal</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘p1’ and ‘p2’ from a normal distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="hardy-weinberg-disequilibrium" class="level3"><h3 class="anchored" data-anchor-id="hardy-weinberg-disequilibrium">Hardy Weinberg Disequilibrium</h3>
<p>In this effect size estimation, the SAFE calculation drew ‘n_AA’, ‘n_Aa’, and ‘n_aa’ from a binomial distribution.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="SAFE-simulations-tutorial_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->

</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "SAFE simulations"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "step by step online tutorial"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Shinichi Nakagawa</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ayumi Mizuno</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Santiago Ortega</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Daniel Noble</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Alistair Senior</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Erick J Lundgren</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: many others order TBD</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 6</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: true</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "**CONTENTS**"</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">    output-file: "index.html"</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">    # embed-resources: true</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">    # code-fold: true</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">    # number-sections: false</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">    # bibliography: ./bib/ref.bib</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: "10"</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co">    mainfont: "Helvetica"</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co">    monofont: "Fira Code"</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co">    # fontcolor: ""</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: article</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co">    df_print: paged</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co">    code-line-numbers: false</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co">      margin-width: 120px</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="co"># crossref: </span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-title: Figure     # (default is "Figure")</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-title: Table     # (default is "Table")</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   title-delim: "—"     # (default is ":")</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   fig-prefix: Fig.     # (default is "Figure")</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   tbl-prefix: Table.   # (default is "Table")</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="co">  tidy: true</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>If you have any questions, errors or bug reports, please feel free to contact Erick Lundgren (erick.lundgren\@gmail.com).</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>The simulations take a long time to run on a personal computer. We have therefore uploaded all simulation results as .Rds files, though we show exactly how we ran the simulations.</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>To run the code interactively (instead of just reading this lovely tutorial), do the following:</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Clone the github repo: https://github.com/ejlundgren/SAFE.git</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Download the raw simulation from **XXXXX** and place one directory level above the github project repo.</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Run the code chunks in the SAFE simulations tutorial.qmd while in the R project session.</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load libraries</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>The <span class="in">`groundhog`</span> package ensures that the library versions you use are the same as ours. You will need R version 4.5.0. Be sure to install <span class="in">`groundhog`</span> if it is not already installed with <span class="in">`install.packages()`</span>.</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="co"># First, clean the environment:</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Now load packages:</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("groundhog")</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"groundhog"</span>)</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a><span class="fu">groundhog.library</span>(<span class="at">pkg =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"crayon"</span>, </span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"tmvtnorm"</span>, <span class="st">"here"</span>,</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"parallel"</span>, <span class="st">"foreach"</span>, <span class="st">"doSNOW"</span>,</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ggplot2"</span>, <span class="st">"patchwork"</span>),</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date =</span> <span class="st">"2025-04-15"</span>)</span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load encapsulated functions</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>We wrote a function to calculate effect sizes both with plugin estimators and with SAFE. This function can be sourced into the local environment. Let's load the function and then calculate effect sizes, with SAFE, for several examples from the main text. The function is located in the github repo at tutorial/SAFE_function.R. This function returns a data.table (basically a *fast* data.frame) with columns for plugin effect sizes and sampling variances (denoted with <span class="in">`_first`</span> or <span class="in">`_second`</span> based on derivative order) and SAFE effect sizes and sampling variances (denoted with <span class="in">`_safe`</span>). Point estimates (effect sizes) are denoted with <span class="in">`yi_`</span> while sampling variances are denoted with <span class="in">`vi_`</span>.</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a><span class="co"># COMMENT OUT FOR RENDERING AND DELETE PRIOR TO PUBLICATION:</span></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a><span class="co"># setwd("tutorial")</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"SAFE_function.R"</span>)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a><span class="co"># For a single effect size and sampling variance:</span></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fl">14.5</span>, <span class="at">x2 =</span> <span class="fl">7.9</span>, </span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fl">1.3</span>, <span class="at">sd2 =</span> <span class="dv">2</span>,</span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="dv">20</span>, <span class="at">n2 =</span> <span class="dv">20</span>, </span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>         <span class="at">parallelize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>Or with a vector of raw data:</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="fl">14.5</span>, <span class="dv">13</span>, <span class="fl">15.8</span>), </span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fl">7.9</span>, <span class="dv">21</span>, <span class="fl">18.4</span>), </span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd1 =</span> <span class="fu">c</span>(<span class="fl">1.3</span>, <span class="dv">2</span>, <span class="fl">1.9</span>), </span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd2 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">3.1</span>, <span class="fl">1.4</span>),</span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>         <span class="at">n1 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>), </span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>         <span class="at">n2 =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">18</span>), </span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a>         <span class="at">effect_type =</span> <span class="st">"SMD"</span>,</span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>         <span class="at">parallelize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a>For a full list of options that eff_size can calculate, please see information by running:</span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a><span class="fu">eff_size</span>()</span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## Run sample simulation</span></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>We simulated the bias of SAFE calculations versus normal plugin calculations for a variety of common, and less common, effect sizes. We did this across a range of input variables, particularly sample size. The creation of these scenarios differed for each effect size (based on input variables). The scenarios can be loaded as follows. Let's look at the simulations for lnRoM:</span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/scenarios.Rds"</span>)</span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset scenarios:</span></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a>guide <span class="ot">&lt;-</span> scenarios[effect_type <span class="sc">==</span> <span class="st">"lnRoM"</span> <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a>guide[, .(effect_type, scenario_id, </span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a>                   true_mean1, true_mean2, </span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>                   true_sd1, true_sd2, </span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>                   sample_size1, sample_size2)]</span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>To evaluate effect size performance, we conducted Monte Carlo simulations for each scenario. In these simulations, we created simulated datasets based on true values for each scenario. We then calculated effect sizes and sampling variances (both with plugin formulas and SAFE) for the 'true' values and based on the simulated dataset. We did this 1e5 times for each scenario.</span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>In these Monte Carlo simulation, we were interested in bias, or the difference between the 'true' estimands (i.e., sampling variance and effect sizes) and the estimates (of sampling variance and effect sizes) produced from various methods and applied to the simulated data. We'll explain the difference between estimands, estimators, and estimates below.</span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a>To illustrate, we'll do a dummy simulation for lnRoM. Note that the means/sd for each scenario are the same. The only variables that differ are sample sizes. To make this tractable, we'll only run 100 simulations.</span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a>To speed things up we will do this in parallel. The function <span class="in">`prepare_cluster()`</span> below can help set things up and provides a progress bar so you don't lose your mind wondering what's going on in there.</span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare cluster:</span></span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>prepare_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(<span class="st">"parallel"</span>)</span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(<span class="st">"foreach"</span>)</span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(<span class="st">"doSNOW"</span>)</span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>  nCores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(nCores)</span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Progress bar</span></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> <span class="fu">txtProgressBar</span>(<span class="at">max =</span> n, <span class="at">style =</span> <span class="dv">3</span>)</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>  progress <span class="ot">&lt;-</span> <span class="cf">function</span>(n) <span class="fu">setTxtProgressBar</span>(pb, n)</span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>  opts <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">progress =</span> progress)</span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <span class="fu">list</span>(opts, pb, cl)</span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ret) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"options"</span>, <span class="st">"progress"</span>, <span class="st">"cluster"</span>)</span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Pass 'x$options' to .opts in foreach;</span></span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$progress' to setTxtProgressBar(x$progress, i);</span></span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a><span class="st">      'x$cluster' to stopCluster(x$cluster) after foreach"</span>)</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a>Now we will run 100 simulations to showcase how this method works. The actual simulations had a length of 1e5 and are loaded and visualized in Section **XXXX.** The first part of this code (inside the <span class="in">`lapply`</span>) creates simulated data based on 'true' means and standard deviations. This data is then summarized to a simulation mean and standard deviation. We will then calculate effect sizes and sampling variances for the 'true' values and simulated values. Note that even with only 100 iterations, this can take a minute. Feel free to skip this step and load the actual 1e5 processed simulation in the subsequent code block.</span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a>rerun <span class="ot">&lt;-</span> F</span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(rerun){</span>
<span id="cb25-226"><a href="#cb25-226" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-227"><a href="#cb25-227" aria-hidden="true" tabindex="-1"></a>  clust_out <span class="ot">&lt;-</span> <span class="fu">prepare_cluster</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, </span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a>         <span class="at">.options.snow =</span> clust_out<span class="sc">$</span>options,</span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>         <span class="at">.errorhandling =</span> <span class="st">"pass"</span>,</span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>         <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">"data.table"</span>, <span class="st">"MASS"</span>, <span class="st">"tmvtnorm"</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate data for each scenario in an lapply: </span></span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a>   sim_dat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(guide), <span class="cf">function</span>(x){</span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Simulate data for guide</span></span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>     sig <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">c</span>(guide<span class="sc">$</span>true_sd1[x]<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a>                   guide<span class="sc">$</span>true_sd2[x]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>     means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">m1 =</span> guide<span class="sc">$</span>true_mean1[x],</span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>                <span class="at">m2 =</span> guide<span class="sc">$</span>true_mean2[x])</span>
<span id="cb25-243"><a href="#cb25-243" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb25-244"><a href="#cb25-244" aria-hidden="true" tabindex="-1"></a>     y <span class="ot">&lt;-</span> <span class="fu">rtmvnorm</span>(<span class="at">n =</span> <span class="fu">max</span>(<span class="fu">c</span>(guide<span class="sc">$</span>sample_size1[x], guide<span class="sc">$</span>sample_size2[x])),</span>
<span id="cb25-245"><a href="#cb25-245" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> means,</span>
<span id="cb25-246"><a href="#cb25-246" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma =</span> sig,</span>
<span id="cb25-247"><a href="#cb25-247" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lower =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(means)),</span>
<span id="cb25-248"><a href="#cb25-248" aria-hidden="true" tabindex="-1"></a>                     <span class="at">upper =</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, <span class="fu">length</span>(means)),</span>
<span id="cb25-249"><a href="#cb25-249" aria-hidden="true" tabindex="-1"></a>                     <span class="at">algorithm =</span> <span class="st">"gibbs"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-250"><a href="#cb25-250" aria-hidden="true" tabindex="-1"></a>       <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-251"><a href="#cb25-251" aria-hidden="true" tabindex="-1"></a>       <span class="fu">setDT</span>()</span>
<span id="cb25-252"><a href="#cb25-252" aria-hidden="true" tabindex="-1"></a>     <span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"m1"</span>, <span class="st">"m2"</span>)</span>
<span id="cb25-253"><a href="#cb25-253" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb25-254"><a href="#cb25-254" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Filter to number of samples per treatment</span></span>
<span id="cb25-255"><a href="#cb25-255" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x1 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size1[x], ]<span class="sc">$</span>m1,</span>
<span id="cb25-256"><a href="#cb25-256" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x2 =</span> y[<span class="dv">1</span><span class="sc">:</span>guide<span class="sc">$</span>sample_size2[x], ]<span class="sc">$</span>m2)</span>
<span id="cb25-257"><a href="#cb25-257" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb25-258"><a href="#cb25-258" aria-hidden="true" tabindex="-1"></a>     sim_dat <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">sim_mean1 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb25-259"><a href="#cb25-259" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_mean2 =</span> <span class="fu">mean</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb25-260"><a href="#cb25-260" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd1 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb25-261"><a href="#cb25-261" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_sd2 =</span> <span class="fu">sd</span>(sim_dat<span class="sc">$</span>x2),</span>
<span id="cb25-262"><a href="#cb25-262" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_n1 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x1),</span>
<span id="cb25-263"><a href="#cb25-263" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sim_n2 =</span> <span class="fu">length</span>(sim_dat<span class="sc">$</span>x2))</span>
<span id="cb25-264"><a href="#cb25-264" aria-hidden="true" tabindex="-1"></a>     <span class="fu">return</span>(sim_dat)</span>
<span id="cb25-265"><a href="#cb25-265" aria-hidden="true" tabindex="-1"></a>   }) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>()</span>
<span id="cb25-266"><a href="#cb25-266" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-267"><a href="#cb25-267" aria-hidden="true" tabindex="-1"></a>   <span class="co">#</span></span>
<span id="cb25-268"><a href="#cb25-268" aria-hidden="true" tabindex="-1"></a>   true_point <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> guide<span class="sc">$</span>true_mean1, <span class="at">x2 =</span> guide<span class="sc">$</span>true_mean2,</span>
<span id="cb25-269"><a href="#cb25-269" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sd1 =</span> guide<span class="sc">$</span>true_sd1,  <span class="at">sd2 =</span> guide<span class="sc">$</span>true_sd2,</span>
<span id="cb25-270"><a href="#cb25-270" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb25-271"><a href="#cb25-271" aria-hidden="true" tabindex="-1"></a>                          <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb25-272"><a href="#cb25-272" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-273"><a href="#cb25-273" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-274"><a href="#cb25-274" aria-hidden="true" tabindex="-1"></a>                          <span class="at">parallelize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-275"><a href="#cb25-275" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb25-276"><a href="#cb25-276" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(true_point,</span>
<span id="cb25-277"><a href="#cb25-277" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb25-278"><a href="#cb25-278" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb25-279"><a href="#cb25-279" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"true_y_plugin_1st"</span>, <span class="st">"true_v_plugin_1st"</span>,</span>
<span id="cb25-280"><a href="#cb25-280" aria-hidden="true" tabindex="-1"></a>              <span class="st">"true_y_plugin_2nd"</span>, <span class="st">"true_v_plugin_2nd"</span>))</span>
<span id="cb25-281"><a href="#cb25-281" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-282"><a href="#cb25-282" aria-hidden="true" tabindex="-1"></a>   out <span class="ot">&lt;-</span> <span class="fu">eff_size</span>(<span class="at">x1 =</span> sim_dat<span class="sc">$</span>sim_mean1, <span class="at">x2 =</span> sim_dat<span class="sc">$</span>sim_mean2,</span>
<span id="cb25-283"><a href="#cb25-283" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd1 =</span> sim_dat<span class="sc">$</span>sim_sd1,  <span class="at">sd2 =</span> sim_dat<span class="sc">$</span>sim_sd2,</span>
<span id="cb25-284"><a href="#cb25-284" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n1 =</span> guide<span class="sc">$</span>sample_size1, <span class="at">n2 =</span> guide<span class="sc">$</span>sample_size2, </span>
<span id="cb25-285"><a href="#cb25-285" aria-hidden="true" tabindex="-1"></a>                   <span class="at">effect_type =</span> <span class="st">"lnRoM"</span>,</span>
<span id="cb25-286"><a href="#cb25-286" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-287"><a href="#cb25-287" aria-hidden="true" tabindex="-1"></a>                   <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-288"><a href="#cb25-288" aria-hidden="true" tabindex="-1"></a>                   <span class="at">parallelize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-289"><a href="#cb25-289" aria-hidden="true" tabindex="-1"></a>                   <span class="at">SAFE_boots =</span> <span class="fl">1e6</span>)</span>
<span id="cb25-290"><a href="#cb25-290" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setnames</span>(out,</span>
<span id="cb25-291"><a href="#cb25-291" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"yi_first"</span>, <span class="st">"vi_first"</span>, </span>
<span id="cb25-292"><a href="#cb25-292" aria-hidden="true" tabindex="-1"></a>              <span class="st">"yi_second"</span>, <span class="st">"vi_second"</span>),</span>
<span id="cb25-293"><a href="#cb25-293" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"sim_y_plugin_1st"</span>, <span class="st">"sim_v_plugin_1st"</span>,</span>
<span id="cb25-294"><a href="#cb25-294" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sim_y_plugin_2nd"</span>, <span class="st">"sim_v_plugin_2nd"</span>))</span>
<span id="cb25-295"><a href="#cb25-295" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-296"><a href="#cb25-296" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Store results:</span></span>
<span id="cb25-297"><a href="#cb25-297" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> <span class="fu">data.table</span>(guide,</span>
<span id="cb25-298"><a href="#cb25-298" aria-hidden="true" tabindex="-1"></a>                         sim_dat,</span>
<span id="cb25-299"><a href="#cb25-299" aria-hidden="true" tabindex="-1"></a>                         true_point,</span>
<span id="cb25-300"><a href="#cb25-300" aria-hidden="true" tabindex="-1"></a>                         out)</span>
<span id="cb25-301"><a href="#cb25-301" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-302"><a href="#cb25-302" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setTxtProgressBar</span>(clust_out<span class="sc">$</span>progress, i)</span>
<span id="cb25-303"><a href="#cb25-303" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-304"><a href="#cb25-304" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(results)</span>
<span id="cb25-305"><a href="#cb25-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-306"><a href="#cb25-306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-307"><a href="#cb25-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopCluster</span>(clust_out<span class="sc">$</span>cluster)</span>
<span id="cb25-308"><a href="#cb25-308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-309"><a href="#cb25-309" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(res)  </span>
<span id="cb25-310"><a href="#cb25-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-311"><a href="#cb25-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-312"><a href="#cb25-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-313"><a href="#cb25-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-314"><a href="#cb25-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-315"><a href="#cb25-315" aria-hidden="true" tabindex="-1"></a>Load the final simulation (with 1e5 iterations) for lnRoM here:</span>
<span id="cb25-316"><a href="#cb25-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-319"><a href="#cb25-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-320"><a href="#cb25-320" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-321"><a href="#cb25-321" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-322"><a href="#cb25-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-323"><a href="#cb25-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-324"><a href="#cb25-324" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../../large_data/simulation_summaries/lnRoM.Rds"</span>)</span>
<span id="cb25-325"><a href="#cb25-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-326"><a href="#cb25-326" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res, <span class="dv">3</span>)</span>
<span id="cb25-327"><a href="#cb25-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-328"><a href="#cb25-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-329"><a href="#cb25-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-330"><a href="#cb25-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate bias</span></span>
<span id="cb25-331"><a href="#cb25-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-332"><a href="#cb25-332" aria-hidden="true" tabindex="-1"></a>To interpret the simulation results, it is essential to understand the difference between *estimands*, *estimators*, and *estimates*.</span>
<span id="cb25-333"><a href="#cb25-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-334"><a href="#cb25-334" aria-hidden="true" tabindex="-1"></a>**Estimands** are the 'true' value.</span>
<span id="cb25-335"><a href="#cb25-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-336"><a href="#cb25-336" aria-hidden="true" tabindex="-1"></a>**Estimators** are the methods used to estimate the estimand. What a tongue twister! In our case, the estimators are the 1st order effect size (e.g., definition formula), the 2nd order effect size that has been adjusted (usually using the delta method, except for Hedges' g) to reduce bias, and the SAFE method.</span>
<span id="cb25-337"><a href="#cb25-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-338"><a href="#cb25-338" aria-hidden="true" tabindex="-1"></a>**Estimates** are the estimates of the estimands produced by the estimators. </span>
<span id="cb25-339"><a href="#cb25-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-340"><a href="#cb25-340" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect size (point estimate) bias</span></span>
<span id="cb25-341"><a href="#cb25-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-342"><a href="#cb25-342" aria-hidden="true" tabindex="-1"></a>In the case of our effect sizes, there are two estimands that we're interested in estimating: the 'true' effect size (based on the definition formula of the effect size type) and sampling variance. To calculate the bias of our various estimators in estimating effect sizes, we calculate the mean of the estimates from each simulated dataset and subtract the estimand value (the true effect size off the 'true' values).</span>
<span id="cb25-343"><a href="#cb25-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-344"><a href="#cb25-344" aria-hidden="true" tabindex="-1"></a>Here we will calculate bias in our estimates of effect sizes:</span>
<span id="cb25-345"><a href="#cb25-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-348"><a href="#cb25-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-349"><a href="#cb25-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-350"><a href="#cb25-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-351"><a href="#cb25-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-352"><a href="#cb25-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-353"><a href="#cb25-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-354"><a href="#cb25-354" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates, estimand){</span>
<span id="cb25-355"><a href="#cb25-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand))</span>
<span id="cb25-356"><a href="#cb25-356" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-357"><a href="#cb25-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-358"><a href="#cb25-358" aria-hidden="true" tabindex="-1"></a>point.bias <span class="ot">&lt;-</span> res[, .(<span class="at">plugin_1st_bias =</span> <span class="fu">bias</span>(sim_y_plugin_1st, true_y_plugin_1st),</span>
<span id="cb25-359"><a href="#cb25-359" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plugin_2nd_bias =</span> <span class="fu">bias</span>(sim_y_plugin_2nd, true_y_plugin_1st),</span>
<span id="cb25-360"><a href="#cb25-360" aria-hidden="true" tabindex="-1"></a>                      <span class="at">safe_bias =</span> <span class="fu">bias</span>(yi_safe, true_y_plugin_1st)),</span>
<span id="cb25-361"><a href="#cb25-361" aria-hidden="true" tabindex="-1"></a>                  by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb25-362"><a href="#cb25-362" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias)</span>
<span id="cb25-363"><a href="#cb25-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-364"><a href="#cb25-364" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt this to make it plottable:</span></span>
<span id="cb25-365"><a href="#cb25-365" aria-hidden="true" tabindex="-1"></a>point.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(point.bias,</span>
<span id="cb25-366"><a href="#cb25-366" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>))</span>
<span id="cb25-367"><a href="#cb25-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-368"><a href="#cb25-368" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(point.bias.long)</span>
<span id="cb25-369"><a href="#cb25-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-370"><a href="#cb25-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by sample size </span></span>
<span id="cb25-371"><a href="#cb25-371" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(point.bias.long, sample_size1)</span>
<span id="cb25-372"><a href="#cb25-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-373"><a href="#cb25-373" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> point.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ],</span>
<span id="cb25-374"><a href="#cb25-374" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> variable))<span class="sc">+</span></span>
<span id="cb25-375"><a href="#cb25-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-376"><a href="#cb25-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-377"><a href="#cb25-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-378"><a href="#cb25-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Bias"</span>)<span class="sc">+</span></span>
<span id="cb25-379"><a href="#cb25-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.01</span>))<span class="sc">+</span></span>
<span id="cb25-380"><a href="#cb25-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb25-381"><a href="#cb25-381" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_bias"</span> <span class="ot">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span id="cb25-382"><a href="#cb25-382" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd_bias"</span> <span class="ot">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span id="cb25-383"><a href="#cb25-383" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"safe_bias"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>))<span class="sc">+</span></span>
<span id="cb25-384"><a href="#cb25-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb25-385"><a href="#cb25-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-386"><a href="#cb25-386" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-387"><a href="#cb25-387" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb25-388"><a href="#cb25-388" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position.inside =</span> <span class="fu">c</span>(.<span class="dv">75</span>, .<span class="dv">25</span>))</span>
<span id="cb25-389"><a href="#cb25-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-390"><a href="#cb25-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-391"><a href="#cb25-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-392"><a href="#cb25-392" aria-hidden="true" tabindex="-1"></a>This indicates that the least biased estimator is the first order definition formula. SAFE bootstrapping and the 2nd order plugin perform similarly.</span>
<span id="cb25-393"><a href="#cb25-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-394"><a href="#cb25-394" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling variance bias</span></span>
<span id="cb25-395"><a href="#cb25-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-396"><a href="#cb25-396" aria-hidden="true" tabindex="-1"></a>Interestingly, there is no way to know the 'true' estimand for sampling variance. **WHICH I DON'T FULLY UNDERSTAND**. To calculate bias for our sampling variance estimates, we actually calculate the variance in point estimates for each estimator and use each of these as the estimand. With 3 estimators, we'll thus end up with 9 calculations of bias.</span>
<span id="cb25-397"><a href="#cb25-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-398"><a href="#cb25-398" aria-hidden="true" tabindex="-1"></a>Since we're interested in relative bias (**Not entirely sure why**), we'll calculate bias as above but divide by the estimand and multiply by 100.</span>
<span id="cb25-399"><a href="#cb25-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-402"><a href="#cb25-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-403"><a href="#cb25-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb25-404"><a href="#cb25-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-405"><a href="#cb25-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-406"><a href="#cb25-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-407"><a href="#cb25-407" aria-hidden="true" tabindex="-1"></a><span class="co"># First, calculate variance in point estimates as our 'estimand'</span></span>
<span id="cb25-408"><a href="#cb25-408" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_1st <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_1st), </span>
<span id="cb25-409"><a href="#cb25-409" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb25-410"><a href="#cb25-410" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_2nd <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(sim_y_plugin_2nd), </span>
<span id="cb25-411"><a href="#cb25-411" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb25-412"><a href="#cb25-412" aria-hidden="true" tabindex="-1"></a>res[, var_estimand_SAFE <span class="sc">:</span><span class="er">=</span> <span class="fu">var</span>(yi_safe), </span>
<span id="cb25-413"><a href="#cb25-413" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id)]</span>
<span id="cb25-414"><a href="#cb25-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-415"><a href="#cb25-415" aria-hidden="true" tabindex="-1"></a><span class="co"># To make this easier to read, we'll encapsulate the relative bias in a function:</span></span>
<span id="cb25-416"><a href="#cb25-416" aria-hidden="true" tabindex="-1"></a>relative_bias <span class="ot">&lt;-</span> <span class="cf">function</span>(estimates,</span>
<span id="cb25-417"><a href="#cb25-417" aria-hidden="true" tabindex="-1"></a>                          estimand){</span>
<span id="cb25-418"><a href="#cb25-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(((<span class="fu">mean</span>(estimates) <span class="sc">-</span> <span class="fu">unique</span>(estimand)) <span class="sc">/</span> estimand) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb25-419"><a href="#cb25-419" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-420"><a href="#cb25-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-421"><a href="#cb25-421" aria-hidden="true" tabindex="-1"></a><span class="co"># Now summarize and calculate relative bias per scenario ID</span></span>
<span id="cb25-422"><a href="#cb25-422" aria-hidden="true" tabindex="-1"></a>var.bias <span class="ot">&lt;-</span> res[, .(<span class="at">SAFE_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_1st),</span>
<span id="cb25-423"><a href="#cb25-423" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_2nd),</span>
<span id="cb25-424"><a href="#cb25-424" aria-hidden="true" tabindex="-1"></a>                    <span class="at">SAFE_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(vi_safe, var_estimand_SAFE),</span>
<span id="cb25-425"><a href="#cb25-425" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_1st),</span>
<span id="cb25-426"><a href="#cb25-426" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_2nd),</span>
<span id="cb25-427"><a href="#cb25-427" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_1st_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_1st, var_estimand_SAFE),</span>
<span id="cb25-428"><a href="#cb25-428" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.1st_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_1st),</span>
<span id="cb25-429"><a href="#cb25-429" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.2nd_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_2nd),</span>
<span id="cb25-430"><a href="#cb25-430" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plugin_2nd_estimate.SAFE_estimand =</span> <span class="fu">relative_bias</span>(sim_v_plugin_2nd, var_estimand_SAFE)),</span>
<span id="cb25-431"><a href="#cb25-431" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(scenario_id, sample_size1, sample_size2)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb25-432"><a href="#cb25-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-433"><a href="#cb25-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-434"><a href="#cb25-434" aria-hidden="true" tabindex="-1"></a><span class="co"># Now melt:</span></span>
<span id="cb25-435"><a href="#cb25-435" aria-hidden="true" tabindex="-1"></a>var.bias.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(var.bias,</span>
<span id="cb25-436"><a href="#cb25-436" aria-hidden="true" tabindex="-1"></a>                      <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"sample_size1"</span>, <span class="st">"sample_size2"</span>))</span>
<span id="cb25-437"><a href="#cb25-437" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(var.bias.long)</span>
<span id="cb25-438"><a href="#cb25-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-439"><a href="#cb25-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the 'variable' into estimator and estimand for plotting</span></span>
<span id="cb25-440"><a href="#cb25-440" aria-hidden="true" tabindex="-1"></a>var.bias.long[, <span class="fu">c</span>(<span class="st">"Estimator"</span>, <span class="st">"Estimand"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(variable, <span class="st">"."</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb25-441"><a href="#cb25-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-442"><a href="#cb25-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataset by sample size</span></span>
<span id="cb25-443"><a href="#cb25-443" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(var.bias.long, sample_size1)</span>
<span id="cb25-444"><a href="#cb25-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-445"><a href="#cb25-445" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb25-446"><a href="#cb25-446" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> var.bias.long[sample_size1 <span class="sc">==</span> sample_size2, ], </span>
<span id="cb25-447"><a href="#cb25-447" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> Estimator))<span class="sc">+</span></span>
<span id="cb25-448"><a href="#cb25-448" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-449"><a href="#cb25-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-450"><a href="#cb25-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-451"><a href="#cb25-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Relative bias (%)"</span>)<span class="sc">+</span></span>
<span id="cb25-452"><a href="#cb25-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimator"</span>,</span>
<span id="cb25-453"><a href="#cb25-453" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"plugin_1st_estimate"</span> <span class="ot">=</span> <span class="st">"1st order plugin (definition formula)"</span>,</span>
<span id="cb25-454"><a href="#cb25-454" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"plugin_2nd_estimate"</span> <span class="ot">=</span> <span class="st">"2nd order plugin (bias-corrected formula)"</span>,</span>
<span id="cb25-455"><a href="#cb25-455" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"SAFE_estimate"</span> <span class="ot">=</span> <span class="st">"SAFE bootstrapping"</span>))<span class="sc">+</span></span>
<span id="cb25-456"><a href="#cb25-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Estimand,</span>
<span id="cb25-457"><a href="#cb25-457" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-458"><a href="#cb25-458" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"1st_estimand"</span> <span class="ot">=</span> <span class="st">"1st order plugin estimand</span><span class="sc">\n</span><span class="st">(definition formula)"</span>,</span>
<span id="cb25-459"><a href="#cb25-459" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"2nd_estimand"</span> <span class="ot">=</span> <span class="st">"2nd order plugin estimand"</span>,</span>
<span id="cb25-460"><a href="#cb25-460" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"SAFE_estimand"</span> <span class="ot">=</span> <span class="st">"SAFE estimand"</span>)))<span class="sc">+</span></span>
<span id="cb25-461"><a href="#cb25-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb25-462"><a href="#cb25-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-463"><a href="#cb25-463" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-464"><a href="#cb25-464" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-465"><a href="#cb25-465" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"inside"</span>,</span>
<span id="cb25-466"><a href="#cb25-466" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position.inside =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>))</span>
<span id="cb25-467"><a href="#cb25-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-468"><a href="#cb25-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-469"><a href="#cb25-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-470"><a href="#cb25-470" aria-hidden="true" tabindex="-1"></a>We see here that SAFE is slightly more biased than the other estimators.</span>
<span id="cb25-471"><a href="#cb25-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-472"><a href="#cb25-472" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot all simulations results</span></span>
<span id="cb25-473"><a href="#cb25-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-474"><a href="#cb25-474" aria-hidden="true" tabindex="-1"></a>Now let's look at the rest of the simulation results. The summaries are saved as an .Rds in the 'builds' folder in the repo.</span>
<span id="cb25-475"><a href="#cb25-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-478"><a href="#cb25-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-479"><a href="#cb25-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-480"><a href="#cb25-480" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-481"><a href="#cb25-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-482"><a href="#cb25-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-483"><a href="#cb25-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-484"><a href="#cb25-484" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"builds/all_scenarios_summarized.Rds"</span>)</span>
<span id="cb25-485"><a href="#cb25-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-486"><a href="#cb25-486" aria-hidden="true" tabindex="-1"></a>var_lab <span class="ot">&lt;-</span> <span class="st">"Relative bias of</span><span class="sc">\n</span><span class="st">variance estimates (%)"</span></span>
<span id="cb25-487"><a href="#cb25-487" aria-hidden="true" tabindex="-1"></a>point_lab <span class="ot">&lt;-</span> <span class="st">"Bias of point</span><span class="sc">\n</span><span class="st">estimates"</span></span>
<span id="cb25-488"><a href="#cb25-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-489"><a href="#cb25-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-490"><a href="#cb25-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-491"><a href="#cb25-491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reciprocal</span></span>
<span id="cb25-492"><a href="#cb25-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-493"><a href="#cb25-493" aria-hidden="true" tabindex="-1"></a>1 / x</span>
<span id="cb25-494"><a href="#cb25-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-497"><a href="#cb25-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-498"><a href="#cb25-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-499"><a href="#cb25-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-500"><a href="#cb25-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-501"><a href="#cb25-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-502"><a href="#cb25-502" aria-hidden="true" tabindex="-1"></a>theme_SAFE <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb25-503"><a href="#cb25-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-504"><a href="#cb25-504" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-505"><a href="#cb25-505" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-506"><a href="#cb25-506" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-507"><a href="#cb25-507" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb25-508"><a href="#cb25-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-509"><a href="#cb25-509" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"#A8DADC"</span>,</span>
<span id="cb25-510"><a href="#cb25-510" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"#1D3557"</span>,</span>
<span id="cb25-511"><a href="#cb25-511" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>)</span>
<span id="cb25-512"><a href="#cb25-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-513"><a href="#cb25-513" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"plugin_1st"</span> <span class="ot">=</span> <span class="st">"1st order plugin"</span>,</span>
<span id="cb25-514"><a href="#cb25-514" aria-hidden="true" tabindex="-1"></a>           <span class="st">"plugin_2nd"</span> <span class="ot">=</span> <span class="st">"2nd order plugin"</span>,</span>
<span id="cb25-515"><a href="#cb25-515" aria-hidden="true" tabindex="-1"></a>           <span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"SAFE"</span>)</span>
<span id="cb25-516"><a href="#cb25-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-517"><a href="#cb25-517" aria-hidden="true" tabindex="-1"></a>facet_labs <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo 1st order plugin estimand"</span>,</span>
<span id="cb25-518"><a href="#cb25-518" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"plugin_2nd_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo 2nd order plugin estimand"</span>,</span>
<span id="cb25-519"><a href="#cb25-519" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"safe_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo SAFE variance estimand"</span>,</span>
<span id="cb25-520"><a href="#cb25-520" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"true_1st"</span> <span class="ot">=</span> <span class="st">"True 1st order point estimand"</span>,</span>
<span id="cb25-521"><a href="#cb25-521" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"true_2nd"</span> <span class="ot">=</span> <span class="st">"True 2nd order point estimand"</span>))</span>
<span id="cb25-522"><a href="#cb25-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-523"><a href="#cb25-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-524"><a href="#cb25-524" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"reciprocal"</span>, ]</span>
<span id="cb25-525"><a href="#cb25-525" aria-hidden="true" tabindex="-1"></a><span class="co"># sub_dat</span></span>
<span id="cb25-526"><a href="#cb25-526" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size)</span>
<span id="cb25-527"><a href="#cb25-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-528"><a href="#cb25-528" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>), ], </span>
<span id="cb25-529"><a href="#cb25-529" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-530"><a href="#cb25-530" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-531"><a href="#cb25-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-532"><a href="#cb25-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-533"><a href="#cb25-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-534"><a href="#cb25-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-535"><a href="#cb25-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-536"><a href="#cb25-536" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-537"><a href="#cb25-537" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-538"><a href="#cb25-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-539"><a href="#cb25-539" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-540"><a href="#cb25-540" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-541"><a href="#cb25-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Reciprocal (1 / x)"</span>)<span class="sc">+</span></span>
<span id="cb25-542"><a href="#cb25-542" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-543"><a href="#cb25-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co">#, legend.position.inside = c(.85, .85)</span></span>
<span id="cb25-544"><a href="#cb25-544" aria-hidden="true" tabindex="-1"></a><span class="co"># p.point</span></span>
<span id="cb25-545"><a href="#cb25-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-546"><a href="#cb25-546" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>), ], </span>
<span id="cb25-547"><a href="#cb25-547" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> sample_size, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-548"><a href="#cb25-548" aria-hidden="true" tabindex="-1"></a>                 <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-549"><a href="#cb25-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-550"><a href="#cb25-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-551"><a href="#cb25-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-552"><a href="#cb25-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-553"><a href="#cb25-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-554"><a href="#cb25-554" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-555"><a href="#cb25-555" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-556"><a href="#cb25-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-557"><a href="#cb25-557" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-558"><a href="#cb25-558" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs,</span>
<span id="cb25-559"><a href="#cb25-559" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb25-560"><a href="#cb25-560" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-561"><a href="#cb25-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-562"><a href="#cb25-562" aria-hidden="true" tabindex="-1"></a><span class="co"># p.variance</span></span>
<span id="cb25-563"><a href="#cb25-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-564"><a href="#cb25-564" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb25-565"><a href="#cb25-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-566"><a href="#cb25-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-567"><a href="#cb25-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-568"><a href="#cb25-568" aria-hidden="true" tabindex="-1"></a><span class="fu">### SMD 4-multivariate normal</span></span>
<span id="cb25-569"><a href="#cb25-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-570"><a href="#cb25-570" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb25-571"><a href="#cb25-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-574"><a href="#cb25-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-575"><a href="#cb25-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-576"><a href="#cb25-576" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-577"><a href="#cb25-577" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-578"><a href="#cb25-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-579"><a href="#cb25-579" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_normal"</span>, ]</span>
<span id="cb25-580"><a href="#cb25-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-581"><a href="#cb25-581" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-582"><a href="#cb25-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-583"><a href="#cb25-583" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-584"><a href="#cb25-584" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-585"><a href="#cb25-585" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-586"><a href="#cb25-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-587"><a href="#cb25-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-588"><a href="#cb25-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-589"><a href="#cb25-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-590"><a href="#cb25-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-591"><a href="#cb25-591" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-592"><a href="#cb25-592" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-593"><a href="#cb25-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-594"><a href="#cb25-594" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-595"><a href="#cb25-595" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-596"><a href="#cb25-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (x1 - x2) / pooled SD"</span>,</span>
<span id="cb25-597"><a href="#cb25-597" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-598"><a href="#cb25-598" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-599"><a href="#cb25-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-600"><a href="#cb25-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-601"><a href="#cb25-601" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-602"><a href="#cb25-602" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-603"><a href="#cb25-603" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-604"><a href="#cb25-604" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-605"><a href="#cb25-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-606"><a href="#cb25-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-607"><a href="#cb25-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-608"><a href="#cb25-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-609"><a href="#cb25-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-610"><a href="#cb25-610" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-611"><a href="#cb25-611" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">plugin_1st =</span> <span class="st">"Cohen's d"</span>, </span>
<span id="cb25-612"><a href="#cb25-612" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plugin_2nd =</span> <span class="st">"Hedges' g"</span>, </span>
<span id="cb25-613"><a href="#cb25-613" aria-hidden="true" tabindex="-1"></a>                                <span class="at">safe =</span> <span class="st">"SAFE"</span>))<span class="sc">+</span></span>
<span id="cb25-614"><a href="#cb25-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-615"><a href="#cb25-615" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-616"><a href="#cb25-616" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-617"><a href="#cb25-617" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Cohen's d estimand"</span>,</span>
<span id="cb25-618"><a href="#cb25-618" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"plugin_2nd_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Hedges' g estimand"</span>,</span>
<span id="cb25-619"><a href="#cb25-619" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"safe_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo SAFE variance estimand"</span>,</span>
<span id="cb25-620"><a href="#cb25-620" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_1st"</span> <span class="ot">=</span> <span class="st">"True Cohen's d point estimand"</span>,</span>
<span id="cb25-621"><a href="#cb25-621" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_2nd"</span> <span class="ot">=</span> <span class="st">"True Hedges' g point estimand"</span>)))<span class="sc">+</span></span>
<span id="cb25-622"><a href="#cb25-622" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-623"><a href="#cb25-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-624"><a href="#cb25-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-625"><a href="#cb25-625" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-626"><a href="#cb25-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-627"><a href="#cb25-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-628"><a href="#cb25-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-629"><a href="#cb25-629" aria-hidden="true" tabindex="-1"></a>###SMD 2-multivariate normal and 2-Wishart With this estimator, the SAFE calculation used the normal distribution for the two means but the Wishart distribution to estimate the SD.</span>
<span id="cb25-630"><a href="#cb25-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-633"><a href="#cb25-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-634"><a href="#cb25-634" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-635"><a href="#cb25-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-636"><a href="#cb25-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-637"><a href="#cb25-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-638"><a href="#cb25-638" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"SMD_Wishart"</span>, ]</span>
<span id="cb25-639"><a href="#cb25-639" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-640"><a href="#cb25-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-641"><a href="#cb25-641" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-642"><a href="#cb25-642" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-643"><a href="#cb25-643" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-644"><a href="#cb25-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-645"><a href="#cb25-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-646"><a href="#cb25-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-647"><a href="#cb25-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-648"><a href="#cb25-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-649"><a href="#cb25-649" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-650"><a href="#cb25-650" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-651"><a href="#cb25-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-652"><a href="#cb25-652" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-653"><a href="#cb25-653" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-654"><a href="#cb25-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"SMD (x1 - x2) / pooled SD"</span>,</span>
<span id="cb25-655"><a href="#cb25-655" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-656"><a href="#cb25-656" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-657"><a href="#cb25-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-658"><a href="#cb25-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-659"><a href="#cb25-659" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-660"><a href="#cb25-660" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-661"><a href="#cb25-661" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-662"><a href="#cb25-662" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-663"><a href="#cb25-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-664"><a href="#cb25-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-665"><a href="#cb25-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-666"><a href="#cb25-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-667"><a href="#cb25-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-668"><a href="#cb25-668" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-669"><a href="#cb25-669" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">plugin_1st =</span> <span class="st">"Cohen's d"</span>, </span>
<span id="cb25-670"><a href="#cb25-670" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plugin_2nd =</span> <span class="st">"Hedges' g"</span>, </span>
<span id="cb25-671"><a href="#cb25-671" aria-hidden="true" tabindex="-1"></a>                                <span class="at">safe =</span> <span class="st">"SAFE"</span>))<span class="sc">+</span></span>
<span id="cb25-672"><a href="#cb25-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-673"><a href="#cb25-673" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-674"><a href="#cb25-674" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-675"><a href="#cb25-675" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"plugin_1st_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Cohen's d estimand"</span>,</span>
<span id="cb25-676"><a href="#cb25-676" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"plugin_2nd_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo Hedges' g estimand"</span>,</span>
<span id="cb25-677"><a href="#cb25-677" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"safe_mc"</span> <span class="ot">=</span> <span class="st">"Monte Carlo SAFE variance estimand"</span>,</span>
<span id="cb25-678"><a href="#cb25-678" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_1st"</span> <span class="ot">=</span> <span class="st">"True Cohen's d point estimand"</span>,</span>
<span id="cb25-679"><a href="#cb25-679" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"true_2nd"</span> <span class="ot">=</span> <span class="st">"True Hedges' g point estimand"</span>)))<span class="sc">+</span></span>
<span id="cb25-680"><a href="#cb25-680" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-681"><a href="#cb25-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-682"><a href="#cb25-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-683"><a href="#cb25-683" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-684"><a href="#cb25-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-685"><a href="#cb25-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-686"><a href="#cb25-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-687"><a href="#cb25-687" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 4-multivariate normal</span></span>
<span id="cb25-688"><a href="#cb25-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-689"><a href="#cb25-689" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb25-690"><a href="#cb25-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-693"><a href="#cb25-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-694"><a href="#cb25-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-695"><a href="#cb25-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-696"><a href="#cb25-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-697"><a href="#cb25-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-698"><a href="#cb25-698" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_normal"</span>, ]</span>
<span id="cb25-699"><a href="#cb25-699" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-700"><a href="#cb25-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-701"><a href="#cb25-701" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb25-702"><a href="#cb25-702" aria-hidden="true" tabindex="-1"></a>                                   sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-703"><a href="#cb25-703" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-704"><a href="#cb25-704" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-705"><a href="#cb25-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-706"><a href="#cb25-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-707"><a href="#cb25-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-708"><a href="#cb25-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-709"><a href="#cb25-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-710"><a href="#cb25-710" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-711"><a href="#cb25-711" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-712"><a href="#cb25-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-713"><a href="#cb25-713" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-714"><a href="#cb25-714" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-715"><a href="#cb25-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR"</span>,</span>
<span id="cb25-716"><a href="#cb25-716" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-717"><a href="#cb25-717" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-718"><a href="#cb25-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-719"><a href="#cb25-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-720"><a href="#cb25-720" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-721"><a href="#cb25-721" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-722"><a href="#cb25-722" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-723"><a href="#cb25-723" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-724"><a href="#cb25-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-725"><a href="#cb25-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-726"><a href="#cb25-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-727"><a href="#cb25-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-728"><a href="#cb25-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-729"><a href="#cb25-729" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-730"><a href="#cb25-730" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-731"><a href="#cb25-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-732"><a href="#cb25-732" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-733"><a href="#cb25-733" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-734"><a href="#cb25-734" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-735"><a href="#cb25-735" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-736"><a href="#cb25-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-737"><a href="#cb25-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-738"><a href="#cb25-738" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-739"><a href="#cb25-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-740"><a href="#cb25-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-741"><a href="#cb25-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-742"><a href="#cb25-742" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnCVR 2-multivariate normal and 2-Wishart</span></span>
<span id="cb25-743"><a href="#cb25-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-744"><a href="#cb25-744" aria-hidden="true" tabindex="-1"></a>The SAFE estimator for this effect size was calculated with a multivariate normal distribution for both mean and SD.</span>
<span id="cb25-745"><a href="#cb25-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-748"><a href="#cb25-748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-749"><a href="#cb25-749" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-750"><a href="#cb25-750" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-751"><a href="#cb25-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-752"><a href="#cb25-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-753"><a href="#cb25-753" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnCVR_Wishart"</span>, ]</span>
<span id="cb25-754"><a href="#cb25-754" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-755"><a href="#cb25-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-756"><a href="#cb25-756" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb25-757"><a href="#cb25-757" aria-hidden="true" tabindex="-1"></a>                                   sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-758"><a href="#cb25-758" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-759"><a href="#cb25-759" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-760"><a href="#cb25-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-761"><a href="#cb25-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-762"><a href="#cb25-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-763"><a href="#cb25-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-764"><a href="#cb25-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-765"><a href="#cb25-765" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-766"><a href="#cb25-766" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-767"><a href="#cb25-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span>))<span class="sc">+</span></span>
<span id="cb25-768"><a href="#cb25-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-769"><a href="#cb25-769" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-770"><a href="#cb25-770" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-771"><a href="#cb25-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnCVR"</span>,</span>
<span id="cb25-772"><a href="#cb25-772" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-773"><a href="#cb25-773" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-774"><a href="#cb25-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="co">#, legend.position.inside = c(.85, .85)</span></span>
<span id="cb25-775"><a href="#cb25-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-776"><a href="#cb25-776" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-777"><a href="#cb25-777" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> sample_size_ratio <span class="sc">==</span> <span class="dv">1</span>, ], </span>
<span id="cb25-778"><a href="#cb25-778" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> sample_size1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-779"><a href="#cb25-779" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-780"><a href="#cb25-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-781"><a href="#cb25-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-782"><a href="#cb25-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-783"><a href="#cb25-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-784"><a href="#cb25-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-785"><a href="#cb25-785" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-786"><a href="#cb25-786" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-787"><a href="#cb25-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-788"><a href="#cb25-788" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-789"><a href="#cb25-789" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-790"><a href="#cb25-790" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-791"><a href="#cb25-791" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-792"><a href="#cb25-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-793"><a href="#cb25-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-794"><a href="#cb25-794" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-795"><a href="#cb25-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-796"><a href="#cb25-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-797"><a href="#cb25-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-798"><a href="#cb25-798" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR Binomial</span></span>
<span id="cb25-799"><a href="#cb25-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-800"><a href="#cb25-800" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation used a binomial distribution to draw random binomial samples for 'a' and 'c'.</span>
<span id="cb25-801"><a href="#cb25-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-804"><a href="#cb25-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-805"><a href="#cb25-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-806"><a href="#cb25-806" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-807"><a href="#cb25-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-808"><a href="#cb25-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-809"><a href="#cb25-809" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR"</span>, ]</span>
<span id="cb25-810"><a href="#cb25-810" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-811"><a href="#cb25-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-812"><a href="#cb25-812" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-813"><a href="#cb25-813" aria-hidden="true" tabindex="-1"></a>                                   true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-814"><a href="#cb25-814" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-815"><a href="#cb25-815" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-816"><a href="#cb25-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-817"><a href="#cb25-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-818"><a href="#cb25-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-819"><a href="#cb25-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-820"><a href="#cb25-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-821"><a href="#cb25-821" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-822"><a href="#cb25-822" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-823"><a href="#cb25-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>,</span>
<span id="cb25-824"><a href="#cb25-824" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-825"><a href="#cb25-825" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-826"><a href="#cb25-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-827"><a href="#cb25-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-828"><a href="#cb25-828" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-829"><a href="#cb25-829" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-830"><a href="#cb25-830" aria-hidden="true" tabindex="-1"></a>                                      true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-831"><a href="#cb25-831" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-832"><a href="#cb25-832" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-833"><a href="#cb25-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-834"><a href="#cb25-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-835"><a href="#cb25-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-836"><a href="#cb25-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-837"><a href="#cb25-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-838"><a href="#cb25-838" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-839"><a href="#cb25-839" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-840"><a href="#cb25-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-841"><a href="#cb25-841" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-842"><a href="#cb25-842" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-843"><a href="#cb25-843" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-844"><a href="#cb25-844" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-845"><a href="#cb25-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-846"><a href="#cb25-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-847"><a href="#cb25-847" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-848"><a href="#cb25-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-849"><a href="#cb25-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-850"><a href="#cb25-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-851"><a href="#cb25-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnOR Normal</span></span>
<span id="cb25-852"><a href="#cb25-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-853"><a href="#cb25-853" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation used a normal distribution to draw 'p1' and 'p2' from which 'a' and 'c' were calculated. **Something is still off...**</span>
<span id="cb25-854"><a href="#cb25-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-857"><a href="#cb25-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-858"><a href="#cb25-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-859"><a href="#cb25-859" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-860"><a href="#cb25-860" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-861"><a href="#cb25-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-862"><a href="#cb25-862" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnOR_normal"</span>, ]</span>
<span id="cb25-863"><a href="#cb25-863" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-864"><a href="#cb25-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-865"><a href="#cb25-865" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-866"><a href="#cb25-866" aria-hidden="true" tabindex="-1"></a>                                   true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-867"><a href="#cb25-867" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-868"><a href="#cb25-868" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-869"><a href="#cb25-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-870"><a href="#cb25-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-871"><a href="#cb25-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-872"><a href="#cb25-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-873"><a href="#cb25-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-874"><a href="#cb25-874" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-875"><a href="#cb25-875" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-876"><a href="#cb25-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-877"><a href="#cb25-877" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-878"><a href="#cb25-878" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-879"><a href="#cb25-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb25-880"><a href="#cb25-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnOR"</span>,</span>
<span id="cb25-881"><a href="#cb25-881" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-882"><a href="#cb25-882" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-883"><a href="#cb25-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-884"><a href="#cb25-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-885"><a href="#cb25-885" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-886"><a href="#cb25-886" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-887"><a href="#cb25-887" aria-hidden="true" tabindex="-1"></a>                                      true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-888"><a href="#cb25-888" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-889"><a href="#cb25-889" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-890"><a href="#cb25-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-891"><a href="#cb25-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-892"><a href="#cb25-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-893"><a href="#cb25-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-894"><a href="#cb25-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-895"><a href="#cb25-895" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-896"><a href="#cb25-896" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-897"><a href="#cb25-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-898"><a href="#cb25-898" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-899"><a href="#cb25-899" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-900"><a href="#cb25-900" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-901"><a href="#cb25-901" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-902"><a href="#cb25-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-903"><a href="#cb25-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-904"><a href="#cb25-904" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-905"><a href="#cb25-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-906"><a href="#cb25-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-907"><a href="#cb25-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-908"><a href="#cb25-908" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR Binomial</span></span>
<span id="cb25-909"><a href="#cb25-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-910"><a href="#cb25-910" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'a' and 'c' from a binomial distribution.</span>
<span id="cb25-911"><a href="#cb25-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-914"><a href="#cb25-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-915"><a href="#cb25-915" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-916"><a href="#cb25-916" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-917"><a href="#cb25-917" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-918"><a href="#cb25-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-919"><a href="#cb25-919" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR"</span>, ]</span>
<span id="cb25-920"><a href="#cb25-920" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-921"><a href="#cb25-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-922"><a href="#cb25-922" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-923"><a href="#cb25-923" aria-hidden="true" tabindex="-1"></a>                                   true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-924"><a href="#cb25-924" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-925"><a href="#cb25-925" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-926"><a href="#cb25-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-927"><a href="#cb25-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-928"><a href="#cb25-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-929"><a href="#cb25-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-930"><a href="#cb25-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-931"><a href="#cb25-931" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-932"><a href="#cb25-932" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-933"><a href="#cb25-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-934"><a href="#cb25-934" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-935"><a href="#cb25-935" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-936"><a href="#cb25-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb25-937"><a href="#cb25-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>,</span>
<span id="cb25-938"><a href="#cb25-938" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-939"><a href="#cb25-939" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-940"><a href="#cb25-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-941"><a href="#cb25-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-942"><a href="#cb25-942" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-943"><a href="#cb25-943" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-944"><a href="#cb25-944" aria-hidden="true" tabindex="-1"></a>                                      true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-945"><a href="#cb25-945" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-946"><a href="#cb25-946" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-947"><a href="#cb25-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-948"><a href="#cb25-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-949"><a href="#cb25-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-950"><a href="#cb25-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-951"><a href="#cb25-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-952"><a href="#cb25-952" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-953"><a href="#cb25-953" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-954"><a href="#cb25-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-955"><a href="#cb25-955" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-956"><a href="#cb25-956" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-957"><a href="#cb25-957" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-958"><a href="#cb25-958" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-959"><a href="#cb25-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-960"><a href="#cb25-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-961"><a href="#cb25-961" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-962"><a href="#cb25-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-963"><a href="#cb25-963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-964"><a href="#cb25-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-965"><a href="#cb25-965" aria-hidden="true" tabindex="-1"></a><span class="fu">### lnRR Normal</span></span>
<span id="cb25-966"><a href="#cb25-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-967"><a href="#cb25-967" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'p1' and 'p2' from a normal distribution.</span>
<span id="cb25-968"><a href="#cb25-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-971"><a href="#cb25-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-972"><a href="#cb25-972" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-973"><a href="#cb25-973" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-974"><a href="#cb25-974" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-975"><a href="#cb25-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-976"><a href="#cb25-976" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnRR_normal"</span>, ]</span>
<span id="cb25-977"><a href="#cb25-977" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-978"><a href="#cb25-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-979"><a href="#cb25-979" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-980"><a href="#cb25-980" aria-hidden="true" tabindex="-1"></a>                                   true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-981"><a href="#cb25-981" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-982"><a href="#cb25-982" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-983"><a href="#cb25-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-984"><a href="#cb25-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-985"><a href="#cb25-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-986"><a href="#cb25-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-987"><a href="#cb25-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-988"><a href="#cb25-988" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-989"><a href="#cb25-989" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-990"><a href="#cb25-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-991"><a href="#cb25-991" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-992"><a href="#cb25-992" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-993"><a href="#cb25-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnRR"</span>,</span>
<span id="cb25-994"><a href="#cb25-994" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"with n1==n2"</span>)<span class="sc">+</span></span>
<span id="cb25-995"><a href="#cb25-995" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-996"><a href="#cb25-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-997"><a href="#cb25-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-998"><a href="#cb25-998" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-999"><a href="#cb25-999" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> n1 <span class="sc">==</span> n2 <span class="sc">&amp;</span></span>
<span id="cb25-1000"><a href="#cb25-1000" aria-hidden="true" tabindex="-1"></a>                                      true_p_a <span class="sc">==</span> .<span class="dv">1</span> <span class="sc">&amp;</span> true_p_c <span class="sc">==</span> .<span class="dv">7</span>, ], </span>
<span id="cb25-1001"><a href="#cb25-1001" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n1, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-1002"><a href="#cb25-1002" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-1003"><a href="#cb25-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-1004"><a href="#cb25-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-1005"><a href="#cb25-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-1006"><a href="#cb25-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-1007"><a href="#cb25-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-1008"><a href="#cb25-1008" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-1009"><a href="#cb25-1009" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-1010"><a href="#cb25-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-1011"><a href="#cb25-1011" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-1012"><a href="#cb25-1012" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-1013"><a href="#cb25-1013" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-1014"><a href="#cb25-1014" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-1015"><a href="#cb25-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-1016"><a href="#cb25-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1017"><a href="#cb25-1017" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-1018"><a href="#cb25-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1019"><a href="#cb25-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-1020"><a href="#cb25-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1021"><a href="#cb25-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hardy Weinberg Disequilibrium</span></span>
<span id="cb25-1022"><a href="#cb25-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1023"><a href="#cb25-1023" aria-hidden="true" tabindex="-1"></a>In this effect size estimation, the SAFE calculation drew 'n_AA', 'n_Aa', and 'n_aa' from a binomial distribution.</span>
<span id="cb25-1024"><a href="#cb25-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1027"><a href="#cb25-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb25-1028"><a href="#cb25-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb25-1029"><a href="#cb25-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-source: "style='font-size: 0.8em;'"</span></span>
<span id="cb25-1030"><a href="#cb25-1030" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr-output: "style='font-size: 0.7em'"</span></span>
<span id="cb25-1031"><a href="#cb25-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1032"><a href="#cb25-1032" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> sim_results[effect_type <span class="sc">==</span> <span class="st">"lnHWE_A"</span>, ]</span>
<span id="cb25-1033"><a href="#cb25-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(sub_dat, sample_size1)</span>
<span id="cb25-1034"><a href="#cb25-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1035"><a href="#cb25-1035" aria-hidden="true" tabindex="-1"></a>p.point <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bias"</span>) <span class="sc">&amp;</span> <span class="co">#n1 == n2 &amp;</span></span>
<span id="cb25-1036"><a href="#cb25-1036" aria-hidden="true" tabindex="-1"></a>                                   p_AA <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_aa <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_Aa <span class="sc">==</span> <span class="fl">0.5</span>, ], </span>
<span id="cb25-1037"><a href="#cb25-1037" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-1038"><a href="#cb25-1038" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-1039"><a href="#cb25-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-1040"><a href="#cb25-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-1041"><a href="#cb25-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(point_lab)<span class="sc">+</span></span>
<span id="cb25-1042"><a href="#cb25-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-1043"><a href="#cb25-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-1044"><a href="#cb25-1044" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-1045"><a href="#cb25-1045" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-1046"><a href="#cb25-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-1047"><a href="#cb25-1047" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-1048"><a href="#cb25-1048" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-1049"><a href="#cb25-1049" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"lnHWD"</span>)<span class="sc">+</span></span>
<span id="cb25-1050"><a href="#cb25-1050" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-1051"><a href="#cb25-1051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb25-1052"><a href="#cb25-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1053"><a href="#cb25-1053" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb25-1054"><a href="#cb25-1054" aria-hidden="true" tabindex="-1"></a>p.variance <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sub_dat[calculation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"relative_bias"</span>) <span class="sc">&amp;</span> </span>
<span id="cb25-1055"><a href="#cb25-1055" aria-hidden="true" tabindex="-1"></a>                                   p_AA <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_aa <span class="sc">==</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> p_Aa <span class="sc">==</span> <span class="fl">0.5</span>, ], </span>
<span id="cb25-1056"><a href="#cb25-1056" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> value, <span class="at">color =</span> estimator,</span>
<span id="cb25-1057"><a href="#cb25-1057" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> estimator))<span class="sc">+</span></span>
<span id="cb25-1058"><a href="#cb25-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb25-1059"><a href="#cb25-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">lwd =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-1060"><a href="#cb25-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(var_lab)<span class="sc">+</span></span>
<span id="cb25-1061"><a href="#cb25-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sample size"</span>)<span class="sc">+</span></span>
<span id="cb25-1062"><a href="#cb25-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Estimator"</span>, </span>
<span id="cb25-1063"><a href="#cb25-1063" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> pal,</span>
<span id="cb25-1064"><a href="#cb25-1064" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labs)<span class="sc">+</span></span>
<span id="cb25-1065"><a href="#cb25-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand, </span>
<span id="cb25-1066"><a href="#cb25-1066" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb25-1067"><a href="#cb25-1067" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb25-1068"><a href="#cb25-1068" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> facet_labs)<span class="sc">+</span></span>
<span id="cb25-1069"><a href="#cb25-1069" aria-hidden="true" tabindex="-1"></a>  theme_SAFE<span class="sc">+</span></span>
<span id="cb25-1070"><a href="#cb25-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-1071"><a href="#cb25-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1072"><a href="#cb25-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1073"><a href="#cb25-1073" aria-hidden="true" tabindex="-1"></a>p.point <span class="sc">+</span> <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> p.variance <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb25-1074"><a href="#cb25-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1075"><a href="#cb25-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>